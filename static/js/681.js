(self.webpackChunkflow_web_extension=self.webpackChunkflow_web_extension||[]).push([[681],{39461:(e,t,s)=>{s.d(t,{A:()=>ee});var i=function(){return(i=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++)for(var n in t=arguments[s])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function n(e,t){var s="function"==typeof Symbol&&e[Symbol.iterator];if(!s)return e;var i,n,a=s.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return o}function a(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e}var o,r,c,l,d,u=function(){function e(){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var s=this;e&&t&&"function"==typeof t&&this.on(e,(function i(n){t(n),s.off(e,i)}))},e.prototype.off=function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var s=this._hooks[e].indexOf(t);-1!==s&&this._hooks[e].splice(s,1)}else this._hooks[e]=[]},e.prototype.emit=function(e,t,s){if(s){if(!e)return;-1!==this._cache.indexOf(s)?this._emit(e,t):(this._hooksCache.hasOwnProperty(s)||(this._hooksCache[s]={}),this._hooksCache[s].hasOwnProperty(e)||(this._hooksCache[s][e]=[]),this._hooksCache[s][e].push(t))}else this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&a(this._hooks[e]).forEach((function(e){try{e(t)}catch(e){}}))},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),g=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},h=(o=+Date.now()+Number((""+Math.random()).slice(2,8)),function(){return o+=1}),p=function(e){return function(e,t,s){if("string"==typeof e&&"number"==typeof s){var i,n=[];s=s<=25?s:s%25;var a=String.fromCharCode(s+97);i=e.split(a);for(var o=0;o<i.length;o++){var r=parseInt(i[o],s);r=1*r^64;var c=String.fromCharCode(r);n.push(c)}return n.join("")}}(e,0,25)},_=function(e){var t=document.createElement("a");return t.href=e,t},m=function(e){var t={};try{var s=_(e).search;if(!s)return t;(s=s.slice(1)).split("&").forEach((function(e){var s,i,n=e.split("=");n.length&&(s=n[0],i=n[1]);try{t[s]=decodeURIComponent(void 0===i?"":i)}catch(e){t[s]=i}}))}catch(e){}return t},v=function(e){for(var t=0,s=0,i=(e+="").length,n=0;n<i;n++)((t=31*t+e.charCodeAt(s++))>0x7fffffffffff||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t},f=(function(e,t){var s;s=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var s=arguments[e];for(var i in s)t[i]=s[i]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function s(i){function n(){}function a(t,s,a){if("undefined"!=typeof document){"number"==typeof(a=e({path:"/"},n.defaults,a)).expires&&(a.expires=new Date(1*new Date+864e5*a.expires)),a.expires=a.expires?a.expires.toUTCString():"";try{var o=JSON.stringify(s);/^[\{\[]/.test(o)&&(s=o)}catch(e){}s=i.write?i.write(s,t):encodeURIComponent(String(s)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var r="";for(var c in a)a[c]&&(r+="; "+c,!0!==a[c]&&(r+="="+a[c].split(";")[0]));return document.cookie=t+"="+s+r}}function o(e,s){if("undefined"!=typeof document){for(var n={},a=document.cookie?document.cookie.split("; "):[],o=0;o<a.length;o++){var r=a[o].split("="),c=r.slice(1).join("=");s||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(r[0]);if(c=(i.read||i)(c,l)||t(c),s)try{c=JSON.parse(c)}catch(e){}if(n[l]=c,e===l)break}catch(e){}}return e?n[e]:n}}return n.set=a,n.get=function(e){return o(e,!1)},n.getJSON=function(e){return o(e,!0)},n.remove=function(t,s){a(t,"",e(s,{expires:-1}))},n.defaults={},n.withConverter=s,n}((function(){}))},e.exports=s()}(r={exports:{}}),r.exports),y=function(e,t){try{return e?f.get(e,{domain:t||document.domain}):f.get()}catch(e){return""}},b=function(e,t,s,i){try{var n=i||document.domain,a=+new Date+(s||6048e5);f.set(e,t,{expires:new Date(a),path:"/",domain:n})}catch(e){}},S=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e.prototype.getCookie=function(e,t){return y(e,t)},e.prototype.setCookie=function(e,t,s,i){b(e,t,s,i)},e}(),k={getItem:function(e){try{var t=localStorage.getItem(e),s=t;try{t&&"string"==typeof t&&(s=JSON.parse(t))}catch(e){}return s||{}}catch(e){}return{}},setItem:function(e,t){try{var s="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,s)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return y(e,t)},setCookie:function(e,t,s,i){b(e,t,s,i)},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(d){return!1}}()},M={getItem:function(e){try{var t=sessionStorage.getItem(e),s=t;try{t&&"string"==typeof t&&(s=JSON.parse(t))}catch(e){}return s||{}}catch(e){}return{}},setItem:function(e,t){try{var s="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,s)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return y(e,t)},setCookie:function(e,t,s,i){b(e,t,s,i)},isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(d){return!1}}()},A=function(){function e(e,t){this._storage=t&&"session"===t?M:!e&&k.isSupportLS?k:new S}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,s,i){this._storage.setCookie(e,t,s,i)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),E=function(){function e(e,t,s){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=s}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,s=document.referrer,i=s?_(s).hostname:"",n=m(window.location.href),a=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web";this.utm=function(e,t,s,i){var n=new A(!1),a=new A(!1,"session"),o=e?"_tea_utm_cache_"+e:"_tea_utm_cache",r=e?"_$utm_from_url_"+e:"_$utm_from_url",c={},l=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],d={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var u=!1;for(var g in d)d[g]&&(-1!==l.indexOf(g)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[g]=d[g]):c[g]=d[g],u=!0);if(u)a.setItem(r,"1"),n.setCookie(o,JSON.stringify(c),i,s);else{var h=n.getCookie(o,s);h&&(c=JSON.parse(h))}a.getItem(r)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return d}return c}(this.appid,n,this.domain,this.cookie_expire);var o=this.browser(),r=this.os();return{browser:o.browser,browser_version:o.browser_version,platform:a,os_name:r.os_name,os_version:r.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(r.os_name),language:t,referrer:s,referrer_host:i,utm:this.utm,latest_data:this.last(s,i)}},e.prototype.last=function(e,t){var s="",i="",n="",a=location.hostname,o=!1;if(e&&t&&a!==t){s=e,i=t,o=!0;var r=m(e);r.keyword&&(n=r.keyword)}return{$latest_referrer:s,$latest_referrer_host:i,$latest_search_keyword:n,isLast:o}},e.prototype.browser=function(){var e,t,s="",i=""+parseFloat(this.appVersion),n=this.userAgent,a=/\sSamantha(\w+)\/(.*?)(\s|$)/i.exec(n);return a?{browser:a[1],browser_version:a[2]}:(-1!==n.indexOf("Edge")||-1!==n.indexOf("Edg")?(s="Microsoft Edge",-1!==n.indexOf("Edge")?(e=n.indexOf("Edge"),i=n.substring(e+5)):(e=n.indexOf("Edg"),i=n.substring(e+4))):-1!==(e=n.indexOf("MSIE"))?(s="Microsoft Internet Explorer",i=n.substring(e+5)):-1!==(e=n.indexOf("MetaSr"))?(s="sougoubrowser",i=n.substring(e+7,e+10)):-1!==n.indexOf("MQQBrowser")||-1!==n.indexOf("QQBrowser")?(s="qqbrowser",-1!==n.indexOf("MQQBrowser")?(e=n.indexOf("MQQBrowser"),i=n.substring(e+11,e+15)):-1!==n.indexOf("QQBrowser")&&(e=n.indexOf("QQBrowser"),i=n.substring(e+10,e+25))):-1!==n.indexOf("Chrome")?-1!==(e=n.indexOf("MicroMessenger"))?(s="weixin",i=n.substring(e+15,e+20)):-1!==(e=n.indexOf("360"))?(s="360browser",i=n.substring(n.indexOf("Chrome")+7)):-1!==n.indexOf("baidubrowser")||-1!==n.indexOf("BIDUBrowser")?(-1!==n.indexOf("baidubrowser")?(e=n.indexOf("baidubrowser"),i=n.substring(e+13,e+16)):-1!==n.indexOf("BIDUBrowser")&&(e=n.indexOf("BIDUBrowser"),i=n.substring(e+12,e+15)),s="baidubrowser"):-1!==(e=n.indexOf("xiaomi"))?-1!==n.indexOf("openlanguagexiaomi")?(s="openlanguage xiaomi",i=n.substring(e+7,e+13)):(s="xiaomi",i=n.substring(e-7,e-1)):-1!==(e=n.indexOf("TTWebView"))?(s="TTWebView",i=n.substring(e+10,e+23)):(-1!==(e=n.indexOf("Chrome"))||-1!==(e=n.indexOf("Chrome")))&&(s="Chrome",i=n.substring(e+7)):-1!==n.indexOf("Safari")?-1!==(e=n.indexOf("QQ"))?(s="qqbrowser",i=n.substring(e+10,e+16)):-1!==(e=n.indexOf("Safari"))&&(s="Safari",i=n.substring(e+7),-1!==(e=n.indexOf("Version"))&&(i=n.substring(e+8))):-1!==(e=n.indexOf("Firefox"))?(s="Firefox",i=n.substring(e+8)):-1!==(e=n.indexOf("MicroMessenger"))?(s="weixin",i=n.substring(e+15,e+20)):-1!==(e=n.indexOf("QQ"))&&(s="qqbrowser",i=n.substring(e+3,e+8)),-1!==(t=i.indexOf(";"))&&(i=i.substring(0,t)),-1!==(t=i.indexOf(" "))&&(i=i.substring(0,t)),-1!==(t=i.indexOf(")"))&&(i=i.substring(0,t)),{browser:s,browser_version:i})},e.prototype.os=function(){for(var e="",t="",s=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"chromeOS",r:/CrOS/},{s:"Linux",r:/(Linux|X11)/},{s:"Sun OS",r:/SunOS/}],i=0;i<s.length;i++){var n=s[i];if(n.r.test(this.userAgent)){"Mac OS X"===(e=n.s)&&this.isNewIpad()&&(e="iOS");break}}var a,o,r=function(e,t){var s=e.exec(t);return s&&s[1]?s[1]:""},c=function(e,t){var s=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t);return s?s.slice(1)[0]:""};switch(/Windows/.test(e)&&(t=r(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":t=c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":(o=r(/Android ([\.\_\d]+)/,a=this.userAgent))||(o=r(/Android\/([\.\_\d]+)/,a)),t=o,e="android";break;case"iOS":t=this.isNewIpad()?c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios";break;case"chromeOS":var l=this.userAgent.indexOf("x86_64");t=this.userAgent.substring(l+7,l+16)}return{os_name:e,os_version:t}},e.prototype.getDeviceModel=function(e){var t="";try{if("android"===e)navigator.userAgent.split(";").forEach((function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))}));else if("ios"===e||"mac"===e||"windows"===e)if(this.isNewIpad())t="iPad";else{var s=navigator.userAgent.replace("Mozilla/5.0 (",""),i=s.indexOf(";");t=s.slice(0,i)}}catch(e){return t.trim()}return t.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},e}(),w={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},I={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"},L="5.1.19",R=(p("1fz22z22z1nz21z4mz4bz4bz1jz1dz49z1az1bz1lz49z22z1mz21z4az19z27z22z1cz21z1az1kz4az1az1mz1kz4bz1mz19z1hz4bz21z22z18z22z1gz1az4bz1jz1mz1ez49z21z1bz1iz4bz1az1mz1jz1jz1cz1az22z4bz24z1gz21z23z18z1jz49z1cz1bz1gz22z1mz20z49z20z18z1lz1ez1cz20z21z4az1hz21"),p("1fz22z22z1nz21z4mz4bz4bz1jz1dz49z1az1bz1lz49z22z1mz21z4az19z27z22z1cz21z1az1kz4az1az1mz1kz4bz1mz19z1hz4bz21z22z18z22z1gz1az4bz1jz1mz1ez49z21z1bz1iz4bz1az1mz1jz1jz1cz1az22z4bz24z1gz21z23z18z1jz49z18z19z49z1az1mz20z1cz4az1hz21"),p("1fz22z22z1nz21z4mz4bz4bz1jz1dz49z1az1bz1lz49z22z1mz21z4az19z27z22z1cz21z1az1kz4az1az1mz1kz4bz1mz19z1hz4bz21z22z18z22z1gz1az4bz1jz1mz1ez49z21z1bz1iz4bz1az1mz1jz1jz1cz1az22z4bz24z1gz21z23z18z1jz49z18z19z49z1jz1mz18z1bz1cz20z4az1hz21"),p("1fz22z22z1nz21z4mz4bz4bz1jz1dz49z1az1bz1lz49z22z1mz21z4az19z27z22z1cz21z1az1kz4az1az1mz1kz4bz1mz19z1hz4bz21z22z18z22z1gz1az4bz1jz1mz1ez49z21z1bz1iz4bz1az1mz1jz1jz1cz1az22z4bz1fz1cz18z22z1kz18z1nz49z1az1mz20z1c"),p("1fz22z22z1nz21z4mz4bz4bz1jz1dz4fz49z1bz18z22z18z4az24z1mz1jz1az1az1bz1lz4az1az1mz1kz4bz1mz19z1hz4bz1bz18z22z18z49z21z22z18z22z1gz1az4bz1jz1mz1ez49z21z1bz1iz4bz1az1mz1jz1jz1cz1az22z4bz22z1cz21z22z1cz20z49z1cz24z1cz1lz22z49z1gz1lz21z1nz1cz1az22z1mz20"),function(){function e(e,t){this.collector=e,this.config=t,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","_staging_flag"],this.regStr=new RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}return e.prototype.checkVerify=function(e){var t=this;if(!e||!e.length)return!1;var s=e[0];if(!s)return!1;var i=s.events,n=s.header;if(!i||!i.length)return!1;var a=!0;return i.forEach((function(e){if(!e)return a=!1,void(e.checkEvent="\u4e8b\u4ef6\u5f02\u5e38");t.checkEventName(e.event)||(a=!1,e.checkEvent="\u4e8b\u4ef6\u540d\u4e0d\u80fd\u4ee5 $ or __\u5f00\u5934"),t.checkEventParams(e.params)||(a=!1,e.checkParams="\u5c5e\u6027\u540d\u4e0d\u80fd\u4ee5 $ or __\u5f00\u5934")})),this.checkEventParams(n)||(a=!1),a},e.prototype.checkEventName=function(e){return!!e&&this.calculate(e,"event")},e.prototype.checkEventParams=function(e){var t=e;if("string"==typeof e&&(t=JSON.parse(t)),!Object.keys(t).length)return!0;for(var s in t)return!(!this.calculate(s,"params")||"string"==typeof t[s]&&t[s].length>1024&&(console.warn("params: "+s+" can not over 1024 byte, please check;"),1));return!0},e.prototype.calculate=function(e,t){return-1!==("event"===t?this.eventNameWhiteList:this.paramsNameWhiteList).indexOf(e)||!new RegExp("^\\$").test(e)&&!new RegExp("^__").test(e)||(console.warn(("event"===t?"event":"params")+" name: "+e+" can not start with $ or __, pleace check;"),!1)},e}());(d=c||(c={})).Init="init",d.Config="config",d.Start="start",d.Ready="ready",d.UnReady="un-ready",d.TokenComplete="token-complete",d.TokenStorage="token-storage",d.TokenFetch="token-fetch",d.TokenError="token-error",d.ConfigUuid="config-uuid",d.ConfigWebId="config-webid",d.ConfigDomain="config-domain",d.CustomWebId="custom-webid",d.TokenChange="token-change",d.TokenReset="token-reset",d.ConfigTransform="config-transform",d.EnvTransform="env-transform",d.SessionReset="session-reset",d.SessionResetTime="session-reset-time",d.SetSessionId="set-session-id",d.Event="event",d.Events="events",d.EventNow="event-now",d.CleanEvents="clean-events",d.BeconEvent="becon-event",d.SubmitBefore="submit-before",d.SubmitScuess="submit-scuess",d.SubmitAfter="submit-after",d.SubmitError="submit-error",d.SubmitVerify="submit-verify",d.Stay="stay",d.ResetStay="reset-stay",d.StayReady="stay-ready",d.SetStay="set-stay",d.RouteChange="route-change",d.RouteReady="route-ready",d.Ab="ab",d.AbVar="ab-var",d.AbAllVars="ab-all-vars",d.AbConfig="ab-config",d.AbExternalVersion="ab-external-version",d.AbVersionChangeOn="ab-version-change-on",d.AbVersionChangeOff="ab-version-change-off",d.AbOpenLayer="ab-open-layer",d.AbCloseLayer="ab-close-layer",d.AbReady="ab-ready",d.AbComplete="ab-complete",d.AbTimeout="ab-timeout",d.Profile="profile",d.ProfileSet="profile-set",d.ProfileSetOnce="profile-set-once",d.ProfileUnset="profile-unset",d.ProfileIncrement="profile-increment",d.ProfileAppend="profile-append",d.ProfileClear="profile-clear",d.Autotrack="autotrack",d.AutotrackReady="autotrack-ready",d.CepReady="cep-ready",d.TracerReady="tracer-ready",d.sessionRecord="session-record",d.SessionRecordStart="session-record-start",d.SessionRecordPause="session-record-pause",d.SessionRecordEnd="session-record-end",d.SessionRecordReport="session-record-report",d.DestoryInstance="destory-instance",d.VisualCollectReady="visual-collect-ready",d.VisualApiReady="visual-api-ready",d.VisualApiUpdate="visual-api-update",function(e){e.DEBUGGER_MESSAGE="debugger-message",e.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",e.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",e.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",e.DEBUGGER_MESSAGE_EVENT="debugger-message-event",e.DEVTOOL_WEB_READY="devtool-web-ready"}(l||(l={}));var z,C=c,T=void 0,U=(new Date).getTimezoneOffset(),x=parseInt(""+-U/60,10),B=60*U,O=function(){function e(e,t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var s=new E(t.app_id,t.cookie_domain||"",t.cookie_expire||7776e6).init();this.eventCheck=new R(e,t);var i="__tea_cache_first_"+t.app_id;this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new A(!1,"session"),this.localStorage=new A(!1,"local"),t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage);var n=this.localStorage.getItem(i);n&&1==n?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(i,"1")),this.envInfo={user:{user_unique_id:T,user_type:T,user_id:T,user_is_auth:T,user_is_login:T,device_id:T,web_id:T,ip_addr_id:T,user_unique_id_type:T},header:{app_id:T,app_name:T,app_install_id:T,install_id:T,app_package:T,app_channel:T,app_version:T,ab_version:T,os_name:s.os_name,os_version:s.os_version,device_model:s.device_model,ab_client:T,traffic_type:T,client_ip:T,device_brand:T,os_api:T,access:T,language:s.language,region:T,app_language:T,app_region:T,creative_id:s.utm.creative_id,ad_id:s.utm.ad_id,campaign_id:s.utm.campaign_id,log_type:T,rnd:T,platform:s.platform,sdk_version:L,sdk_lib:"js",province:T,city:T,timezone:x,tz_offset:B,tz_name:T,sim_region:T,carrier:T,resolution:s.screen_width+"x"+s.screen_height,browser:s.browser,browser_version:s.browser_version,referrer:s.referrer,referrer_host:s.referrer_host,width:s.screen_width,height:s.screen_height,screen_width:s.screen_width,screen_height:s.screen_height,utm_term:s.utm.utm_term,utm_content:s.utm.utm_content,utm_source:s.utm.utm_source,utm_medium:s.utm.utm_medium,utm_campaign:s.utm.utm_campaign,tracer_data:JSON.stringify(s.utm.tracer_data),custom:{},wechat_unionid:T,wechat_openid:T}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(s),this.initDomain(),this.initABData()}return e.prototype.initDomain=function(){var e=this.initConfig.channel_domain;if(e)this.domain=e;else{var t=this.initConfig.channel;this.domain=p(I[t])}},e.prototype.setDomain=function(e){this.domain=e},e.prototype.getDomain=function(){return this.domain},e.prototype.initABData=function(){var e="__tea_sdk_ab_version_"+this.initConfig.app_id,t=null;if(this.initConfig.ab_cross){var s=this.localStorage.getCookie(e,this.initConfig.ab_cookie_domain);t=s?JSON.parse(s):null}else t=this.localStorage.getItem(e);this.setAbCache(t)},e.prototype.setAbCache=function(e){this.ab_cache=e},e.prototype.getAbCache=function(){return this.ab_cache},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.clearAbCache=function(){this.ab_version="",this.ab_cache={}},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t="/list";break;case"webid":t="/webid";break;case"tobid":t="/tobid"}var s="";return this.initConfig.caller&&(s="?sdk_version="+L+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+s},e.prototype.setCustom=function(e){if(e&&e.latest_data&&e.latest_data.isLast)for(var t in delete e.latest_data.isLast,this.isLast=!0,e.latest_data)this.envInfo.header.custom[t]=e.latest_data[t]},e.prototype.set=function(e){var t=this;Object.keys(e).forEach((function(s){void 0!==e[s]&&null!==e[s]||t.delete(s);try{t.eventCheck.calculate(s,"config")}catch(d){}if("traffic_type"===s&&t.isLast&&(t.envInfo.header.custom.$latest_traffic_source_type=e[s]),"evtParams"===s)t.evtParams=i(i({},t.evtParams||{}),e.evtParams||{});else if("_staging_flag"===s)t.evtParams=i(i({},t.evtParams||{}),{_staging_flag:e._staging_flag});else if("reportErrorCallback"===s&&"function"==typeof e[s])t.reportErrorCallback=e[s];else{var n="",a="";if(s.indexOf(".")>-1){var o=s.split(".");n=o[0],a=o[1]}n?"user"===n||"header"===n?t.envInfo[n][a]=e[s]:t.envInfo.header.custom[a]=e[s]:Object.hasOwnProperty.call(t.envInfo.user,s)?["user_type","ip_addr_id"].indexOf(s)>-1?t.envInfo.user[s]=e[s]?Number(e[s]):e[s]:["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(s)>-1?t.envInfo.user[s]=e[s]?String(e[s]):e[s]:["user_is_auth","user_is_login"].indexOf(s)>-1?t.envInfo.user[s]=Boolean(e[s]):"device_id"===s&&(t.envInfo.user[s]=e[s]):Object.hasOwnProperty.call(t.envInfo.header,s)?t.envInfo.header[s]=e[s]:t.envInfo.header.custom[s]=e[s]}}))},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error "),this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.setStore=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};if(t&&Object.keys(e).length){var s=Object.assign(e,t);this.storage.setItem(this.configKey,s)}}catch(e){console.log("setStore error"),this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey)||{};return e&&Object.keys(e).length?e:null}catch(e){return this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message}),null}},e.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};t&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message}),console.log("delete error")}},e}(),P=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[AppLog WEB SDK] [instance: "+this.name+"] "+e)},e.prototype.warn=function(e){this.isLog&&console.warn("[AppLog WEB SDK] [instance: "+this.name+"] "+e)},e.prototype.error=function(e){this.isLog&&console.error("[AppLog WEB SDK] [instance: "+this.name+"] "+e)},e.prototype.throw=function(e){throw this.error(this.name),new Error(e)},e}(),q=function(){function e(){this.spiderBot=["Baiduspider","googlebot","360Spider","haosouspider","YoudaoBot","Sogou News Spider","Yisouspider","Googlebot","Headless","Applebot","Bingbot","PetalBot"]}return e.prototype.checkSpider=function(e){if(!e.enable_spider)return!1;var t=window.navigator.userAgent;if(!t)return!0;var s=!1;return this.spiderBot.forEach((function(e){-1!==t.indexOf(e)&&(s=!0)})),s},e}(),D=function(){function e(e,t){this.collect=e,this.native=t}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},t.bridgeReady=function(){var e=this;return new Promise((function(t,s){try{e.bridgeInject()?AppLogBridge.hasStarted((function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):s(!1)})):s(!1)}catch(e){console.log("AppLogBridge, error:"+JSON.stringify(e.stack)),s(!1)}}))},t.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(e){console.error("setNativeAppId error")}},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach((function(s){"user_unique_id"===s?t.setUserUniqueId(e[s]):e[s]?t.addHeaderInfo(s,e[s]):t.removeHeaderInfo(s)}))}catch(e){console.error("setConfig error")}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){console.error("setUserUniqueId error")}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){console.error("addHeaderInfo error")}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){console.error("setHeaderInfo error")}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){console.error("removeHeaderInfo error")}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridge\u57cb\u70b9\u4e0a\u62a5",time:Date.now(),data:[{events:[{event:e,params:t}]}],code:200,status:"success"})}catch(e){console.error("onEventV3 error")}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){console.error("profileSet error")}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){console.error("profileSetOnce error")}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){console.error("profileIncrement error")}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){console.error("profileUnset error")}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){console.error("profileAppend error")}},e}(),G=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},N=function(){function e(){}return e.prototype.apply=function(e,t){var s=this;this.collect=e,this.storage=new A(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSessionTimeCheck=t.disable_session_check,this.disableSession||(this.setSessionId(),this.collect.on(C.SessionReset,(function(e){s.resetSessionId(e)})),this.collect.on(C.SessionResetTime,(function(){s.updateSessionIdTime()})))},e.prototype.updateSessionIdTime=function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:G(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:G(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.disableSessionTimeCheck||(this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime))},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime))},e.prototype.resetSessionId=function(e){var t={sessionId:e||G(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,t)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:G(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},e}(),F=function(){function e(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return e.prototype.apply=function(e,t){var s=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.eventCheck=new R(e,t),this.cacheStorgae=new A(!0),this.localStorage=new A(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||t.report_time||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=t.report_url||this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.refer_key="__tea_cache_refer_"+this.configManager.get("app_id"),this.pageId=G(),this.collect.on(C.Ready,(function(){s.reportAll(!1)})),this.collect.on(C.ConfigDomain,(function(){s.reportUrl=s.configManager.getUrl("event")})),this.collect.on(C.Event,(function(e){s.event(e)})),this.collect.on(C.BeconEvent,(function(e){s.beconEvent(e)})),this.collect.on(C.CleanEvents,(function(){s.reportAll(!1)}));var i=this.linster();this.collect.on(C.DestoryInstance,(function(){i&&i()}))},e.prototype.linster=function(){var e=this,t=function(){e.reportAll(!0)};window.addEventListener("unload",t,!1),function(e){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)}(t);var s=function(){"hidden"===document.visibilityState&&e.reportAll(!0)};return document.addEventListener("visibilitychange",s,!1),function(){window.removeEventListener("unload",t),window.removeEventListener("pagehide",t,!1),window.removeEventListener("beforeunload",t,!1),document.removeEventListener("visibilitychange",s,!1)}},e.prototype.reportAll=function(e){this.report(e),this.reportBecon()},e.prototype.event=function(e){var t=this;try{if(this.collect.destroy)return;if(this.collect.sdkStop)return;var s=a(e,this.cacheStorgae.getItem(this.eventKey)||[]);if(this.cacheStorgae.setItem(this.eventKey,s),this.reportTimeout&&clearTimeout(this.reportTimeout),s.length>=this.maxReport)this.report(!1);else{var i=this.reportTime;this.reportTimeout=setTimeout((function(){t.report(!1),t.reportTimeout=null}),i)}}catch(e){this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.beconEvent=function(e){if(!this.collect.destroy&&!this.collect.sdkStop){var t=a(e,this.cacheStorgae.getItem(this.beconKey)||[]);this.cacheStorgae.setItem(this.beconKey,t),this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))}},e.prototype.reportBecon=function(){if(!this.collect.destroy&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))}},e.prototype.report=function(e){if(!this.collect.destroy&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];t.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))}},e.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var s=0;s<e.length;s+=this.eventLimit){var i;i=e.slice(s,s+this.eventLimit);var n=this.split(this.merge(i));this.send(n,t)}else n=this.split(this.merge(e)),this.send(n,t)},e.prototype.handleRefer=function(){var e="";try{if(this.config.spa||this.config.autotrack){var t=this.localStorage.getItem(this.refer_key)||{};e=t.routeChange?t.refer_key:this.configManager.get("referrer")}else e=this.configManager.get("referrer")}catch(t){e=document.referrer}return e},e.prototype.merge=function(e,t){var s=this,n=this.configManager.get(),a=n.header,o=n.user;this.config.enable_pageid&&(a.custom.page_id=this.pageId),a.referrer=this.handleRefer(),a.custom=JSON.stringify(a.custom);var r=this.configManager.get("evtParams"),c=this.configManager.get("user_unique_id_type"),u=e.map((function(e){try{Object.keys(r).length&&!t&&(e.params=i(i({},r),e.params)),c&&(e.params.$user_unique_id_type=c);var n=s.configManager.getAbCache(),a=o[s.config.ab_user_mode]||o.user_unique_id;return n&&n.uuid&&n.uuid===a&&s.configManager.getAbVersion()&&(e.ab_sdk_version=s.configManager.getAbVersion()),e.session_id=s.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}catch(d){return s.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:d.message}),e}})),g=JSON.parse(JSON.stringify({events:u,user:o,header:a}));g.local_time=Math.floor(Date.now()/1e3),g.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,g.verbose=1;var h=[];return h.push(g),h},e.prototype.split=function(e){return e.map((function(e){var t=[];return t.push(e),t}))},e.prototype.send=function(e,t){var s=this;e.length&&(this.config.disable_track_event||e.forEach((function(e){try{var i=JSON.parse(JSON.stringify(e));s.config.filter&&((i=s.config.filter(i))||console.warn("filter must return data !!")),s.collect.eventFilter&&i&&((i=s.collect.eventFilter(i))||console.warn("filterEvent api must return data !!"));var n=i||e,a=JSON.parse(JSON.stringify(n));if(s.eventCheck.checkVerify(a),!n.length)return;var o=!0;if(n.forEach((function(e){e.events.length||(o=!1)})),!o)return;s.collect.emit(C.SubmitBefore,n),s.collect.requestManager.useRequest({url:s.reportUrl,data:n,success:function(e,t){e&&0!==e.e?(s.collect.emit(C.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),s.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_EVENT,info:"\u57cb\u70b9\u4e0a\u62a5\u5931\u8d25",time:Date.now(),data:a,code:e.e,failType:"\u6570\u636e\u5f02\u5e38\u5931\u8d25",status:"fail"})):(s.collect.emit(C.SubmitScuess,{eventData:t,res:e}),s.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_EVENT,info:"\u57cb\u70b9\u4e0a\u62a5\u6210\u529f",time:Date.now(),data:a,code:200,status:"success"}))},fail:function(e,t){s.configManager.get("reportErrorCallback")(e,t),s.collect.emit(C.SubmitError,{type:"f_net",eventData:e,errorCode:t}),s.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_EVENT,info:"\u57cb\u70b9\u4e0a\u62a5\u7f51\u7edc\u5f02\u5e38",time:Date.now(),data:a,code:t,failType:"\u7f51\u7edc\u5f02\u5e38\u5931\u8d25",status:"fail"})},timeout:s.timeout,useBeacon:t,withCredentials:s.enable_ttwebid}),s.collect.emit(C.SubmitAfter,n)}catch(e){console.warn("something error, "+JSON.stringify(e.stack)),s.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}})))},e}(),j=function(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}().replace(/-/g,"").slice(0,19)},H=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var s=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new A(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(C.ConfigUuid,(function(e){s.setUuid(e)})),this.collect.on(C.ConfigWebId,(function(e){s.setWebId(e)})),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e=this;if(this.enableCookie){var t=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=t&&"string"==typeof t?JSON.parse(t):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(C.CustomWebId,(function(){e.tokenReady=!0,e.collect.emit(C.TokenComplete)})):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:j(),user_unique_id:this.configManager.get("user_unique_id")||j()}):this.remoteWebid()},e.prototype.checkEnv=function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram")){var t=m(window.location.href);return!(!t||!t.Web_ID||(this.complete({web_id:""+t.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+t.Web_ID}),0))}return!1},e.prototype.remoteWebid=function(){var e=this,t=this.configManager.getUrl("webid"),s={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u53d1\u8d77WEBID\u8bf7\u6c42",logType:"fetch",level:"info",time:Date.now(),data:s}),this.collect.requestManager.useRequest({url:t,data:s,success:function(t){var s;if(t&&0===t.e)s=t.web_id,e.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"WEBID\u8bf7\u6c42\u6210\u529f",logType:"fetch",level:"info",time:Date.now(),data:t});else{var i=j();s=i,e.collect.configManager.set({localWebId:i}),e.collect.emit(C.TokenError),e.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"WEBID\u8bf7\u6c42\u8fd4\u56de\u503c\u5f02\u5e38",logType:"fetch",level:"warn",time:Date.now(),data:t}),e.collect.logger.warn("appid: "+e.config.app_id+" get webid error, use local webid~")}e.complete({web_id:e.configManager.get("web_id")||s,user_unique_id:e.configManager.get("user_unique_id")||s})},fail:function(){var t=j();e.complete({web_id:e.configManager.get("web_id")||t,user_unique_id:e.configManager.get("user_unique_id")||t}),e.collect.configManager.set({localWebId:t}),e.collect.emit(C.TokenError),e.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"WEBID\u8bf7\u6c42\u7f51\u7edc\u5f02\u5e38",logType:"fetch",level:"error",time:Date.now(),data:null}),e.collect.logger.warn("appid: "+e.config.app_id+", get webid error, use local webid~")},timeout:3e5})},e.prototype.complete=function(e){var t=e.web_id,s=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:s}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(C.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",s=this.configManager.get("user_unique_id");(s||t)&&this.configManager.set({user_unique_id:s||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(C.TokenComplete)},e.prototype.setUuid=function(e){if(e&&-1===["null","undefined","Null","None"].indexOf(e)){var t=String(e),s=this.configManager.get("user_unique_id"),i=this.cacheToken&&this.cacheToken.user_unique_id;if(t===s&&t===i)return;this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(C.TokenChange,"uuid"),this.collect.emit(C.SessionReset)}else this.clearUuid()},e.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&this.configManager.get("user_unique_id")!==this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(C.TokenReset,"uuid"))},e.prototype.setWebId=function(e){if(e&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now();var t=this.configManager.get("web_id"),s=this.configManager.get("user_unique_id");s&&s!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(C.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(C.TokenChange,"webid")),this.setStorage(this.cacheToken)}},e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?(this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain),this.enable_ttwebid&&(delete e.web_id,this.storage.setItem(this.tokenKey,e))):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(){var e=this;return new Promise((function(t){e.collect.requestManager.useRequest({url:e.configManager.getUrl("tobid"),data:{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},success:function(e){e&&0===e.e?t(e.tobid):t("")},fail:function(){t("")},time:3e4,withCredentials:e.enable_ttwebid})}))},e}(),V=function(){function e(e,t){this.collector=e,this.config=t,this.requestType=t.request_type||"xhr",this.supportBeacon=!(!window.navigator||!window.navigator.sendBeacon),this.errorCode={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},this.customHeader=t.custom_request_header||{}}return e.prototype.useFetch=function(e){var t=e.url,s=e.data,i=e.method,n=e.success,a=e.fail,o={"Content-Type":"application/json; charset=utf-8"};if(Object.keys(this.customHeader).length)for(var r in this.customHeader)o[r]=this.customHeader[r];window.fetch?fetch(t,{method:i||"POST",headers:o,body:JSON.stringify(s)}).then((function(e){return e.json()})).then((function(e){n&&n(e)})).catch((function(e){a&&a(s,e)})):(this.requestType="xhr",console.log("your brwoser not support fetch, use xhr"),this.useRequest({url:t,data:s,method:i,success:n,fail:a}))},e.prototype.useBeacon=function(e){var t=e.url,s=e.data,i=e.success,n=e.fail;window.navigator.sendBeacon(t,JSON.stringify(s))?i&&i():n&&n(s,this.errorCode.BEACON_FALSE)},e.prototype.useRequest=function(e){var t=this,s=e.url,i=e.data,n=e.method,a=e.success,o=e.fail,r=e.timeout,c=e.useBeacon,l=e.withCredentials,d=e.app_key,u=e.forceXhr;if(c&&this.supportBeacon)this.useBeacon({url:s,data:i,method:n,success:a,fail:o});else if("fetch"!==this.requestType||u)try{var g=new XMLHttpRequest,h=n||"POST";if(g.open(h,""+s,!0),g.setRequestHeader("Content-Type","application/json; charset=utf-8"),d&&g.setRequestHeader("X-MCS-AppKey",""+d),Object.keys(this.customHeader).length)for(var p in this.customHeader)g.setRequestHeader(p,this.customHeader[p]);l&&(g.withCredentials=!0),r&&(g.timeout=r,g.ontimeout=function(){o&&o(i,t.errorCode.TIMEOUT)}),g.onload=function(){if(a){var e=null;if(g.responseText){try{e=JSON.parse(g.responseText)}catch(t){e={}}a(e,i)}}},g.onerror=function(){g.abort(),o&&o(i,t.errorCode.XHR_ON)},g.send(JSON.stringify(i))}catch(e){}else this.useFetch({url:s,data:i,method:n,success:a,fail:o})},e}(),K=function(){function e(e,t){if(this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,this.eventVerifyReady=!1,t.enable_debug){var s=e.adapters.storage;this.collect=e,this.config=t,this.app_id=t.app_id,this.cacheStorgae=new s(!1,"session"),this.eventVerifyInfo=[],this.sdk_type=L.includes("tob")?"tob":"inner",this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load()}}return e.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(e){console.log("devTool load fail, "+e.message)}},e.prototype.parseUrl=function(){var e={};try{var t=window.location.href.split("?")[1].split("&");t.length&&t.forEach((function(t){var s=t.split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}))}catch(e){}return e},e.prototype.load=function(){return e=this,void 0,s=function(){var e,t,s;return function(e,t){var s,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function r(a){return function(r){return function(a){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{s=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,r])}}}(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),(e=this.parseUrl()).open_devtool_web&&e.app_id){if(parseInt(e.app_id)!==this.app_id)return[2]}else if(!this.getStorage())return[2];return this.loadBaseInfo(),this.loadHook(),this.setStorage(),this.addLintener(),this.loadDebuggerModule(),this.loadDevTool(),[4,this.fetchEventInfo()];case 1:return t=i.sent(),this.sendData("devtool:web:verify",t.verifyStatus),this.eventVerifyInfo=t.data,[3,3];case 2:return s=i.sent(),console.log("debug fail, "+s.message),[3,3];case 3:return[2]}}))},new((t=void 0)||(t=Promise))((function(i,n){function a(e){try{r(s.next(e))}catch(e){n(e)}}function o(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){e.done?i(e.value):new t((function(t){t(e.value)})).then(a,o)}r((s=s.apply(e,[])).next())}));var e,t,s},e.prototype.getStorage=function(){var e=this.cacheStorgae.getItem("__applog_devtool_web");return e&&parseInt(e)===this.app_id},e.prototype.setStorage=function(){this.cacheStorgae.setItem("__applog_devtool_web",this.app_id)},e.prototype.loadDevTool=function(){this.loadScript(p("1fz22z22z1nz21z4mz4bz4bz1jz1dz4fz49z1az1bz1lz49z22z1mz21z4az19z27z22z1cz21z1az1kz4az1az1mz1kz4bz1mz19z1hz4bz21z22z18z22z1gz1az4bz1jz1mz1ez49z21z1bz1iz4bz1az1mz1jz1jz1cz1az22z4bz1bz1cz24z22z1mz1mz1jz4b")+"debug-web.0.0.2.js")},e.prototype.loadBaseInfo=function(){var e=this;this.info=[{title:"\u57fa\u672c\u4fe1\u606f",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,\u4e0a\u62a5\u57df\u540d:this.collect.configManager.getDomain(),SDK\u7248\u672c:L,SDK\u5f15\u5165\u65b9\u5f0f:"npm"}},{title:"\u7528\u6237\u4fe1\u606f",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"\u70b9\u51fb\u83b7\u53d6SSID"}},{title:"\u516c\u5171\u53c2\u6570\u4fe1\u606f",type:2,infoName:{\u6d4f\u89c8\u5668:this.collect.configManager.get("browser"),\u6d4f\u89c8\u5668\u7248\u672c:this.collect.configManager.get("browser_version"),\u5e73\u53f0:this.collect.configManager.get("platform"),\u8bbe\u5907\u578b\u53f7:this.collect.configManager.get("device_model"),\u64cd\u4f5c\u7cfb\u7edf:this.collect.configManager.get("os_name"),\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c:this.collect.configManager.get("os_version"),\u5c4f\u5e55\u5206\u8fa8\u7387:this.collect.configManager.get("resolution"),\u6765\u6e90:this.collect.configManager.get("referrer"),\u81ea\u5b9a\u4e49\u4fe1\u606f:""}},{title:"\u914d\u7f6e\u4fe1\u606f",type:3,infoName:{\u5168\u57cb\u70b9:!!this.config.autotrack,\u505c\u7559\u65f6\u957f:!!this.config.enable_stay_duration}},{title:"A/B\u914d\u7f6e\u4fe1\u606f",type:4,infoName:{"A/B\u5b9e\u9a8c":!!this.config.enable_ab_test}},{title:"\u5ba2\u6237\u7aef\u4fe1\u606f",type:3,infoName:{\u6253\u901a\u5f00\u5173:!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(C.Ready,(function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName["\u81ea\u5b9a\u4e49\u4fe1\u606f"]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["\u5df2\u66dd\u5149VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/B\u57df\u540d"]=e.config.ab_channel_domain||p(w[e.config.channel]),e.info[4].infoName["\u5168\u90e8\u914d\u7f6e"]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName["\u662f\u5426\u6253\u901a"]=!!e.collect.bridgeReport)}))},e.prototype.loadHook=function(){var e=this;this.collect.stop(),this.collect.on(l.DEBUGGER_MESSAGE,(function(t){switch(t.type){case l.DEBUGGER_MESSAGE_SDK:var s={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(s.desc={content:JSON.stringify(t.data)}),e.updateLog(s),t.secType&&"AB"===t.secType?(e.info[4].infoName["\u5df2\u66dd\u5149VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["\u5168\u90e8\u914d\u7f6e"]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case l.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var i=t.data[0],n=i.events,a=i.header;if(a.custom=JSON.parse(a.custom),!n.length)return;n.forEach((function(s){s.checkShow=!0,s.searchShow=!0,s.type=-1!==e.filterEvent.indexOf(s.event)?"sdk":"cus",s.type=e.collect.bridgeReport?"bridge":s.type,s.params=JSON.parse(s.params),"fail"===t.status&&(s.info={message:"code: "+t.code+"\uff0c msg: "+t.failType},s.failType=t.failType);var i=!1,n=!1,a=[];e.eventVerifyInfo&&e.eventVerifyInfo.length&&(e.eventVerifyInfo.forEach((function(e){e.eventStatus=!1})),e.eventVerifyInfo.forEach((function(t){s.event===t.name&&(n=!0,i=!0,s.verifyStatus=t.status,Object.keys(s.params).forEach((function(i){if("event_index"!==i){var o={};o.paramsKey=i,o.paramsKeyValue=s.params[""+i],o.paramsStatus=!1,o.paramsStatusInfo="\u5c5e\u6027\u672a\u5f55\u5165",t.params.forEach((function(t){i===t.name&&(t.checked=!0,typeof s.params[""+i]!==e.formatParamsType(t.value_type)?o.paramsStatusInfo="\u5c5e\u6027\u7c7b\u578b\u9519\u8bef\uff0c\u5e94\u4e3a"+e.formatParamsType(t.value_type):(o.paramsStatus=!0,o.paramsStatusInfo=""))})),a.push(o),o.paramsStatusInfo&&(n=!1)}})),t.params.forEach((function(e){e.checked||(n=!1,a.push({paramsKey:e.name,paramsStatus:!1,paramsStatusInfo:"\u7f3a\u5c11\u5c5e\u6027"+e.name}))})))}))),s.reportStatus="success"===t.status,s.paramsInfo=a,s.eventStatus=n&&"success"===t.status,s.eventRecord=i})),e.updateEvent(i)}return}}))},e.prototype.formatParamsType=function(e){switch(e){case 0:return"string";case 1:case 2:return"number";case 3:return"boolean"}},e.prototype.fetchEventInfo=function(){var e=this;try{return new Promise((function(t){var s=p("1fz22z22z1nz21z4mz4bz4bz18z1nz1nz1jz1mz1ez1fz1mz1kz1cz4az19z27z22z1cz1bz18z1lz1az1cz4az1lz1cz22z4bz18z1nz1nz1jz1mz1ez1bz1cz24z22z1mz1mz1jz21z4bz1mz1nz1cz1lz18z1nz1gz4bz24z4dz4bz18z1nz1nz16z1jz1mz1ez16z1kz1cz22z18")+"?app_id="+e.app_id+"&t="+e.sdk_type+"&nc=false";e.collect.requestManager.useRequest({url:s,method:"GET",success:function(s){e.eventVerifyReady=!0,e.collect.reStart(),t({data:s.data,verifyStatus:!0})},fail:function(){e.eventVerifyReady=!0,e.collect.reStart(),t({data:[],verifyStatus:!1})},timeout:3e3})}))}catch(e){return{data:[],verifyStatus:!1}}},e.prototype.addLintener=function(){var e=this;window.addEventListener("message",(function(t){if(t.origin===location.origin){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event,appid:e.app_id}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken((function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()})),t&&t.data&&t.data.type}}))},e.prototype.sendData=function(e,t){try{var s={type:e,payload:t};(window.opener||window.parent).postMessage(s,this.devToolOrigin)}catch(e){}},e.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},e.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},e.prototype.updateEvent=function(e){this.devToolReady||this.eventVerifyReady?this.sendData("devtool:web:event",e):this.event.push(e)},e.prototype.loadDebuggerModule=function(){var e="#debugger-applog-web {\n      position: fixed;\n      width: 50px;\n      height: 50px;\n      background-image: url("+p("1fz22z22z1nz21z4mz4bz4bz1jz1dz49z1az1bz1lz49z22z1mz21z4az19z27z22z1cz21z1az1kz4az1az1mz1kz4bz1mz19z1hz4bz21z22z18z22z1gz1az4bz1jz1mz1ez49z21z1bz1iz4bz1az1mz1jz1jz1cz1az22z4bz1bz1cz24z22z1mz1mz1jz4bz18z1nz1nz1jz1mz1ez4az1nz1lz1e")+");\n      bottom: 5%;\n      right: 10%;\n      cursor: pointer;\n      z-index:100;\n      background-size: 50px;\n    }",t=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.appendChild(document.createTextNode(e)),t.appendChild(s);var i=document.createElement("div");i.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web"></div>';var n=document.createElement("div");n.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(i),document.getElementsByTagName("body")[0].appendChild(n),document.getElementById("debugger-applog-web").addEventListener("click",(function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)}))},e}(),W={autotrack:{src:{cn:"",sg:"",va:""},object:"LogAutoTrack"},ab:{src:{cn:"",sg:"",va:""},object:"LogAb"},stay:{src:{cn:"",sg:"",va:""},object:"LogStay"},route:{src:{cn:"",sg:"",va:""},object:"LogRoute"},cep:{src:{cn:"",sg:"",va:""},object:"LogCep"},tracer:{src:{cn:"",sg:"",va:""},object:"LogTracer"},retry:{src:{cn:"",sg:"",va:""},object:"LogRetry"},visual:{src:{cn:"",sg:"",va:""},object:"LogVisual"}},$=["ab","autotrack","Stay","store","et","profile","cep","heartbeat","monitor","route","tracer"],J=function(){function e(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroy=!1,this.sdkReady=!1,this.adapters={},this.loadType="base",this.sdkStop=!1,this.name=e,this.hook=new u,this.remotePlugin=new Map,this.Types=C,this.adapters.storage=A,this.loadType="full"}return e.usePlugin=function(t,s,i){if(s){for(var n=!1,a=0,o=e.plugins.length;a<o;a++)if(e.plugins[a].name===s){e.plugins[a].plugin=t,e.plugins[a].options=i||{},n=!0;break}n||e.plugins.push({name:s,plugin:t,options:i})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(e,t,s){e&&("full"===this.loadType&&$.includes(e)?console.info("your sdk version has "+e+" plugin already ~"):t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:s}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},e.prototype.init=function(t){var s,i=this;this.logger=new P(this.name,t.log),this.inited?this.logger.warn("[instance: "+this.name+"], every instance's api: init,  can be call only one time!"):t&&g(t)?t.app_id&&"number"==typeof(s=t.app_id)&&!isNaN(s)?!t.app_key||function(e){return"string"==typeof e}(t.app_key)?(t.channel_domain||-1!==["cn","sg","va"].indexOf(t.channel)||(this.logger.warn("channel must be `cn`, `sg`,`va` !"),t.channel="cn"),this.spider=new q,this.spider.checkSpider(t)?this.logger.warn("your env may be a spider, can not report!"):(this.appBridge=new D(this,t.enable_native),this.requestManager=new V(this,t),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new O(this,t),this.debugger=new K(this,t),this.initConfig=t,this.emit(C.Init),this.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cINIT",data:t,level:"info",time:Date.now()}),this.destroy=!1,t.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.set({app_id:t.app_id}),this.eventManager=new F,this.tokenManager=new H,this.sessionManager=new N,Promise.all([new Promise((function(e){i.once(C.TokenComplete,(function(){e(!0)}))})),new Promise((function(e){i.once(C.Start,(function(){e(!0)}))}))]).then((function(){try{e.plugins.reduce((function(e,t){var s=t.plugin,n=t.options,a=Object.assign(i.initConfig,n),o=new s;return o.apply(i,a),e.push(o),e}),i.pluginInstances)}catch(t){console.warn("load plugin error, "+t.message),i.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:t.message})}i.sdkReady=!0,i.emit(C.Ready),i.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u521d\u59cb\u5316\u5b8c\u6210",time:Date.now(),level:"info",data:i.configManager.get("user")}),i.logger.info("appid: "+t.app_id+", userInfo:"+JSON.stringify(i.configManager.get("user"))),i.logger.info("appid: "+t.app_id+", sdk is ready, version type is "+i.loadType+", version is "+L+", you can report now !!!"),t.disable_auto_pv&&(i.disableAutoPageView=!0);try{"full"===i.loadType&&(t.enable_ab_test||t.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(t){i.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:t.message})}i.pageView(),i.on(C.TokenChange,(function(e){"webid"===e&&i.pageView(),i.logger.info("appid: "+t.app_id+" token change, new userInfo:"+JSON.stringify(i.configManager.get("user"))),i.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u8bbe\u7f6e\u4e86\u7528\u6237\u4fe1\u606f",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})})),i.on(C.TokenReset,(function(){i.logger.info("appid: "+t.app_id+" token reset, new userInfo:"+JSON.stringify(i.configManager.get("user"))),i.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u91cd\u7f6e\u4e86\u7528\u6237\u4fe1\u606f",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})})),i.on(C.RouteChange,(function(e){e.init||t.disable_route_report||i.pageView()}))})),this.tokenManager.apply(this,t),this.eventManager.apply(this,t),this.sessionManager.apply(this,t)),this.inited=!0)):this.logger.warn("app_key param is error, must be string, please check!"):this.logger.warn("app_id param is error, must be number, please check!"):this.logger.warn("init params error,please check!")},e.prototype.config=function(e){if(this.inited)if(e&&g(e))if(this.bridgeReport)this.appBridge.setConfig(e);else{e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv);var t=i({},e),s=this.initConfig.configPersist||this.initConfig.config_persist||!1;if(this.initConfig&&s){var n=this.configManager.getStore();n&&(t=Object.assign(n,e)),this.configManager.setStore(e)}t.web_id,t.user_unique_id;var a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&(s[i[n]]=e[i[n]])}return s}(t,["web_id","user_unique_id"]);this.configManager.set(a),t.hasOwnProperty("web_id")&&this.emit(C.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(C.ConfigUuid,t.user_unique_id),this.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cCONFIG",level:"info",time:Date.now(),data:t})}else console.warn("config params is error, please check");else console.warn("config must be use after function init")},e.prototype.setUserUniqueID=function(e){this.config({user_unique_id:e})},e.prototype.setHeaderInfo=function(e,t){var s={};s[e]=t,this.config(s)},e.prototype.removeHeaderInfo=function(e){var t={};t[e]=void 0,this.config(t)},e.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(C.ConfigDomain)},e.prototype.getConfig=function(e){return this.configManager.get(e)},e.prototype.send=function(){this.start()},e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.started=!0,this.emit(C.Start),this.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cSTART",level:"info",time:Date.now()}),this.bridgeReport&&(this.pageView(),this.emit(C.Ready)))},e.prototype.event=function(e,t){var s=this;try{var i=[];if(Array.isArray(e))e.forEach((function(e){var t=s.processEvent(e[0],e[1]||{});t&&i.push(t)}));else{var n=this.processEvent(e,t);if(!n)return;i.push(n)}this.bridgeReport?i.forEach((function(e){var t=e.event,i=e.params;s.appBridge.onEventV3(t,JSON.stringify(i))})):i.length&&(this.emit(C.Event,i),this.emit(C.SessionResetTime))}catch(e){this.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.beconEvent=function(e,t){if(Array.isArray(e))console.warn("beconEvent not support batch report, please check");else{var s=[],i=this.processEvent(e,t||{});i&&(s.push(i),s.length&&(this.emit(C.BeconEvent,s),this.emit(C.SessionResetTime)))}},e.prototype.beaconEvent=function(e,t){this.beconEvent(e,t)},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{if(!e)return console.warn("eventName is null\uff0c please check"),null;var s=e;/^event\./.test(e)&&(s=e.slice(6));var i=t;"object"!=typeof i&&(i={}),i.profile?delete i.profile:i.event_index=h();var n=void 0;return i.local_ms?(n=i.local_ms,delete i.local_ms):n=+new Date,{event:s,params:i,local_time_ms:n,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(s){return this.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:s.message}),{event:e,params:t}}},e.prototype.filterEvent=function(e){this.eventFilter=e},e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=function(e,t,s){this.hook.emit(e,t,s)},e.prototype.set=function(e){this.hook.set(e)},e.prototype.stop=function(){this.sdkStop=!0},e.prototype.reStart=function(){this.sdkStop=!1},e.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},e.prototype.predefinePageView=function(e){if(void 0===e&&(e={}),this.inited){var t={time:Date.now(),$is_first_time:""+(this.configManager&&this.configManager.is_first_time||!1)},s=i(i({},t),e);this.event("predefine_pageview",s)}else console.warn("predefinePageView must be use after function init")},e.prototype.clearEventCache=function(){this.emit(C.CleanEvents)},e.prototype.setWebIDviaUnionID=function(e){if(e){var t=v(e);this.config({web_id:""+t,wechat_unionid:e}),this.emit(C.CustomWebId)}},e.prototype.setWebId=function(e){this.config({web_id:""+e})},e.prototype.setWebIDviaOpenID=function(e){if(e){var t=v(e);this.config({web_id:""+t,wechat_openid:e}),this.emit(C.CustomWebId)}},e.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},e.prototype.getSessionId=function(){return G()},e.prototype.setSessionId=function(e){this.emit(C.SessionReset,e)},e.prototype.resetStayDuration=function(e,t,s){this.emit(C.ResetStay,{url_path:e,title:t,url:s},C.Stay)},e.prototype.resetStayParams=function(e,t,s){void 0===e&&(e=""),void 0===t&&(t=""),void 0===s&&(s=""),this.emit(C.SetStay,{url_path:e,title:t,url:s},C.Stay)},e.prototype.getToken=function(e,t){var s=this;if(this.inited){var n=!1,a=function(t){if(!n){n=!0;var a=s.configManager.get().user;return t&&(a.tobid=t,a["diss".split("").reverse().join("")]=t),e(i({},a))}},o=function(){s.tokenManager.getTobId().then((function(e){a(e)}))};this.sdkReady?o():(t&&setTimeout((function(){a()}),t),this.on(C.Ready,(function(){o()})))}else console.warn("getToken must be use after function init")},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(C.ProfileSet,e,C.Profile),this.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cprofileSet",level:"info",time:Date.now(),data:e})},e.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(C.ProfileSetOnce,e,C.Profile),this.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cprofileSetOnce",level:"info",time:Date.now(),data:e})},e.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(C.ProfileIncrement,e,C.Profile),this.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cprofileIncrement",level:"info",time:Date.now(),data:e})},e.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(C.ProfileUnset,e,C.Profile),this.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cprofileUnset",level:"info",time:Date.now(),data:e})},e.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(C.ProfileAppend,e,C.Profile),this.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cprofileAppend",level:"info",time:Date.now(),data:e})},e.prototype.setExternalAbVersion=function(e){this.emit(C.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,C.Ab)},e.prototype.getVar=function(e,t,s){this.emit(C.AbVar,{name:e,defaultValue:t,callback:s},C.Ab)},e.prototype.getABconfig=function(e,t){this.emit(C.AbConfig,{params:e,callback:t},C.Ab)},e.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(C.AbVersionChangeOn,e,C.Ab),function(){t.emit(C.AbVersionChangeOff,e,C.Ab)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(C.AbVersionChangeOff,e,C.Ab)},e.prototype.openOverlayer=function(){this.emit(C.AbOpenLayer,"",C.Ab)},e.prototype.closeOverlayer=function(){this.emit(C.AbCloseLayer,"",C.Ab)},e.prototype.getAllVars=function(e){this.emit(C.AbAllVars,e,C.Ab)},e.prototype.destoryInstace=function(){this.destroy||(this.destroy=!0,this.off(C.TokenComplete),this.emit(C.DestoryInstance))},e.prototype.destroyInstance=function(){this.destroy||(this.destroy=!0,this.off(C.TokenComplete),this.emit(C.DestoryInstance))},e.plugins=[],e}(),Q="__rangers_ab_style__";!function(e){e[e.Var=0]="Var",e[e.All=1]="All"}(z||(z={}));var X=function(){function e(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[]}return e.prototype.apply=function(e,t){var s=this;if(t.enable_ab_test){this.collect=e,this.config=t;var i=t.enable_multilink,n=t.ab_channel_domain,a=t.enable_ab_visual,o=t.ab_cross,r=t.ab_cookie_domain,c=t.ab_timeout,l=n||p(w[t.channel||"cn"]),d=e.adapters.storage,u=this.collect.Types;this.types=u,this.cacheStorgae=new d(!1),this.timeout=c||3e3,this.enable_multilink=i,this.enable_ab_visual=a,this.abKey="__tea_sdk_ab_version_"+t.app_id,this.ab_cross=o,this.ab_cookie_domain=r||"",this.fetchUrl=l+"/service/2/abtest_config/",this.reportUrl=""+e.configManager.getUrl("event"),this.exposureLimit=t.exposure_limit||20,this.ab_batch_time=t.ab_batch_time||500,this.ab_user_mode=t.ab_user_mode||"user_unique_id",this.collect.on(u.TokenChange,(function(e){"uuid"===e&&s.readyStatus&&(s.clearCache(),s.fetchAB())})),this.collect.on(u.TokenReset,(function(e){"uuid"===e&&s.readyStatus&&(s.clearCache(),s.fetchAB())})),this.collect.on(u.AbVar,(function(e){var t=e.name,i=e.defaultValue,n=e.callback;s.getVar(t,i,n)})),this.collect.on(u.AbAllVars,(function(e){s.getAllVars(e)})),this.collect.on(u.AbConfig,(function(e){var t=e.params,i=e.callback;s.getABconfig(t,i)})),this.collect.on(u.AbExternalVersion,(function(e){s.setExternalAbVersion(e)})),this.collect.on(u.AbOpenLayer,(function(){s.openOverlayer()})),this.collect.on(u.AbCloseLayer,(function(){s.closeOverlayer()})),this.collect.on(u.AbVersionChangeOn,(function(e){s.changeListener.set(e,e)})),this.collect.on(u.AbVersionChangeOff,(function(e){s.changeListener.get(e)&&s.changeListener.delete(e)})),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(u.AbReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var s=this.collect.hook._hooksCache[e];if(!Object.keys(s).length)return;var i=function(e){s[e].length&&s[e].forEach((function(s){t.collect.hook.emit(e,s)}))};for(var n in s)i(n)}},e.prototype.loadMode=function(){var e=function(){try{return JSON.parse(atob(window.name))||void 0}catch(e){return}}(),t="";if(e){var s=e.scenario,i=e.href;s?(this.editMode=!0,t=s):!i||-1===i.indexOf("datatester")&&-1===i.indexOf("visual-editor")||(this.editMode=!0,t="visual-editor")}this.enable_ab_visual&&"visual-editor"===t&&this.collect.destoryInstace()},e.prototype.checkLocal=function(){var e=this.getABCache(),t=e.ab_version,s=e.ab_ext_version,i=e.ab_version_multilink,n=e.data,a=this.checkFromUrl();a?this.mulilinkVersions.push(a):this.mulilinkVersions=i||[],this.extVersions=s||[],this.versions=t||[],this.data=n;var o=this.versions.concat(this.extVersions);this.enable_multilink&&(o=o.concat(this.mulilinkVersions)),this.configVersions(o.join(","))},e.prototype.checkFromUrl=function(){var e=m(window.location.href);return e&&e.vid?e.vid:""},e.prototype.updateVersions=function(){var e=this.extVersions.length?this.versions.concat(this.extVersions):this.versions;this.enable_multilink&&(e=e.concat(this.mulilinkVersions)),this.configVersions(e.join(",")),this.updateABCache(),this.changeListener.size>0&&this.changeListener.forEach((function(t){"function"==typeof t&&t(e)}))},e.prototype.configVersions=function(e){this.collect.configManager.setAbVersion(e)},e.prototype.getVar=function(e,t,s){if(!e)throw new Error("variable must not be empty");if(void 0===t)throw new Error("variable no default value");if("function"!=typeof s)throw new Error("callback must be a function");var i={name:e,defaultValue:t,callback:s,type:z.Var};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(i,e):this.callbacks.push(i)},e.prototype.getRealVar=function(e,t){var s=e.name,i=e.defaultValue,n=e.callback,a=this.data;if(a){if(g(a[s])){var o=a[s].vid;return"$ab_url"===t?this.mulilinkVersions.includes(o)||this.mulilinkVersions.push(o):this.versions.includes(o)||this.versions.push(o),this.updateVersions(),this.fechEvent(o,t,i),n(a[s].val),void this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK \u66dd\u5149\u4e86\u5b9e\u9a8c"+s,level:"info",time:Date.now(),data:a[s]})}this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK \u8c03\u7528getVar",level:"info",time:Date.now(),data:i}),n(i)}else n(i)},e.prototype.getAllVars=function(e){if("function"!=typeof e)throw new Error("callback must be a function");var t={callback:e,type:z.All};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(t):this.callbacks.push(t)},e.prototype.getRealAllVars=function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK \u8c03\u7528getAllVars",level:"info",time:Date.now(),data:this.data})},e.prototype.fechEvent=function(e,t,s){try{if(this.config.disable_track_event)return;if(!e)return;var i=this.collect.configManager.get(),n=i.header,a=i.user,o=this.getABCache(),r=a[this.ab_user_mode]||a.user_unique_id;if(o&&o.uuid&&o.uuid!==r)return;var c={event:"abtest_exposure",ab_sdk_version:""+e,params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===t?s:window.location.href}),local_time_ms:Date.now()};n.custom=JSON.stringify(n.custom);var d={events:[c],user:a,header:n};this.reportExposure(d,t)}catch(e){this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.reportExposure=function(e,t){var s=this;this.exposureCache.push(e),this.reportTimeout&&clearTimeout(this.reportTimeout),this.exposureCache.length>=this.exposureLimit?this.report(t):this.reportTimeout=setTimeout((function(){s.report(t),clearTimeout(s.reportTimeout)}),this.ab_batch_time)},e.prototype.report=function(e){var t=this;this.collect.requestManager.useRequest({url:this.reportUrl,data:this.exposureCache,timeout:2e4,useBeacon:"$ab_url"===e}),this.exposureCache.forEach((function(e){t.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_EVENT,info:"\u57cb\u70b9\u4e0a\u62a5\u6210\u529f",time:Date.now(),data:[e],code:200,status:"success"})})),this.exposureCache=[]},e.prototype.setExternalAbVersion=function(e){this.extVersions=[e],this.updateVersions()},e.prototype.getABconfig=function(e,t){var s=Object.keys(e);s&&s.length&&this.collect.configManager.set(e),this.fetchAB(t)},e.prototype.get=function(e){if(this.ab_cross){var t=this.cacheStorgae.getCookie(e,this.ab_cookie_domain);return t?JSON.parse(t):{}}return this.cacheStorgae.getItem(e)},e.prototype.set=function(e,t){this.ab_cross?this.cacheStorgae.setCookie(e,t,2592e6,this.ab_cookie_domain):this.cacheStorgae.setItem(e,t),this.collect.configManager.setAbCache(t)},e.prototype.getABCache=function(e){var t={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""};return t=this.get(this.abKey)||t,e?t[e]:t},e.prototype.updateABCache=function(){var e=this.getABCache();e.ab_version_multilink=this.mulilinkVersions,e.ab_ext_version=this.extVersions,e.ab_version=this.versions,e.timestamp=Date.now(),this.set(this.abKey,e)},e.prototype.setAbCache=function(e){var t=this.getABCache();t.data=this.data,t.uuid=e,t.timestamp=Date.now(),this.set(this.abKey,t)},e.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[],this.collect.configManager.clearAbCache()},e.prototype.openOverlayer=function(e){var t=this;if(function(){if(!document.getElementById(Q)){var e="body { opacity: 0 !important; }",t=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.id=Q,s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e)),t.appendChild(s)}}(),e)var s=setTimeout((function(){t.closeOverlayer(),clearTimeout(s)}),e)},e.prototype.closeOverlayer=function(){var e;(e=document.getElementById(Q))&&e.parentElement.removeChild(e)},e.prototype.fetchComplete=function(e,t){var s=this;try{if(e&&"[object Object]"==Object.prototype.toString.call(e)){this.data=e,this.setAbCache(t);var i=[];Object.keys(e).forEach((function(t){var s=e[t].vid;s&&i.push(s)})),this.versions=this.versions.filter((function(e){return i.includes(e)}));var n=e.$ab_url,a=e.$ab_modification;if(a&&a.val&&this.enable_ab_visual){if(this.collect.destroy)return}else if(n&&this.enable_multilink){this.mulilinkVersions=this.mulilinkVersions.filter((function(e){return i.includes(e)}));var o=n.val,r=n.vid;o&&r&&this.getVar("$ab_url",o,(function(){s.editMode||(o!==window.location.href?setTimeout((function(){if(!s.collect.destroy){var e=""+o;e=-1===e.indexOf("http")?"https://"+e:e,_(e).host!==location.host?e=e+"&vid="+r:window.history.replaceState("","",e),window.location.href=e}}),100):s.closeOverlayer())}))}this.updateVersions()}else this.closeOverlayer();this.callbacks.forEach((function(e){return s[e.type===z.Var?"getRealVar":"getRealAllVars"](e,"")})),this.callbacks=[]}catch(e){}},e.prototype.fetchAB=function(e){var t=this,s=this.collect.configManager.get(),n={header:i(i(i({aid:this.config.app_id},s.user||{}),s.header||{}),{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:window.location.href})};this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"SDK \u53d1\u8d77AB\u5b9e\u9a8c\u8bf7\u6c42",level:"info",logType:"fetch",time:Date.now(),data:n});var a=s.user[this.ab_user_mode]||s.user.user_unique_id;this.collect.requestManager.useRequest({url:this.fetchUrl,data:n,success:function(s){t.fetchStatus="complete",t.refreshFetchStatus="complete";var i=s.data;"success"===s.message?(t.fetchComplete(i,a),e&&e(i)):(t.fetchComplete(null,a),e&&e(null)),t.collect.emit(t.types.AbComplete,i),t.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB\u5b9e\u9a8c\u8bf7\u6c42\u6210\u529f",level:"info",logType:"fetch",time:Date.now(),data:i})},fail:function(){t.fetchStatus="complete",t.refreshFetchStatus="complete",t.fetchComplete(null,a),t.collect.emit(t.types.AbTimeout),e&&e(null),t.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB\u5b9e\u9a8c\u8bf7\u6c42\u7f51\u7edc\u5f02\u5e38",level:"error",logType:"fetch",time:Date.now()})},timeout:this.timeout})},e}(),Z="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null,Y=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach((function(t,s){if("sdk"===t)if(W.hasOwnProperty(s)){var i=W[s].object,n=W[s].src[e.channel]+"?query="+Date.now();e.exist(s,i,n)}else console.warn("your "+s+" is not exist\uff0cplease check plugin name");else"object"==typeof t&&(t.src?e.exist(s,t.call,t.src):e.process(s,t.instance,"INSTANCE"))}))}catch(e){this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message}),console.log("load extend error")}},e.prototype.exist=function(e,t,s){var i=this;Z[t]?(this.process(e,Z[t]),console.log("\u5df2\u6709"+e+"\u63d2\u4ef6\uff0c\u907f\u514d\u91cd\u590d\u52a0\u8f7d~")):this.loadPlugin(e,s,(function(){i.process(e,Z[t]),console.log(" %c %s %s %s","color: yellow; background-color: black;","\u2013","load plugin:"+e+" success","-")}),(function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","\u2013","load plugin:"+e+" error","-")}))},e.prototype.process=function(e,t,s){try{if(s){var i=new t;i.apply&&i.apply(this.collect,this.config),console.log("excude "+e+" success")}else t&&t(this.collect,this.config)}catch(t){this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:t.message}),console.log("excude "+e+" error, message:"+t.message)}},e.prototype.loadPlugin=function(e,t,s,i){var n=this;try{var a=document.createElement("script");a.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(s),a.onerror=function(){i(t)},a.onload=function(){n._plugin[e].forEach((function(e){e()}))},document.getElementsByTagName("head")[0].appendChild(a)}catch(e){this.collect.emit(l.DEBUGGER_MESSAGE,{type:l.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e}();J.usePlugin(Y,"extend"),J.usePlugin(X,"ab");const ee=new J("default")},60779:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(75012);const n=e=>{const t=(0,i.c)(e);return{onMessage:{addListener:t.onMessage.addListener.bind(t.onMessage)},postMessage:t.postMessage.bind(t),formatMessage:e=>e}}},82741:(e,t,s)=>{s.d(t,{Y:()=>a});var i=s(89996),n=s(57512);const a=e=>(0,i.r)(e,(0,n.TK)(e))},30715:(e,t,s)=>{s.d(t,{e:()=>o});var i=s(46487),n=s(30949),a=s(82741);const o=(e=!1)=>{const t=(0,n.B)(),[s]=(0,a.Y)("launchInfo"),{languageList:o}=s;let r=[...o||[]];if(e){r=[{language_code:i.Aq,language:t("follow_browser_language"),language_loc:t("follow_browser_language")},...r]}return r.length?r:void 0}},75012:(e,t,s)=>{s.d(t,{c:()=>a});var i=s(42325);const n=new Map,a=e=>{const t=n.get(e);if(t)return t;const s=(0,i.Gj)().connect({name:e});return n.set(e,s),s}},62745:(e,t,s)=>{s.d(t,{Qz:()=>r});var i=s(44557),n=s(10633),a=s(34847);class o{constructor(e){(0,n.A)(this,"markersInOrder",[]),(0,n.A)(this,"performanceMeasureAcc",(e=>this.performanceMeasure(e,this._startMarker))),(0,n.A)(this,"performanceMeasure",((e,t)=>{try{return performance.measure(this.name,this.getMarkName(t),this.getMarkName(e)).duration}catch(s){return-1}})),(0,n.A)(this,"eventName",""),(0,n.A)(this,"name",""),(0,n.A)(this,"_startTime",0),(0,n.A)(this,"_startMarker","mark_start"),(0,n.A)(this,"_endMarker","mark_end"),this.eventName=e,this.name=`${e}_${Math.random().toString(32).slice(2,6)}`}get markEntries(){return this.markersInOrder.forEach((e=>performance.getEntriesByName(e)))}getMarkName(e){return`${this.name}:${e}`}get measureEntries(){return performance.getEntriesByName(this.name)}clean(){this.markersInOrder.forEach((e=>performance.clearMarks(e))),performance.clearMeasures(this.name),this.markersInOrder=[]}get origin(){return performance.timeOrigin}now(){return performance.timeOrigin+performance.now()}get startTime(){return this._startTime}start(e=this._startMarker){this.clean();const t=this.mark(e);this._startTime=t.startTime,this._startMarker=e}mark(e){return this.markersInOrder.push(e),performance.mark(this.getMarkName(e))}end(e=this._endMarker,t={}){this.mark(e),this._endMarker=e,this.report(t)}get timing(){const e={startTime:this.startTime,origin:this.origin,duration:this.duration};if(this.markersInOrder.length>=1)for(let t=1;t<this.markersInOrder.length;t++){const s=this.markersInOrder[t];e[s]=this.performanceMeasureAcc(s)}return e}get duration(){return this.performanceMeasureAcc(this._endMarker)}toJSON(){return JSON.stringify(this.timing)}toMetrics(){return this.timing}toCategories(){return this.markersInOrder.reduce(((e,t)=>(0,i.A)((0,i.A)({},e),{},{[t]:t})),{})}report(e={}){const t=(0,a.Gl)();null==t||t.reportCustomPerfEvent({name:this.eventName,metrics:this.toMetrics(),categories:e})}}const r=new class{constructor(){(0,n.A)(this,"recorders",void 0),this.recorders=new Map}create(e,t=!1){this.remove(e);const s=new o(e);return t&&s.start(),this.recorders.set(e,s),s}get(e){return this.recorders.get(e)}remove(e){this.recorders.delete(e)}report(e){const t=this.get(e);t&&t.report()}};window._perfRecorder=r},2393:(e,t,s)=>{s.d(t,{C9:()=>c,bc:()=>r,fW:()=>a,wG:()=>o});var i=s(44557);const n={web_search:{count:0},web_ask:{count:0},web_translate:{count:0},web_explain:{count:0},web_grammar:{count:0},web_rewrite:{count:0},web_video_summary:{count:0},web_summary:{count:0},web_translatePage:{count:0},web_gmail:{count:0},web_podcast_summary:{count:0},sidebar_pdf_summary:{count:0},sidebar_pdf_highlight:{count:0}},a=Object.keys(n),o=()=>n,r=["web_ask","web_translate","web_translatePage"],c=Object.keys(n).reduce(((e,t)=>(0,i.A)((0,i.A)({},e),{},{[t]:r.includes(t)?10:Number.MAX_SAFE_INTEGER})),{})},44377:(e,t,s)=>{s.d(t,{X:()=>r});var i=s(44557),n=s(14065),a=s(54096),o=s(43523);const r=function(){var e=(0,n.A)((function*(e){const t=Object.keys(e),s=yield Promise.all(t.map((e=>o.A.get(e))));for(let i=0;i<t.length;i++)void 0!==s[i]&&(0,a.A)(e,t[i],s[i]);const n=t.reduce(((t,s)=>(0,i.A)((0,i.A)({},t),{},{[s]:t=>{(0,a.A)(e,s,t.newValue)}})),{});return o.A.watch(n),()=>{o.A.unwatch(n)}}));return function(t){return e.apply(this,arguments)}}()},97637:(e,t,s)=>{s.d(t,{K:()=>r});var i=s(8719),n=s(71786),a=s(25508),o=s(71291);const r=(0,i.n)({httpClient:n.o,getCommonParams:o.wH,baseURL:a.C1})},49508:(e,t,s)=>{s.d(t,{v:()=>l});var i=s(14065),n=s(46487),a=s(40165),o=s(42325),r=s(10992);const c=function(){var e=(0,i.A)((function*(e){try{const{infos:t}=yield(0,r.jI)(e);return t.map((e=>e.lang_code))}catch(t){}}));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=(0,i.A)((function*(e=""){let t="";try{if(e.length<200){var s;t=(null===(s=yield c([e]))||void 0===s?void 0:s[0])||""}else{const s=yield(0,o.od)(e);var i;if(s.isReliable)t=s&&(0,a.S)(s)||"";else t=(null===(i=yield c([e]))||void 0===i?void 0:i[0])||""}}catch(r){return""}return(0,n.wz)(t)}));return function(){return e.apply(this,arguments)}}()},73317:(e,t,s)=>{s.d(t,{k:()=>o});var i=s(97724),n=s(57512),a=s(39853);const o=e=>{const t={user_context:{locale:(0,n.TK)("uiLanguage"),timezone:(0,a.O)()}};return(0,i.A)(t,e)}},75351:(e,t,s)=>{s.d(t,{_:()=>b,y:()=>S});var i=s(44557),n=s(21919),a=s(46487),o=s(26106),r=s(73317),c=s(30896),l=s(80911),d=s(56819),u=s(45319),g=s(25508),h=s(32201),p=s(12893),_=s(57512),m=s(22315),v=s(62745),f=s(7728);const y=e=>{var t;const{prompt:s="search",language:n=navigator.language,answerWithSuggest:o=!1,replyLang:l,userQueryContent:d="",browser_language:u,browser_youtube_transcript:g,browser_plugin_info:p,flag_page_translate:v,browser_mail:f="",input_skill:y="",isUserCustomSkill:b=!1,contextText:S="",translateService:k=h.c$.HUOSHAN}=e,M=null!==(t=(0,a.wz)((0,_.TK)("uiLanguage")))&&void 0!==t?t:navigator.language,A={origin:"",stream:"1",answer_with_suggest:o?"1":"0",flag_browser_plugin:"1",browser_language:null!=l?l:M};if(S&&(A.samantha_context=JSON.stringify((0,r.k)({query_context:{web_content:S}}))),b)return(0,i.A)((0,i.A)({},A),{},{browser_plugin_info:JSON.stringify({frontend_source:"plugin",custom_prompt_skill_id:s,lang:null!=l?l:M})});if(s===m.EU.youtube)return(0,i.A)((0,i.A)({},A),{},{browser_language:null!=u?u:M},g);let E="{}";return s===m.EU.translate?(A.browser_plugin_info=JSON.stringify({translate_service:(0,c.w)(k),frontend_source:"plugin"}),E=n):s===m.EU.ask?E=JSON.stringify({query:d}):s===m.EU.mail?E=f:s===m.EU.browser_plugin_info?E=p||"":s===m.EU.input_skill&&(E=y||""),(0,i.A)((0,i.A)({},A),{},{[s]:E,flag_page_translate:v?"1":"0"})};function b(e,t){var s,a;const{text:r="",prompt:c="search",replyId:h="",isRegenerate:b=!1,enter_chat_method:S,current_page:k="",scene:M="",sec_scene:A,trackEvent:E=!0}=e,w=(0,u.AP)(),I={id:w},L=v.Qz.create("cici_stream_reply_perf");null==L||L.start("request_start");const R={event_type:1,message:{conversation_id:"0",section_id:"0",local_message_id:w,content_type:1,content:JSON.stringify({text:r}),reply_id:h,ext:y(e),local_conversation_id:"0",bot_id:null!==(s=null===(a=(0,_.ue)())||void 0===a?void 0:a.assistantBotId)&&void 0!==s?s:"7241547611541340167",meta_infos:[]}};var z,C;b&&(null!==(z=R.message)&&void 0!==z&&z.ext&&(R.message.ext.regen="1"));E&&(null===(C=l.Ay.Tea)||void 0===C||C.event("send_message",{conversation_id:(0,p.IK)().convId,enter_chat_method:S,current_page:k,scene:M,sec_scene:A}));return f.B.fetch({req:{url:`https://${g.FI}/alice/message/stream_call_bot`,body:{payload:(0,n.lF)(JSON.stringify(R))}}},{id:w,onOpen:e=>{var s;Object.assign(I,e),null==L||L.mark("response_open"),null==t||null===(s=t.onOpen)||void 0===s||s.call(t,e,I)},onUpdate:e=>{var s,n;const{message_id:a="",reply_id:r="",content:c="{}"}=(null===(s=e.body)||void 0===s?void 0:s.message)||{};if("0"===r){var d,u;if(E)null===(u=l.Ay.Tea)||void 0===u||u.event("send_message_status",{message_id:a,enter_chat_method:S,current_page:k,scene:M,sec_scene:A,success:1});return null==L||L.mark("response_first_message"),void(null==t||null===(d=t.onUpdate)||void 0===d||d.call(t,e,I))}let{text:g="",suggests:h=[]}=I;try{var p;const e=JSON.parse(c);e.text&&(g=`${g}${e.text}`),null!==(p=e.suggest)&&void 0!==p&&p.length&&(0===h.length&&(null==L||L.mark("response_first_suggest")),h=h.concat(e.suggest))}catch(_){o.vF.persist.info({eventName:"[SEARCH_CORE] - UPDATE",meta:(0,i.A)({},_)}),console.error("parse message content error",e,_)}Object.assign(I,(0,i.A)((0,i.A)({},e),{},{text:g,suggests:h})),null==t||null===(n=t.onUpdate)||void 0===n||n.call(t,e,I)},onDone:s=>{var i,n,a,o;E&&(null===(a=l.Ay.Tea)||void 0===a||a.event("receive_stream",{message_id:null===(o=I.body)||void 0===o||null===(o=o.message)||void 0===o?void 0:o.message_id,message_type:"text",scene:M,success:1}));const r=c===m.EU.browser_plugin_info&&"search"===(0,d.O)(e.browser_plugin_info,{}).skill_name?"search":c;null==L||L.end("response_end",{prompt:r,hasSuggest:""+(null!=I&&null!==(i=I.suggests)&&void 0!==i&&i.length?1:0)}),null==t||null===(n=t.onDone)||void 0===n||n.call(t,s,I)},onError:e=>{var s,n,a;(o.vF.persist.info({eventName:"[SEARCH_CORE] - ERROR",meta:(0,i.A)({},new Error(`search error - id: ${I.id} - msg: ${I.text}`))}),E)&&(null===(n=l.Ay.Tea)||void 0===n||n.event("send_message_status",{message_id:null===(a=I.body)||void 0===a||null===(a=a.message)||void 0===a?void 0:a.message_id,enter_chat_method:S,current_page:k,scene:M,sec_scene:A,success:0}));null==t||null===(s=t.onError)||void 0===s||s.call(t,e,I)},onAbort:e=>{var s;o.vF.persist.info({eventName:"[SEARCH_CORE] - ABORT",meta:(0,i.A)({},I)}),null==t||null===(s=t.onAbort)||void 0===s||s.call(t,e,I)}}),w}function S(e,t){f.B.abort(e,t)}},47647:(e,t,s)=>{s.d(t,{$:()=>c});var i=s(44557),n=s(98502),a=s(89565),o=s(26106);const r={botMap:{},botIdToLocalConversationMap:{},botIdToRequestIdMap:{}},c=(...e)=>(0,i.A)({},((e,t)=>(a.I.push((()=>e(r))),(0,i.A)((0,i.A)({},r),{},{updateBot:t=>{const{bot_id:s,id:a}=t,r=s||a;r?e((0,n.jM)((e=>{e.botMap[r]=(0,i.A)((0,i.A)({},e.botMap[r]||{}),t)}))):o.vF.persist.warning({message:"invalid botInfo to update",meta:{botInfo:t}})},getBot:e=>t().botMap[e],getBotIdFromLocalConversation:e=>{const{botIdToLocalConversationMap:s}=t();for(const t in s)if(s[t]===e)return t},getBotIdToLocalConversationMap:()=>t().botIdToLocalConversationMap,getBotIdToRequestIdMap:()=>t().botIdToRequestIdMap,setLocalConversationIdForBot:({botId:t,localConversationId:s})=>{e((0,n.jM)((e=>{e.botIdToLocalConversationMap[t]=s})))},initRecommendBotList:()=>{console.log("initRecommendBotList")}})))(...e))},52335:(e,t,s)=>{s.d(t,{l:()=>d});var i=s(44557),n=s(34870),a=s(45498),o=s(474),r=s(73648),c=s(69366);const l={isShowSidebar:!1,isShowSidebarBtn:!0,isShowSearch:!0,isShowQuick:!0,isShowVideo:!0,enterSidebarMode:o.cz.clickSidebar,showTip:!0,isSidePanelMode:!1},d=(0,a.vt)()((0,n.eh)(((e,t)=>(0,i.A)((0,i.A)({},l),{},{setIsShowSidebar:(s,i)=>e((()=>t().isSidePanelMode?((0,c.c)(s?"open-side-panel":"close-side-panel"),{isShowSidebar:!1,enterSidebarMode:i}):{isShowSidebar:s,enterSidebarMode:i})),toggleShowSidebar:s=>e((e=>{if(t().isSidePanelMode)return(0,c.c)("toggle-side-panel"),{isShowSidebar:!1,enterSidebarMode:s};return{isShowSidebar:!e.isShowSidebar,enterSidebarMode:s}})),setIsShowSidebarBtn:t=>e((()=>({isShowSidebarBtn:t}))),setIsShowSearch:t=>e((()=>({isShowSearch:t}))),setIsShowQuick:t=>e((()=>({isShowQuick:t}))),setIsShowVideo:t=>e((()=>({isShowVideo:t}))),setTipVisible:t=>e((()=>({showTip:t}))),setIsSidePanelMode:t=>e({isSidePanelMode:t})}))));r.m.getInstance().registerStore("useLayoutStore",d)},90720:(e,t,s)=>{s.d(t,{z:()=>l,g:()=>r});var i=s(474),n=s(80911);let a=function(e){return e.UPPER_RIGHT="upper_right",e.SUBSCRIBED="subscribed",e.ONBOARDING="onboarding",e.IMMERSION_FULLSCREEN_BTN="fullscreen_click",e.VIDEO_DB_CLICK="video_dbclick",e.IMMERSION_FULLSCREEN_SHORT_CUT="shortcut",e.IMMERSION_BTN="immersion_click",e.WATCH_RELAY="watch_relay",e.recommendVideo="recommendvideo_list_click",e.playNext="next_button",e.recommendVideoEnding="recommendvideo_ending_click",e}({});const o=e=>{var t;null===(t=n.Ay.Tea)||void 0===t||t.event(i.Ur.viewDAU,{current_page:null==e?void 0:e.current_page,show_from:null==e?void 0:e.show_from})},r=(e,t)=>{t.show_from=e,e===i.Ur.enterPage&&(null==t?void 0:t.current_page)===i.g6.chat&&(t.show_from="enter_page_chat",o(t)),e===i.Ur.showSelectAssistantMenu&&o(t),e===i.Ur.showSearchAssistant&&o(t),e===i.Ur.showVideoAssistant&&o(t),e===i.Ur.showChatAssistant&&o(t),e===i.Ur.showMailEntryButton&&o(t),e===i.Ur.collectionButtonShow&&o(t)},c=e=>{var t;null===(t=n.Ay.Tea)||void 0===t||t.event(i.Ur.activeDAU,{current_page:null==e?void 0:e.current_page,button_name:null==e?void 0:e.button_name,click_from:null==e?void 0:e.click_from})},l=(e,t)=>{if((e===i.Ur.copy||e===i.Ur.regenerate||e===i.Ur.continueInChat||e===i.Ur.retry)&&(null==t?void 0:t.click_from)===i.Z5.selectAssistantResult)return t.click_from=i.Z5.selectAssistantMenu,void c(t);e!==i.Ur.copy&&e!==i.Ur.regenerate&&e!==i.Ur.continueInChat&&e!==i.Ur.retry&&e!==i.Ur.clickSearchAssistantSuggest||c(t),e!==i.Ur.clickSelectAssistantMenuBtn&&e!==i.Ur.clickSelectAssistantResultBtn||(t.click_from=i.Z5.selectAssistantMenu,c(t)),e===i.Ur.clickVideoAssistantSummarizeBtn&&(t.click_from!==a.IMMERSION_BTN&&t.click_from!==a.UPPER_RIGHT&&t.click_from!==a.ONBOARDING||(t.click_from=i.Z5.videoAssistant,c(t))),e!==i.Ur.clickVideoImmersionGuideTips&&e!==i.Ur.clickVideoImmersionGuideIcon&&e!==i.Ur.immersionTimeLine||(t.click_from=i.Z5.videoAssistant,c(t)),e===i.Ur.clickChatAssistantPopover&&(null==t?void 0:t.button_name)===i._h.translatePage&&c(t),e===i.Ur.clickChatAssistantPopoverSettings&&(null==t?void 0:t.button_name)===i._h.alwaysTranslatePage&&c(t),e===i.Ur.sendMessage&&(null==t?void 0:t.current_page)===i.g6.chat&&(t.click_from=i.Z5.sendMessageInChat,c(t)),e===i.Ur.clickMailEntryButton&&(t.click_from=i.Z5.mailEntryButton,c(t)),e===i.Ur.collectionButtonClickSave&&c(t)}},32201:(e,t,s)=>{s.d(t,{c$:()=>n.c$,lG:()=>i.l,th:()=>n.th});var i=s(33143),n=s(93507)},40165:(e,t,s)=>{s.d(t,{S:()=>n});var i=s(48485);function n(e,t=70){const{languages:s,isReliable:n}=e;if(!n)return;const a=(0,i.A)(s,(e=>e.percentage>=t));return a?a.language:void 0}},56819:(e,t,s)=>{s.d(t,{O:()=>i});const i=(e,t)=>{try{return e?JSON.parse(e):t}catch(s){return t}}},56027:(e,t,s)=>{s.d(t,{M:()=>r,u:()=>d});var i=s(77793),n=s(15510),a=s(566);const o=["block","flow-root","grid","list-item","flex","-webkit-box","table","table-row-group","table-row"],r=e=>{const t=(0,i.A)();e.setAttribute("data-cici-select-uid",t);for(const s of e.children)r(s)};function c(e){const t=(0,n.D6)(e);return o.includes((null==t?void 0:t.display)||"inline")||"br"===e.tagName.toLowerCase()}function l(e){for(const t of e.children){if(c(t))return!0;if(t.children.length>0)return l(t)}return!1}const d=e=>{const t=[];let s=[];return function e(i){for(const n of i)(0,a.mp)(n)&&(n instanceof Text&&(/^[\n\s]*$/.test(n.textContent||"")||s.push(n)),n instanceof Element&&(c(n)&&!l(n)?(s.push(n),t.push(s),s=[]):l(n)?e(Array.from(n.childNodes)):(/^[\n\s]|[\n\s]*$/.test(n.textContent||"")&&s.length>0&&(t.push(s),s=[]),s.push(n))))}(e),s.length&&t.push(s),t}},30896:(e,t,s)=>{s.d(t,{w:()=>n});var i=s(32201);function n(e){switch(e){case i.c$.HUOSHAN:return i.th.HUOSHAN;case i.c$.GOOGLE:return i.th.GOOGLE;default:return i.th.LLM}}},75522:(e,t,s)=>{s.d(t,{G:()=>u});var i=s(10633),n=s(42579),a=s.n(n),o=s(36266),r=s(45286),c=s.n(r),l=s(29654);const d=c();class u{constructor(e){var t,s,n;(0,i.A)(this,"imageConfig",void 0),(0,i.A)(this,"fileConfig",void 0),(0,i.A)(this,"user_id",void 0),(0,i.A)(this,"client",void 0),(0,i.A)(this,"useDirectUpload",void 0),(0,i.A)(this,"callbackMap",{});const{imageConfig:a,fileConfig:o,userId:r,appId:c,useDirectUpload:l=!1}=e;this.imageConfig=a,this.fileConfig=o,this.user_id=r,this.client=new d({appId:c,userId:r,imageHost:`https://${null==a?void 0:a.upload_host}`,imageFallbackHost:`https://${null==a?void 0:a.upload_host}`,imageConfig:{serviceId:(null==a?void 0:a.service_id)||""},objectConfig:{serviceId:null==o?void 0:o.service_id},useFileExtension:!0}),this.useDirectUpload=l,null===(t=this.client)||void 0===t||t.on("complete",this.onUploadComplete.bind(this)),null===(s=this.client)||void 0===s||s.on("error",this.onUploadError.bind(this)),null===(n=this.client)||void 0===n||n.on("progress",this.onUploadProgress.bind(this))}updateImageConfig(e){var t,s;this.imageConfig=e,null===(t=this.client)||void 0===t||t.setOption({imageHost:`https://${null==e?void 0:e.upload_host}`,imageConfig:{serviceId:(null==e?void 0:e.service_id)||""}}),null===(s=this.client)||void 0===s||s.refreshSTSToken(this.stsToken)}updateFileConfig(e){this.fileConfig=e}get imageConfigExpired(){var e;const t=a()(),s=a()(null===(e=this.imageConfig)||void 0===e||null===(e=e.auth)||void 0===e?void 0:e.expired_time);return t.isAfter(s)}get fileConfigExpired(){var e;const t=a()(),s=a()(null===(e=this.fileConfig)||void 0===e||null===(e=e.auth)||void 0===e?void 0:e.expired_time);return t.isAfter(s)}get stsToken(){var e,t,s,i,n;return{CurrentTime:(null===(e=this.imageConfig)||void 0===e||null===(e=e.auth)||void 0===e?void 0:e.current_time)||"",ExpiredTime:(null===(t=this.imageConfig)||void 0===t||null===(t=t.auth)||void 0===t?void 0:t.expired_time)||"",SessionToken:(null===(s=this.imageConfig)||void 0===s||null===(s=s.auth)||void 0===s?void 0:s.session_token)||"",AccessKeyId:(null===(i=this.imageConfig)||void 0===i||null===(i=i.auth)||void 0===i?void 0:i.access_key_id)||"",SecretAccessKey:(null===(n=this.imageConfig)||void 0===n||null===(n=n.auth)||void 0===n?void 0:n.secret_access_key)||""}}get fileStsToken(){var e,t,s,i,n;return{CurrentTime:(null===(e=this.fileConfig)||void 0===e||null===(e=e.auth)||void 0===e?void 0:e.current_time)||"",ExpiredTime:(null===(t=this.fileConfig)||void 0===t||null===(t=t.auth)||void 0===t?void 0:t.expired_time)||"",SessionToken:(null===(s=this.fileConfig)||void 0===s||null===(s=s.auth)||void 0===s?void 0:s.session_token)||"",AccessKeyId:(null===(i=this.fileConfig)||void 0===i||null===(i=i.auth)||void 0===i?void 0:i.access_key_id)||"",SecretAccessKey:(null===(n=this.fileConfig)||void 0===n||null===(n=n.auth)||void 0===n?void 0:n.secret_access_key)||""}}onUploadComplete(e){var t,s;this.callbackMap[e.key]&&(null===(t=this.callbackMap[e.key])||void 0===t||null===(s=t.complete)||void 0===s||s.call(t,e),delete this.callbackMap[e.key])}onUploadError(e){var t,s;this.callbackMap[e.key]&&(null===(t=this.callbackMap[e.key])||void 0===t||null===(s=t.error)||void 0===s||s.call(t,e))}onUploadProgress(e){var t,s;null===(t=this.callbackMap[e.key])||void 0===t||null===(s=t.progress)||void 0===s||s.call(t,e)}uploadImage(e,t){if(!this.client)return;o.vF.persist.log({eventName:"imagex_upload_image_client_addImageFile",meta:{file_size:e.size,file_name_length:(0,l.p)("name")(e).length}});const s=this.client.addImageFile({file:e,stsToken:this.stsToken,type:"image",useDirectUpload:this.useDirectUpload});this.callbackMap[s]=t,this.client.start(s)}uploadFile(e,t){if(!this.client)return;o.vF.persist.log({eventName:"imagex_upload_image_client_addFile",meta:{file_size:e.size,file_name_length:(0,l.p)("name")(e).length}});const s=this.client.addFile({file:e,stsToken:this.fileStsToken,type:"object",useDirectUpload:this.useDirectUpload});this.callbackMap[s]=t,this.client.start(s)}}},89565:(e,t,s)=>{s.d(t,{I:()=>a});var i=s(10633),n=s(36266);const a=new class{constructor(){(0,i.A)(this,"resetters",[])}push(e){this.resetters.push(e)}resetAllSlice(){n.vF.persist.info("reset_chat_store"),this.resetters.forEach((e=>e()))}}},77058:(e,t,s)=>{s.d(t,{n:()=>i});const i=e=>{var t;return(null==e||null===(t=e._meta)||void 0===t?void 0:t.logId)||""}},11003:(e,t,s)=>{s.d(t,{C:()=>o});var i=s(33451),n=s(10633);const a=["useBotInfo"];class o{static init(e){let{useBotInfo:t}=e,s=(0,i.A)(e,a);this._getter=s,this._useBotInfo=t}static get actions(){if(!this._getter)throw Error("FlowBot.actions has not initialized");return this._getter}static useBotInfo(e){var t;return null===(t=this._useBotInfo)||void 0===t?void 0:t.call(this,e)}}(0,n.A)(o,"_getter",void 0),(0,n.A)(o,"_useBotInfo",void 0)},9530:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(10633);class n{static init(e,t){this._getter=e,this._isEnableDebug=t}static get hasInit(){return!!this._getter}static get config(){if(!this._getter)throw Error("FlowConfig.config has not initialized");return this._getter()}static get userId(){return this.config.userId}static get storedUserId(){return this.config.storedUserId||""}static get loginSource(){return this.config.loginSource||""}static get lastLandingConversationId(){return this.config.lastLandingConversationId}static get enterChatMethod(){return this.config.enterChatMethod||""}static get appId(){return this.config.appId}static get answerWithSuggest(){var e;return null===(e=this.config.answerWithSuggest)||void 0===e||e}static get namedEntityHighlight(){var e;return null!==(e=this.config.namedEntityHighlight)&&void 0!==e&&e}static get answerWithVideo(){var e;return null!==(e=this.config.answerWithVideo)&&void 0!==e&&e}static get localFeatureConfig(){return this._isEnableDebug?this.config.localFeatureConfig:{}}static get isGuest(){var e;return null!==(e=this.config.isGuest)&&void 0!==e&&e}static get isGuestAndNewChatDisable(){var e;return null!==(e=this.config.isGuestAndNewChatDisable)&&void 0!==e&&e}static createUploader(e){return this.config.createUploader(e)}}(0,i.A)(n,"_getter",void 0),(0,i.A)(n,"_isEnableDebug",void 0)},31317:(e,t,s)=>{s.d(t,{E:()=>n});var i=s(9012);const n=e=>({onboarding_content_source:(0,i.A)(e,"ext.onboarding_content_source","")})},29654:(e,t,s)=>{s.d(t,{p:()=>a});var i=s(28159),n=s(9012);const a=e=>t=>{const s=(0,n.A)(t,e);return(0,i.A)(s)?s:""}},5817:(e,t,s)=>{s.d(t,{H:()=>n});var i=s(10633);class n{static init(e){this._tracker=e}static checkInit(){if(!this._tracker)throw Error("Global FlowTea has not initialized")}static trackEvent(e,t,s){this.checkInit(),this._tracker(e,t,s)}}(0,i.A)(n,"_tracker",void 0)},37498:(e,t,s)=>{function i(e){return e?{web_id:e.web_id,tt_wid:e.ttwid}:{}}s.d(t,{D:()=>i})},35706:(e,t,s)=>{s.d(t,{_:()=>h});var i=s(35754),n=s(89380),a=s(86652),o=s(29654),r=s(51187);const c=e=>{if("image_key"in e)return{type:"attachment",fileKey:e.image_key,fileName:"Image"};if("image"in e&&e.local_key){const t=(0,r.mf0)(r.ozw.getState(),e.local_key);if(t)return{type:"attachment",fileKey:t,fileName:(0,o.p)("name")(e.image)||"Image"}}},l=e=>{if("file_key"in e){const t=e.file_name||"";return{type:"attachment",fileKey:e.file_key,fileName:t||"File"}}if("file"in e&&e.local_key){const t=(0,o.p)("name")(e.file),s=(0,r.mf0)(r.ozw.getState(),e.local_key);if(!s)return;return{type:"attachment",fileKey:s,fileName:t||"File"}}},d=e=>{const{images:t}=e.compositeContent;if(0===t.length)return;const s=t[0];if("key"in s)return{type:"attachment",fileKey:s.key,fileName:"Image"};if("blob"in s&&s.local_key){const e=(0,r.mf0)(r.ozw.getState(),s.local_key);if(!e)return;return{type:"attachment",fileKey:e,fileName:(0,o.p)("name")(s.blob)||"Image"}}},u=e=>{const{files:t}=e.compositeContent;if(0===t.length)return;const s=t[0];if("key"in s){const e="file_name"in s&&s.file_name||"";return{type:"attachment",fileKey:s.key,fileName:e||"File"}}if("blob"in s&&s.local_key){const e=(0,o.p)("name")(s.blob),t=(0,r.mf0)(r.ozw.getState(),s.local_key);if(!t)return;return{type:"attachment",fileKey:t,fileName:e||"File"}}},g=e=>(0,r.JGj)(e)?[c(e)].filter(a.q3):(0,r.QP5)(e)?[l(e)].filter(a.q3):(0,r.frm)(e)?[d(e)].filter(a.q3):(0,r.kkt)(e)?[u(e)].filter(a.q3):(0,r.YVR)(e)?(e=>{const{links:t}=e.compositeContent;return t.map((e=>({type:"link",link:e})))})(e):(0,r.BuH)(e)?(e=>e.nestedItems.map((e=>{if(e.type===r.WRI.File)return{type:"attachment",fileName:e.fileName,fileKey:e.fileKey}})).filter(a.q3))(e):[],h=e=>{const t=(0,n.A)(e),s=(0,i.A)(t.map((e=>g(e))));return s}},50779:(e,t,s)=>{s.d(t,{C:()=>v});var i=s(63379),n=s(2633),a=s(89380),o=s(51187),r=s(49392),c=s(28159),l=s(49931),d=s(46872),u=s(75154),g=s(14987);var h=s(35706),p=s(94682),_=s(21331),m=s(5162);const v=(e,t)=>{const s=g.BN.getState(),v=(0,o.p8b)((0,o.c89)((0,a.A)(e)));if(!v)return;const f=v[0].resolved.conversationId||"";if(v.some((({ctx:e,resolved:t})=>(0,o.Azp)({ctx:e,resolved:t},p.pU.getState()))))return;const y=(0,_.Gl)(p.pU.getState(),f)||(0,_.VN)(p.pU.getState(),f);if(y&&(0,m.gm)(y,t.chatType)){const t=(0,h._)(e),a=s.activeSkillIdMap[f];(0,n.A)(t)?v.forEach((e=>{e.resolved.localCreateExt=(0,i.A)(e.resolved.localCreateExt,(({conversationId:e})=>{var t;const s=(0,u.Y)(g.BN.getState(),d.K9.ReadPDF),i=null===(t=(0,u.R)(g.BN.getState(),e))||void 0===t?void 0:t.refContents;if(!i)return{};const n={};if((0,r.A)(s)||(n.input_skill=JSON.stringify({skill_id:s,skill_type:d.K9.ReadPDF})),i){const e=i.map((e=>"link"===e.type&&"PDF"===e.fileType?e.link:"attachment"===e.type&&"PDF"===(0,l.ti)((0,l.GO)(e.fileName))?e.fileKey:void 0)).filter(c.A);n.immersive_reading_files=JSON.stringify(e)}return n})({conversationId:f}))})):s.setRefContents({refContents:t,channel:a?`skill_${a}`:"default"},f)}(0,o.vmW)(e,t)}},842:(e,t,s)=>{s.d(t,{n:()=>i});const i={activeSkillIdMap:{},skill_drop_down_visible:void 0,skillMap:{},skills:void 0,searchGuidanceItems:[],writingSkillState:{originTextEditorValue:"",composeEditorValue:"",replyEditorValue:"",writingEditorValue:{data:[]}},imageSkillState:{editorValue:{data:[]}},musicSkillState:{editorValue:{data:[]},mood:"",lyric:"",genre:""},translateSkillState:{editorValue:""},readWebSkillState:{editorValue:{data:[]}},readSkillState:{linkEditorValue:"",promptEditorValue:""},skillReportEvents:{},userPreferences:{transTargetLang:""},AISearchSkillState:{useDeepSearch:!1},systemConfig:{modelList:[],voiceList:[],canDebug:!1,unlikeFeedbackMeta:[],likeFeedbackMeta:[],feedbackPlaceholder:"",botReportMeta:[],messageReportMeta:[],uploadFileAllowedTypes:[],botLanguageList:[],uploadFileMaxSize:s(56146).eI,saveChatHistoryPopupEnable:!1,enabledSendMultiFileMessage:!1,uploadMultiEntityConf:{maxFileCount:0,maxFileSize:0}}}},22254:(e,t,s)=>{s.d(t,{B:()=>f});var i=s(36266),n=s(14065),a=s(85886),o=s(50474),r=s.n(o);const c=()=>{const e="undefined"==typeof window?{getItem:()=>null,setItem:()=>null,removeItem:()=>null}:r().createInstance({name:"samantha-web",storeName:"store"});var t,s,i;return{getItem:(i=(0,n.A)((function*(t){return new Promise(((s,i)=>{var n;null===(n=e.getItem(t))||void 0===n||n.then((e=>{s(e)})).catch((e=>{i(e)})),setTimeout((()=>{i(new Error(`getItem ${t} timeout, timeout after 10000ms`))}),1e4)}))})),function(e){return i.apply(this,arguments)}),setItem:(s=(0,n.A)((function*(t,s){yield e.setItem(t,s)})),function(e,t){return s.apply(this,arguments)}),removeItem:(t=(0,n.A)((function*(t){yield e.removeItem(t)})),function(e){return t.apply(this,arguments)})}},l=e=>{const t=e();if(t){const{getItem:e,setItem:s,removeItem:i}=t;t.setItem=(0,a.A)(d(s,"setItem"),1e3),t.getItem=d(e,"getItem"),t.removeItem=d(i,"removeItem")}return t},d=(e,t)=>(0,n.A)((function*(...s){try{return yield e(...s)}catch(r){if(r instanceof Error){var n,a,o;const{usage:e=0,quota:s=0}=null!==(n=yield null===(a=navigator)||void 0===a||null===(a=a.storage)||void 0===a||null===(o=a.estimate)||void 0===o?void 0:o.call(a))&&void 0!==n?n:{usage:0,quota:0};i.vF.persist.error({message:`[chat-input]persist storage action error: ${t} failed`,error:r,meta:{usageSpace:e/1024/1024+" MB",quotaSpace:s/1024/1024+" MB"}})}}}));var u=s(2633);const g=e=>{try{return{skills:(0,u.A)(e.skillMap)?void 0:e.skills,skillMap:e.skillMap,userPreferences:e.userPreferences}}catch(t){return i.vF.persist.error({message:"[@chat-input-store] persist state limit error",error:t instanceof Error?t:new Error(String(t))}),{}}};var h=s(44557),p=s(85371),_=s(92431),m=s(842);const v=(e,t)=>{try{const s=(0,p.A)(e)?m.n:e;return(0,h.A)((0,h.A)({},(0,_.A)(t)),s)}catch(s){s instanceof Error&&i.vF.persist.error({message:"[@chat-input-store] persist merge error",error:s})}return t},f=e=>{var t,s;return{name:`${e.prefix}-chat-input-store`,storage:l((()=>{var t;return null!==(t=e.storage)&&void 0!==t?t:c()})),partialize:null!==(t=e.partialize)&&void 0!==t?t:g,version:1.5,merge:null!==(s=e.merge)&&void 0!==s?s:v,onRehydrateStorage:e=>{const t=i.vF.createLoggerWith({ctx:{namespace:"persist"}});return t.info({message:"hydration started",meta:{state:e}}),(e,s)=>{s?t.persist.error({message:"hydration error",error:s instanceof Error?s:new Error(String(s))}):t.info({message:"hydration finished",meta:{state:e}})}}}}},75145:(e,t,s)=>{s.d(t,{X:()=>r});var i=s(44557),n=s(98502),a=s(89565);const o={refContentMap:{}},r=(e,t)=>(a.I.push((()=>e(o))),(0,i.A)((0,i.A)({},o),{},{setRefContents:(s,i)=>{const{refContents:a,channel:o}=s;0!==a.length?e((0,n.jM)((e=>{e.refContentMap[i]={refContents:a,channel:o}}))):t().clearRefContents(i)},clearRefContents:t=>{e((0,n.jM)((e=>{delete e.refContentMap[t]})))},moveRefContents:(t,s)=>{e((0,n.jM)((i=>{const a=i.refContentMap[t];a&&(i.refContentMap[s]=a,setTimeout((()=>{e((0,n.jM)((e=>{delete e.refContentMap[t]})))}),1e4))})))}}))},75154:(e,t,s)=>{s.d(t,{R:()=>n,Y:()=>a});var i=s(2633);const n=(e,t)=>{const s=e.refContentMap[t];if(s&&!(0,i.A)(s.refContents))return s},a=(e,t)=>{const s=Object.entries(e.skillMap),[i]=s.find((([e,s])=>s.skill_type===t))||[];return i}},81133:(e,t,s)=>{s.d(t,{o:()=>y});var i=s(44557),n=s(97327),a=s(51187),o=s(14987),r=s(94682),c=s(5817),l=s(9530),d=s(11003),u=s(34870),g=s(45498),h=s(89565);const p={ugcMusicAutoPlay:!1},_=e=>(h.I.push((()=>e(p))),(0,i.A)((0,i.A)({},p),{},{setUgcMusicAutoPlay:t=>{e((()=>({ugcMusicAutoPlay:t})))}}));var m=s(53676);const v=function e(...t){const{_useChatViewStore:s}=e.prototype;if(s)return s(...t);throw Error("useChatViewStore is not initialized")};function f(e){const{_useChatViewStore:t}=v.prototype||{};if(t)h.I.resetAllSlice();else{const t=(e=>{const{prefix:t,isEnableDebug:s,reduxDevToolsSnapshot:i}=e,n=(0,u.eh)(_);return s&&i?(0,g.vt)()((0,u.lt)(n,{name:t+"-chat-view-store"})):(0,g.vt)()(n)})((0,i.A)((0,i.A)({},e),{},{prefix:"samantha-web"}));Object.setPrototypeOf(v.prototype,t),Object.defineProperties(v,(0,i.A)({},Object.getOwnPropertyDescriptors(t))),v.prototype._useChatViewStore=t}(0,m.Il)(e)}const y=e=>{var t,s,u,g,h,p;const{store:_,isEnableDebug:m,trackEvent:y,http:{baseURL:b,client:S,getCommonHeaders:k,getCommonParams:M,ApiServiceConstructor:A,subApiServiceConstructors:E},globalConfig:w,botConfig:I}=e,{localFeatureConfig:L}=w();return(0,a.Tww)((0,i.A)((0,i.A)({},_),{},{merge:null===(t=_.merge)||void 0===t?void 0:t.chatMessageStore,partialize:null===(s=_.partialize)||void 0===s?void 0:s.chatMessageStore,isEnableDebug:!!m,reduxDevToolsSnapshot:null==L?void 0:L.reduxDevToolsSnapshot})),(0,o.mS)((0,i.A)((0,i.A)({},_),{},{merge:null===(u=_.merge)||void 0===u?void 0:u.chatInputStore,partialize:null===(g=_.partialize)||void 0===g?void 0:g.chatInputStore,isEnableDebug:!!m,reduxDevToolsSnapshot:null==L?void 0:L.reduxDevToolsSnapshot})),(0,r.Eh)((0,i.A)((0,i.A)({},_),{},{merge:null===(h=_.merge)||void 0===h?void 0:h.chatFeedStore,partialize:null===(p=_.partialize)||void 0===p?void 0:p.chatFeedStore,isEnableDebug:!!m,reduxDevToolsSnapshot:null==L?void 0:L.reduxDevToolsSnapshot})),f((0,i.A)((0,i.A)({},_),{},{isEnableDebug:!!m,reduxDevToolsSnapshot:null==L?void 0:L.reduxDevToolsSnapshot})),n.j.init({httpClient:S,baseURL:b,getCommonHeaders:k,getCommonParams:M,ApiServiceConstructor:A,subApiServiceConstructors:E}),y&&c.H.init(y),l.v.init(w,m),d.C.init(I),a.BlE.on("message.updated",((e,t)=>{(0,a.dz7)(t)&&a.ozw.getState().setMusicAutoPlay(!0),(0,a.oSs)(t)&&(0,a.lTU)(t)&&v.getState().setUgcMusicAutoPlay(!0)})),{eventEmitter:a.BlE}}},76454:(e,t,s)=>{s.d(t,{CB:()=>c,Qo:()=>r,cL:()=>o});var i=s(70053),n=s(94682),a=s(80627);const o=e=>(0,i.tY)(n.pU.getState(),e),r=(e,t)=>(0,i.Xc)(n.pU.getState(),e,t),c=(e,t,s)=>(0,a.D)(n.pU.getState(),e,t,s)},80627:(e,t,s)=>{s.d(t,{D:()=>c});var i=s(5162),n=s(70053),a=s(9530);const o=e=>a.v.userId===e;let r=function(e){return e.default="default",e.defaultNew="default_new",e.otherDefault="other_default",e.selfCreated="self_created",e.othersCreated="others_created",e}({});const c=(e,t,s,a)=>{var c,l;const{conversation:d,botInfo:u}=(0,n.tY)(e,t);return(0,i.if)(d)||(0,i.Sx)(a)?r.default:(0,i.aj)(d)||(0,i.i1)(a)?r.defaultNew:o(null==d||null===(c=d.bot_creator_info)||void 0===c?void 0:c.creator_id)||o(null==s||null===(l=s.creator_info)||void 0===l?void 0:l.creator_id)?r.selfCreated:(0,i.vM)(null==d?void 0:d.bot_type)||(0,i.vM)(null==u?void 0:u.bot_type)||(0,i.vM)(null==s?void 0:s.bot_type)?r.othersCreated:(0,i.dG)(null==d?void 0:d.bot_type)||(0,i.dG)(null==u?void 0:u.bot_type)||(0,i.dG)(null==s?void 0:s.bot_type)?r.otherDefault:(0,i.AU)(null==u?void 0:u.bot_type)||(0,i.AU)(null==s?void 0:s.bot_type)?r.default:""}},40191:(e,t,s)=>{s.d(t,{Gw:()=>L,gk:()=>I});var i=s(33451),n=s(14065),a=s(44557),o=s(35754),r=s(89380),c=s(85371),l=s(23974),d=s(56642),u=s(98502),g=s(53713),h=s(36266),p=s(97327),_=s(86204),m=s(34553);let v=function(e){return e[e.Default=0]="Default",e[e.Landing=1]="Landing",e}({});var f=s(89565),y=s(11003),b=s(94654);const S=e=>(0,l.A)(e,"conversationId");var k=s(66546);var M=s(95323),A=s(73532),E=s(5162);const w=["type"],I={conversationListStatus:{loading:!1,failed:!1,count:0,hasMore:!1,isReload:!1,initiated:!1},conversationLinks:[],mainConversationLink:void 0,botConversationIndex:0,threadListStatus:{loading:!1,failed:!1,count:0,hasMore:!1,isReload:!1,nextIndex:"",initiated:!1},threadFeedStatus:{loading:!1,failed:!1,count:0,hasMore:!1,isReload:!1,nextIndex:"",initiated:!1},guestCanChat:!1,chatNotReachLimitMap:{},guestCanCreateThread:!1,guestReachCreateThreadLimit:!0,chatCreateInFirstTime:{},samanthaBot:{samanthaBotInfo:{},isLazyCreate:!1}},L=(...e)=>{const[t,s,L]=e;f.I.push((()=>t(I)));const R=()=>{const{conversationLinks:e,botConversationIndex:t}=s();return e.slice(t)},z=()=>{const{conversationLinks:e,botConversationIndex:t}=s();return e.slice(0,t)},C=e=>{const{conversationLinks:i,botConversationIndex:n}=s(),a=e.length;t({conversationLinks:e.concat(i.slice(n)),botConversationIndex:a})},T=e=>{t({mainConversationLink:e})},U=(e,s=!0)=>{s&&e.forEach((e=>{if(e.bot_id&&e.bot_disable_tag){var t,s;const i={bot_id:null==e?void 0:e.bot_id,id:null==e?void 0:e.bot_id,bot_type:null==e?void 0:e.bot_type,disabled_tag:null!==(t=null==e?void 0:e.bot_disable_tag)&&void 0!==t?t:"normal",creator_info:null!==(s=null==e?void 0:e.bot_creator_info)&&void 0!==s?s:{}};y.C.actions.getBot(e.bot_id)||y.C.actions.updateBot(i)}})),t((t=>({conversationMap:e.reduce(((e,t)=>(t.conversation_id&&(e[t.conversation_id]=t),e)),(0,a.A)({},t.conversationMap)),lastMessageIndexMap:e.reduce(((e,t)=>(t.conversation_id&&(e[t.conversation_id]={message_index:Number(t.message_index)||0,read_message_index:Number(t.read_message_index)||0}),e)),(0,a.A)({},t.lastMessageIndexMap))})))},x=(e,{append:t=!0,ignoreOld:s=!1})=>{const i=z(),n=e.map((e=>{var t,s,i;return{threadId:null===(t=e.thread_id)||void 0===t?void 0:t.toString(),isLocalConversation:!1,conversationId:(null===(s=e.conversation)||void 0===s?void 0:s.conversation_id)||"",conversationType:null===(i=e.conversation)||void 0===i?void 0:i.conversation_type}})).filter((e=>!(0,c.A)(e.threadId))),a=s?[]:i,o=a.filter((e=>(0,A.fF)(e.threadId)));return S(t?[...o,...a,...n]:[...o,...n,...a])},B=(e,t)=>{e.conversationLinks.splice(t,1),t<e.botConversationIndex&&(e.botConversationIndex-=1)},O=(e,{conversationId:t,originConversationKey:s,index:i,threadId:n,pinOperation:a=!1,isLocalConversation:o=!1})=>{var r,c,l,d;const u=Boolean(n)||Boolean(null===(r=e.conversationLinks.find((e=>e.conversationId===t)))||void 0===r?void 0:r.threadId)||(0,E.aj)(e.conversationMap[t]),g=u?z():R(),h=g.length;let p=-1,_=!1,m=o?null===(c=e.localConversationMap[t])||void 0===c?void 0:c.conversation_type:null===(l=e.conversationMap[t])||void 0===l?void 0:l.conversation_type,v=n,f=h,y=k.Cr.Conversation;if(g.forEach(((s,i)=>{let n=!1;var a,o,r,c;s.isLocalConversation?n=null!==(a=null===(o=e.localConversationMap[s.conversationId])||void 0===o?void 0:o.pinned)&&void 0!==a&&a:n=null!==(r=null===(c=e.conversationMap[s.conversationId])||void 0===c?void 0:c.pinned)&&void 0!==r&&r;s.conversationId===t&&(p=i,_=n,m=s.conversationType,v=s.threadId,s.isLocalConversation&&(y=k.Cr.LocalConversation)),n||f!==h||(f=i)})),!i)return;if(~p){const t=u?p:p+e.botConversationIndex;e.conversationLinks.splice(t,1),f=f>p?f-1:f,u&&(e.botConversationIndex-=1)}a?(f=_?f:0,y===k.Cr.Conversation?e.conversationMap[t]&&(e.conversationMap[t].pinned=!e.conversationMap[t].pinned):e.localConversationMap[t]&&(e.localConversationMap[t].pinned=!e.localConversationMap[t].pinned)):f=_?0:f;const b=u?f:f+e.botConversationIndex;e.conversationLinks.splice(b,0,{isLocalConversation:o,conversationId:t,originConversationKey:s,conversationType:m,threadId:null===(d=v)||void 0===d?void 0:d.toString()}),u&&(e.botConversationIndex+=1)};return(0,a.A)((0,a.A)((0,a.A)((0,a.A)({},I),(0,M.Y)(...e)),((e,t)=>({prevActiveConversationId:null,currentActiveConversationId:null,setActiveConversation:s=>{const{currentActiveConversationId:i}=t();e({prevActiveConversationId:i,currentActiveConversationId:s})}}))(...e)),{},{loadConversationList:(F=(0,n.A)((function*(e){let{type:t=[k.oA.Feed,k.oA.Thread,k.oA.Bot]}=e,n=(0,i.A)(e,w);const c=(0,r.A)(t),d=(0,h.XB)({eventName:"load_conversation_list",meta:{type:c.join(","),isRefresh:n.isRefresh,isReload:n.isReload,isInit:!n.isRefresh&&0===n.index,size:n.size,index:n.index}}),u=c.map((e=>{switch(e){case k.oA.Bot:return s().loadBotConversationList(n);case k.oA.Feed:return s().loadThreadFeed(n);case k.oA.Thread:return s().loadThreadList((0,a.A)((0,a.A)({},n),{},{index:void 0}));case k.oA.Guest:return s().loadGuestThreadFeed(n);default:return Promise.resolve([])}}));try{const e=yield Promise.all(u);return d.success(),(0,l.A)((0,o.A)(e),"conversation_id")}catch(g){throw g instanceof Error&&d.error({reason:`loadConversationList failed size:${n.size} index:${n.index} type:${c.join(",")}`,error:g}),g}})),function(e){return F.apply(this,arguments)}),loadBotConversationList:(N=(0,n.A)((function*({index:e,size:i,isReload:n,isRefresh:o}){const{conversationListStatus:r}=s(),c=(0,h.XB)({eventName:"load_bot_conversation_list",meta:{isRefresh:o,isReload:n,size:i,index:e,isInit:!r.initiated}}),l=R(),d=!o&&0===e;t({conversationListStatus:(0,a.A)((0,a.A)({},r),{},{loading:!0,isReload:Boolean(n)})});try{const{data:n}=yield(0,g.tHN)((()=>p.j.apiService.conversation.ConversationList({index:e,batch_size:i,conversation_types:[_.Cr.Bot]})),3,(e=>1e3*e));c.addDurationPoint("fetch_success");const{conversation_list:r=[],has_more:u}=n||{};U(r);const h=r.map((e=>({isLocalConversation:!1,conversationId:e.conversation_id||"",conversationType:null==e?void 0:e.conversation_type}))).filter(Boolean),m=d?[]:l,v=S(o?[...h,...l]:[...m,...h]);return(e=>{const{conversationLinks:i,botConversationIndex:n}=s();t({conversationLinks:i.slice(0,n).concat(e)})})(v),t((e=>({conversationListStatus:(0,a.A)((0,a.A)({loading:!1,failed:!1,count:v.length},o?{hasMore:e.conversationListStatus.hasMore}:{hasMore:u||!1}),{},{isReload:!1,initiated:!0})}))),c.success(),r}catch(u){throw t((e=>({conversationListStatus:(0,a.A)((0,a.A)({},e.conversationListStatus),{},{failed:!0,loading:!1})}))),u instanceof Error&&c.error({reason:`loadBotConversationList failed size:${i} index:${e}`,error:u}),u}})),function(e){return N.apply(this,arguments)}),loadThreadFeed:(G=(0,n.A)((function*({isReload:e,isRefresh:i=!1}={}){const{threadFeedStatus:n}=s(),o=(0,h.XB)({eventName:"load_thread_feed",meta:{isRefresh:i,isReload:e,isInit:!n.initiated}});t({threadFeedStatus:(0,a.A)((0,a.A)({},n),{},{loading:!0,isReload:Boolean(e)})});try{const{data:e}=yield(0,g.tHN)((()=>p.j.apiService.samantha.GetFeed()),3,(e=>1e3*e));o.addDurationPoint("fetch_success");const{threads:s,main_thread:h}=e||{},{thread_list:m=[],has_more:v,next_index:f}=s||{};var r,l,d,u,_;h&&T({conversationId:null!==(r=null===(l=h.conversation)||void 0===l?void 0:l.conversation_id)&&void 0!==r?r:"",conversationType:null===(d=h.conversation)||void 0===d?void 0:d.conversation_type,threadId:null!==(u=null===(_=h.thread_id)||void 0===_?void 0:_.toString())&&void 0!==u?u:"",isLocalConversation:!1});const y=[null==h?void 0:h.conversation].concat(m.map((e=>e.conversation))).filter((e=>!(0,c.A)(e)));U(y);const b=x(m,{append:!1,ignoreOld:!n.initiated});return C(b),t((e=>{var t;return{threadFeedStatus:(0,a.A)((0,a.A)({loading:!1,failed:!1,count:b.length},i?{hasMore:e.threadFeedStatus.hasMore}:{hasMore:v||!1}),{},{isReload:!1,nextIndex:null!==(t=null==f?void 0:f.toString())&&void 0!==t?t:"",initiated:!0})}})),o.success(),y}catch(m){throw t((e=>({threadFeedStatus:(0,a.A)((0,a.A)({},e.threadFeedStatus),{},{failed:!0,loading:!1})}))),m instanceof Error&&o.error({reason:"loadThreadFeed failed",error:m}),m}})),function(){return G.apply(this,arguments)}),loadGuestThreadFeed:(D=(0,n.A)((function*({isReload:e,isRefresh:i=!1}={}){const{threadFeedStatus:n}=s(),o=(0,h.XB)({eventName:"load_guest_thread_feed",meta:{isRefresh:i,isReload:e,isInit:!n.initiated}});t({threadFeedStatus:(0,a.A)((0,a.A)({},n),{},{loading:!0,isReload:Boolean(e)})});try{const{data:e}=yield(0,g.tHN)((()=>p.j.apiService.samantha.GetTouristFeed()),3,(e=>1e3*e));o.addDurationPoint("fetch_success");const{samantha_bot:v,main_thread:f,threads:b,can_create_thread:S}=null!=e?e:{},{thread_list:k=[],has_more:M,next_index:E}=b||{};if(f){var r,l,d,u,_;T({conversationId:null!==(r=null===(l=f.conversation)||void 0===l?void 0:l.conversation_id)&&void 0!==r?r:"",conversationType:null===(d=f.conversation)||void 0===d?void 0:d.conversation_type,threadId:null!==(u=null===(_=f.thread_id)||void 0===_?void 0:_.toString())&&void 0!==u?u:"",isLocalConversation:!1})}else{const e=(0,h.XB)({eventName:"create_main_conversation",meta:{from:"header"}}),t=m.Cr.CocoWeb,i=s().mainConversationLink,n=s().addNewLocalConversation({reportEvent:e,conversation:{bot_id:null==v?void 0:v.bot_id,conversation_type:t},conversationId:null!=i&&i.isLocalConversation?null==i?void 0:i.conversationId:void 0});null!=v&&v.bot_id&&y.C.actions.setLocalConversationIdForBot({botId:v.bot_id,localConversationId:n}),T({conversationId:n,conversationType:t,threadId:(0,A.l7)(n,"FirstEnter","main"),isLocalConversation:!0})}const w=[null==f?void 0:f.conversation].concat(k.map((e=>e.conversation))).filter((e=>!(0,c.A)(e)));U(w);const I=x(k,{append:!1,ignoreOld:!n.initiated});return C(I),t((e=>{var t,s;return{threadFeedStatus:(0,a.A)((0,a.A)({loading:!1,failed:!1,count:I.length},i?{hasMore:e.threadFeedStatus.hasMore}:{hasMore:M||!1}),{},{isReload:!1,nextIndex:null!==(t=null==E?void 0:E.toString())&&void 0!==t?t:"",initiated:!0}),chatNotReachLimitMap:(0,a.A)((0,a.A)((0,a.A)({},e.chatNotReachLimitMap),null!=f&&null!==(s=f.conversation)&&void 0!==s&&s.conversation_id?{[f.conversation.conversation_id]:Boolean(f.can_chat)}:{}),k.reduce(((e,t)=>{var s;const{conversation_id:i}=null!==(s=t.conversation)&&void 0!==s?s:{};return i&&(e[i]=Boolean(t.can_chat)),e}),{})),guestReachCreateThreadLimit:Boolean(!S),samanthaBot:{samanthaBotInfo:null!=v?v:{},isLazyCreate:null==f||!f.conversation}}})),o.success(),w}catch(v){throw t((e=>({threadFeedStatus:(0,a.A)((0,a.A)({},e.threadFeedStatus),{},{failed:!0,loading:!1})}))),v instanceof Error&&o.error({reason:"loadThreadFeed failed",error:v}),v}})),function(){return D.apply(this,arguments)}),loadThreadList:(q=(0,n.A)((function*({index:e,size:i,isReload:n,isRefresh:o=!1}={}){const{threadListStatus:r}=s(),l=(0,h.XB)({eventName:"load_thread_list",meta:{isRefresh:o,isReload:n,size:i,index:e,isInit:!r.initiated}});t({threadListStatus:(0,a.A)((0,a.A)({},r),{},{loading:!0,isReload:Boolean(n)})});try{const{data:s}=yield(0,g.tHN)((()=>p.j.apiService.samantha.ThreadList({index:e&&(0,g.kf$)(e)?Number(e):void 0,batch_size:i})),3,(e=>1e3*e));l.addDurationPoint("fetch_success");const{thread_list:n=[],has_more:r,next_index:d}=s||{},u=n.map((e=>e.conversation)).filter((e=>!(0,c.A)(e)));U(u);const h=x(n,{append:!o});return C(h),t((e=>{var t;return{threadListStatus:(0,a.A)((0,a.A)({loading:!1,failed:!1,count:h.length},o?{hasMore:e.threadListStatus.hasMore}:{hasMore:r||!1}),{},{isReload:!1,nextIndex:null!==(t=null==d?void 0:d.toString())&&void 0!==t?t:"",initiated:!0})}})),l.success(),u}catch(d){throw t((e=>({threadListStatus:(0,a.A)((0,a.A)({},e.threadListStatus),{},{failed:!0,loading:!1})}))),d instanceof Error&&l.error({reason:`loadThreadList failed size:${i} index:${e}`,error:d}),d}})),function(){return q.apply(this,arguments)}),addNewLocalConversation:({reportEvent:e,conversation:s,conversationId:i}={})=>{const n=i||(0,b.A)();return t((0,u.jM)((t=>{t.localConversationMap[n]=(0,a.A)({local:{createStatus:k.Et.Pending,reportEvent:e}},s)}))),n},updateLocalConversation:(e,s,i=!1)=>{t((0,u.jM)((t=>{if(i&&null!=s&&s.conversation_id)return t.localConversationMap[s.conversation_id]=(0,a.A)({},s),void delete t.localConversationMap[e];const n=t.localConversationMap[e]||{};Object.assign(n,s)})))},updateConversationIdInLinks:(e,s)=>{t((0,u.jM)((t=>{const i=t.conversationLinks.findIndex((t=>t.conversationId===e)),n=(0,a.A)((0,a.A)({},t.conversationLinks[i]),{},{conversationId:s,isLocalConversation:!1});t.conversationLinks[i]=n})))},fetchConversationAndUpdateLocalStatus:(P=(0,n.A)((function*({token:e,botId:t,conversationId:i,localConversationId:n,messageId:a,scene:o=v.Default,createFrom:r}){const c=s().localConversationMap[n];if(null==c||!c.local)return;const{local:{reportEvent:l}}=c;try{var u;let c;var g;if(s().updateLocalConversation(n,{local:{createStatus:k.Et.Creating,createFrom:r}}),e)c=null===(g=yield p.j.apiService.conversation.ConversationInfoAddBot({token:e}))||void 0===g?void 0:g.data;else if(t){var h;c=null===(h=yield p.j.apiService.conversation.ConversationInfo({bot_id:t}))||void 0===h?void 0:h.data}else if(i){var _;c=null===(_=yield p.j.apiService.conversation.CreateSubConversation({conversation_id:i,message_id:a,scene:o}))||void 0===_?void 0:_.data}const m=null===(u=c)||void 0===u||null===(u=u.conversation)||void 0===u?void 0:u.conversation_id;if(!m||!c)throw new Error("Expect newConversationId, but not found");if(s().updateConversationInfo(c),s().updateLocalConversation(n,{local:{createStatus:k.Et.Done,newConversationId:m,createFrom:r}}),s().conversationListStatus.loading){const e=L.subscribe((e=>({conversationListStatus:e.conversationListStatus})),(({conversationListStatus:t})=>{t.loading||(null==e||e(),s().insertConversationToLinks({conversationId:m,index:1}))}),{fireImmediately:!0,equalityFn:d.x})}else s().insertConversationToLinks({conversationId:m,index:1});return null==l||l.addDurationPoint("success"),null==l||l.success(),c.conversation}catch(m){throw s().updateLocalConversation(n,{local:{createStatus:k.Et.Failed}}),m instanceof Error&&(null==l||l.error({error:m,reason:"create_conversation_error"})),m}})),function(e){return P.apply(this,arguments)}),removeConversationFromLinks:({conversationId:e})=>{const i=s().conversationLinks.findIndex((t=>t.conversationId===e));~i&&t((0,u.jM)((e=>B(e,i))))},removeConversationsFromLinks:({conversationIds:e=[]})=>{t((0,u.jM)((t=>{let s=!1,{botConversationIndex:i}=t;const n=t.conversationLinks.filter(((n,a)=>{const o=e.includes(n.conversationId);return o&&(s=!0,a<t.botConversationIndex&&(i-=1)),!o}));s&&(t.conversationLinks=n,t.botConversationIndex=i)})))},insertConversationToLinks:e=>{t((0,u.jM)((t=>O(t,e))))},insertNewConversationAndRemoveOldConversationFromLinks:(e,s)=>{t((0,u.jM)((t=>{O(t,e);const i=t.conversationLinks.findIndex((e=>e.conversationId===s.conversationId));B(t,i)})))},setGuestCanChat:e=>{t({guestCanChat:e})},setNotReachLimitMap:e=>{t((t=>({chatNotReachLimitMap:(0,a.A)((0,a.A)({},t.chatNotReachLimitMap),e)})))},setGuestCanCreateThread:e=>{t({guestCanCreateThread:e})},setGuestReachCreateThreadLimit:e=>{t({guestReachCreateThreadLimit:e})},updateMainConvLink:({conversation:e={},threadId:t="",isLocalConversation:s=!1})=>{const i=(0,h.XB)({eventName:"update_main_convLink"});try{var n,a;if(!e||!t)throw new Error("getMainConversationInfo: invalid data from api");if(T({conversationId:null!==(n=null==e?void 0:e.conversation_id)&&void 0!==n?n:"",conversationType:null==e?void 0:e.conversation_type,threadId:null!==(a=null==t?void 0:t.toString())&&void 0!==a?a:"",isLocalConversation:s}),!s){const t=[e].filter((e=>!(0,c.A)(e)));U(t)}i.success()}catch(o){throw o instanceof Error&&i.error({reason:"getMainConversationInfo failed",error:o}),o}},updateChatCreateInFirstTime:({conversationId:e="",status:s=!1})=>{t((0,u.jM)((t=>{t.chatCreateInFirstTime[e]=s})))}});var P,q,D,G,N,F}},95323:(e,t,s)=>{s.d(t,{Y:()=>g,w:()=>u});var i=s(14065),n=s(44557),a=s(98502),o=s(36266),r=s(97327),c=s(89565),l=s(11003);function d(e,t){e.conversationMap[t]&&delete e.conversationMap[t],e.lastMessageIndexMap[t]&&delete e.lastMessageIndexMap[t]}const u={conversationMap:{},localConversationMap:{},lastSectionIdMap:{},lastMessageIndexMap:{},actionBarTemplateMap:{}},g=(e,t,s)=>{return c.I.push((()=>e(u))),(0,n.A)((0,n.A)({},u),{},{fetchUpdateConversationInfo:(h=(0,i.A)((function*(e){var s;const{prevActiveConversationId:i}=t(),n=(0,o.XB)({eventName:"load_conversation_info",meta:{cold_start:!i}});if(null!==(s=t().localConversationMap[e])&&void 0!==s&&s.local)n.error({reason:"local_conversation_id",error:Error("local_conversation_id")});else try{const s=yield r.j.apiService.conversation.ConversationInfo({conversation_id:e,ext:i?void 0:{cold_start:"true"}}),{data:a}=s,{conversation:o}=a||{};if(!a)throw new Error("updateConversationInfo: invalid data from api");return n.addDurationPoint("success"),n.success(),t().updateConversationInfo(a),o}catch(a){throw n.error({reason:"load_conversation_info_failed",error:a}),a}})),function(e){return h.apply(this,arguments)}),updateConversationInfo:t=>{const{conversation:s,bot_info:i,msg_templates:r,trace_map:c}=t,{conversation_id:d}=s||{};d&&s&&i?e((0,a.jM)((e=>{e.conversationMap[d]=s;(null==i?void 0:i.id)&&l.C.actions.updateBot(i),s.last_section_id&&(e.lastSectionIdMap[d]=s.last_section_id),r&&(e.actionBarTemplateMap[d]=r.map((e=>(0,n.A)((0,n.A)({},e),{},{req_id:null==c?void 0:c.request_id})))),e.lastMessageIndexMap[d]={message_index:Number(s.message_index)||0,read_message_index:Number(s.read_message_index)||0}}))):o.vF.persist.warning({message:"invalid conversationInfo to update",meta:{conversationInfo:t}})},updateLastSectionId:(t,s)=>{e((0,a.jM)((e=>{s&&(e.lastSectionIdMap[t]=s)})))},clearContext:(g=(0,i.A)((function*(e){var s;const i=yield r.j.apiService.conversation.CreateSection({conversation_id:e}),n=null==i||null===(s=i.data)||void 0===s?void 0:s.section_id;n&&t().updateLastSectionId(e,n)})),function(e){return g.apply(this,arguments)}),updateConversationMessageIndex({conversationId:t,messageIndex:s,readMessageIndex:i}){e((0,a.jM)((e=>{const n=e.lastMessageIndexMap[t];n&&s&&Number(n.message_index)<s&&(n.message_index=s),n&&i&&Number(n.read_message_index)<i&&(n.read_message_index=i)})))},removeConversationFromMap:({conversationId:t})=>{e((0,a.jM)((e=>{d(e,t)})))},removeConversationsFromMap:({conversationIds:t})=>{e((0,a.jM)((e=>{t.forEach((t=>{d(e,t)}))})))}});var g,h}},66546:(e,t,s)=>{s.d(t,{Cr:()=>n,Et:()=>i,oA:()=>a});let i=function(e){return e.Pending="Pending",e.Creating="Creating",e.Done="Done",e.Failed="Failed",e}({}),n=function(e){return e.LocalConversation="LocalConversation",e.Conversation="Conversation",e}({}),a=function(e){return e.Bot="bot",e.Feed="feed",e.Thread="thread",e.Guest="guest",e}({})},94682:(e,t,s)=>{s.d(t,{Eh:()=>g,pU:()=>u});var i=s(44557),n=s(34870),a=s(45498),o=s(90121),r=s(40191),c=s(89565),l=s(53676);const d=e=>{const{prefix:t,storage:s,isEnableDebug:i,merge:c,partialize:l,reduxDevToolsSnapshot:d}=e,u=(0,o.BZ)({prefix:t,storage:s,merge:c,partialize:l}),g=(0,n.Zr)((0,n.eh)(r.Gw),u);return i&&d?(0,a.vt)()((0,n.lt)(g,{name:t+"-chat-feed-store"})):(0,a.vt)()(g)};const u=function e(...t){const{_useFeedStore:s}=e.prototype;if(s)return s(...t);throw Error("useFeedStore is not initialized")};function g(e){const{_useFeedStore:t}=u.prototype||{};if(t)c.I.resetAllSlice();else{const t=d((0,i.A)({},e));Object.setPrototypeOf(u.prototype,t),Object.defineProperties(u,(0,i.A)({},Object.getOwnPropertyDescriptors(t))),u.prototype._useFeedStore=t}(0,l.Il)(e)}},90121:(e,t,s)=>{s.d(t,{BZ:()=>k});var i=s(36266),n=s(53676),a=s(14065),o=s(85886),r=s(50474),c=s.n(r);const l=()=>{const e="undefined"==typeof window?{getItem:()=>null,setItem:()=>null,removeItem:()=>null}:c().createInstance({name:"samantha-web",storeName:"store"});var t,s,i;return{getItem:(i=(0,a.A)((function*(t){return new Promise(((s,i)=>{var n;null===(n=e.getItem(t))||void 0===n||n.then((e=>{s(e)})).catch((e=>{i(e)})),setTimeout((()=>{i(new Error(`getItem ${t} timeout, timeout after 10000ms`))}),1e4)}))})),function(e){return i.apply(this,arguments)}),setItem:(s=(0,a.A)((function*(t,s){yield e.setItem(t,s)})),function(e,t){return s.apply(this,arguments)}),removeItem:(t=(0,a.A)((function*(t){yield e.removeItem(t)})),function(e){return t.apply(this,arguments)})}},d=e=>{const t=e();if(t){const{getItem:e,setItem:s,removeItem:i}=t;t.setItem=(0,o.A)(u(s,"setItem"),1e3),t.getItem=u(e,"getItem"),t.removeItem=u(i,"removeItem")}return t},u=(e,t)=>(0,a.A)((function*(...s){try{return yield e(...s)}catch(r){if(r instanceof Error){var n,a,o;const{usage:e=0,quota:s=0}=null!==(n=yield null===(a=navigator)||void 0===a||null===(a=a.storage)||void 0===a||null===(o=a.estimate)||void 0===o?void 0:o.call(a))&&void 0!==n?n:{usage:0,quota:0};i.vF.persist.error({message:`[feed-core]persist storage action error: ${t} failed`,error:r,meta:{usageSpace:e/1024/1024+" MB",quotaSpace:s/1024/1024+" MB"}})}}}));var g=s(21511),h=s(73532),p=s(21331);const _=((e={})=>t=>{const{getExtraConversationIds:s}=e;try{var n;const e=(0,h.oR)((0,p.qk)(t)).filter((e=>!e.isLocalConversation)).slice(0,5),i=(0,h.Vs)((0,p.SE)(t)).slice(0,5),a=(0,p.mV)(t),o=null!=a&&a.isLocalConversation?void 0:a,r=e.length,c=e.concat(i),l=(0,g.A)(c.map((e=>e.conversationId)).concat(null!==(n=null==s?void 0:s())&&void 0!==n?n:[])),d={},u={};return l.forEach((e=>{d[e]=t.conversationMap[e],u[e]=t.lastMessageIndexMap[e]})),{mainConversationLink:o,conversationLinks:c,botConversationIndex:r,conversationMap:d,lastSectionIdMap:t.lastSectionIdMap,lastMessageIndexMap:u,actionBarTemplateMap:t.actionBarTemplateMap}}catch(a){return i.vF.persist.error({message:"[@feed-core-store] persist state limit error",error:a instanceof Error?a:new Error(String(a))}),{}}})();var m=s(44557),v=s(85371),f=s(92431),y=s(95323),b=s(40191);const S=(e,t)=>{try{const s=(0,v.A)(e)?(0,m.A)((0,m.A)({},b.gk),y.w):e;return(0,m.A)((0,m.A)({},(0,f.A)(t)),s)}catch(s){s instanceof Error&&i.vF.persist.error({message:"[@samantha-feed-core], persist merge error",error:s})}return t},k=e=>{var t,s;return{name:`${e.prefix}-chat-feed-store`,storage:d((()=>{var t;return null!==(t=e.storage)&&void 0!==t?t:l()})),partialize:null!==(t=e.partialize)&&void 0!==t?t:_,version:1.5,merge:null!==(s=e.merge)&&void 0!==s?s:S,onRehydrateStorage:e=>{const t=i.vF.createLoggerWith({ctx:{namespace:"persist"}});return t.info({message:"hydration started",meta:{state:e}}),(e,s)=>{s?t.persist.error({message:"hydration error",error:s instanceof Error?s:new Error(String(s))}):(t.info({message:"hydration finished",meta:{state:e}}),(0,n.SR)().addDurationPoint("chat_store_hydrate_finish"))}}}}},21331:(e,t,s)=>{s.d(t,{Gl:()=>o,SE:()=>i,VN:()=>r,mV:()=>n,qk:()=>a});const i=e=>({conversationLinks:e.conversationLinks,botConversationIndex:e.botConversationIndex,conversationListStatus:e.conversationListStatus,loadBotConversationList:e.loadBotConversationList}),n=e=>e.mainConversationLink,a=e=>({conversationLinks:e.conversationLinks,botConversationIndex:e.botConversationIndex,threadListStatus:e.threadListStatus,threadFeedStatus:e.threadFeedStatus,loadThreadList:e.loadThreadList,loadThreadFeed:e.loadThreadFeed}),o=(e,t)=>t?e.localConversationMap[t]:void 0,r=(e,t)=>t?e.conversationMap[t]:void 0},73532:(e,t,s)=>{s.d(t,{Vs:()=>n,fF:()=>o,l7:()=>a,oR:()=>i});function i({conversationLinks:e,botConversationIndex:t}){return e.slice(0,t)}function n({conversationLinks:e,botConversationIndex:t}){return e.slice(t)}const a=(e,t,s="sub")=>`${"sub"===s?"localThread_":"localMainThread_"}${t||""}_${e}`,o=(e,t,s="sub")=>{var i;const n="sub"===s?"localThread_":"localMainThread_";var a;return t?null==e||null===(i=e.startsWith)||void 0===i?void 0:i.call(e,`${n}${t}_`):null==e||null===(a=e.startsWith)||void 0===a?void 0:a.call(e,n)}},16709:(e,t,s)=>{s.d(t,{w:()=>c});var i=s(14065),n=s(36266),a=s(97327),o=s(37498);function r(){return(r=(0,i.A)((function*(){try{const{data:e}=yield a.j.apiService.setting.Launch({});return null==e?void 0:e.config}catch(e){n.vF.info("request failed to get launch config")}}))).apply(this,arguments)}function c(e){return l.apply(this,arguments)}function l(){return l=(0,i.A)((function*(e){try{const t=yield function(){return r.apply(this,arguments)}();return e.setState((()=>({ttWidConfig:(0,o.D)(t)}))),t}catch(t){n.vF.info("request failed to get launch config")}})),l.apply(this,arguments)}},27245:(e,t,s)=>{s.d(t,{R1:()=>v});var i=s(36266),n=s(53713),a=s(54343),o=s(98101),r=s(1964),c=s(56448);const l=()=>{let e,t;return{promise:new Promise(((s,i)=>{e=s,t=i})),resolve:e,reject:t}},d=e=>!!e.local_message_id,u=e=>!!e.local_conversation_id||!!e.conversation_id,g=e=>(t,s,n)=>new Promise(((a,r)=>{const u=o.oz.getState();if(!t.every(d))return i.vF.info("local_message_id is empty, skip to send message"),a("skip");if(!t.every(u.hasSendMessageTask))return i.vF.info("task is empty, skip to send message"),a("skip");if(t.some(u.isSendMessageExpired))return a("skip");null==e||e(t,s);const g=t.map(l);t.forEach(((e,t)=>u.updateSendMessageTaskFinishFn(e,g[t].resolve)));const h=setTimeout((()=>r(new Error("timeout"))),n||c.Sf),p=g.map((e=>e.promise));Promise.all(p).then((()=>{a("finish"),clearTimeout(h)}))})),h=g(((e,t)=>{t===a.B.Message&&r.Lh.socketAdaptor.sendMessage(e),t===a.B.Cmd&&r.Lh.socketAdaptor.sendCmd(e)})),p=g(((e,t)=>{t===a.B.Message&&r.Lh.httpAdaptor.sendMessage(e),t===a.B.Cmd&&r.Lh.httpAdaptor.sendCmd(e)})),_=(e,t)=>{const s=t||e,i=(t,n,a)=>e(t,n,a).catch((e=>s(t,n,a).catch((e=>i(t,n,a)))));return i},m=(e,t,s,n)=>{const a=o.oz.getState();return e.every(d)?e.every(u)?(e.forEach((e=>a.finishSendMessageTask(e.local_message_id))),e.forEach(a.addSendMessageTask),s(e,t,n)):(i.vF.info("local_conversation_id or conversation_id is empty, skip sending message"),Promise.resolve()):(i.vF.info("local_message_id is empty, skip sending message"),Promise.resolve())},v=({messages:e,customSendWaitTimeout:t,protocolType:s})=>m(e,a.B.Message,((e,t,i)=>{const a=(e=>e.some((e=>{var t,s;return n.Asr.length(`${(null==e?void 0:e.content)||""}${(null==e||null===(t=e.ext)||void 0===t?void 0:t.browser_explain)||""}${(null==e||null===(s=e.ext)||void 0===s?void 0:s.samantha_context)||""}`)>c.dO})))(e)||"http"===s,o="socket"===s;let r;return r=a?_(p):o?_(h):_(h,p),r(e,t,i)}),t)},32865:(e,t,s)=>{s.d(t,{EB:()=>_,F6:()=>l,Ln:()=>v,MV:()=>m,Qn:()=>d,Rs:()=>u,Sf:()=>h,Sy:()=>r,W2:()=>b,_q:()=>o,dO:()=>p,dc:()=>n,hn:()=>a,i9:()=>y,rR:()=>f,so:()=>c,sq:()=>g,tL:()=>i});const i="LOCAL_USER",n=18e4,a=6e4,o=15e3,r=6e4,c=3e4,l=6e4,d=50,u=20,g="ONBOARDING_MESSAGE_ID",h=5e3,p=19e3,_=2e3,m=1e4,v="THINKING_MESSAGE_ID",f="MOCK_REPLY_MESSAGE_ID",y="ASSISTANT_CONV_ID_WITHOUT_CACHE",b=30},52494:(e,t,s)=>{s.d(t,{e:()=>I});var i=s(44557),n=s(14065),a=s(97666),o=s(28159),r=s(2633),c=s(91689),l=s(76900),d=s(53713),u=s(36266),g=s(46872),h=s(2325),p=s(81407),_=s(33664),m=s(55524),v=s(90240),f=s(49850),y=s(35482),b=s(98101),S=s(94682),k=s(76454),M=s(5817),A=s(66221);const E=new l.A({concurrency:1}),w=function(){var e=(0,n.A)((function*(e,t){const s=t.cmd_type,n=s===h.HK.TouristReachThreadLimit?t.conversation_id||"0":t.conversation_id,l=e.getState(),E=S.pU.getState();if(n&&s)switch(s){case h.HK.ConversationRead:{const{read_message_index:e,message_index:s}=t.ext||{};u.vF.info({message:"Cmd: ConversationRead",meta:{conversation_id:n,read_message_index:e,message_index:s}}),e&&s&&E.updateConversationMessageIndex({conversationId:n,readMessageIndex:Number(e),messageIndex:Number(s)});break}case h.HK.ConversationAdd:u.vF.info({message:"Cmd: ConversationUpdate",meta:{conversation_id:n}});break;case h.HK.ConversationUpdate:u.vF.persist.info({message:"Cmd: ConversationUpdate",meta:{conversation_id:n}});try{yield E.fetchUpdateConversationInfo(n)}catch(T){T instanceof Error&&u.vF.persist.error({message:"ConversationUpdate failed",error:T})}break;case h.HK.ConversationArchive:u.vF.info({message:"Cmd: ConversationArchive",meta:{conversation_id:n}}),E.removeConversationFromMap({conversationId:n}),E.removeConversationFromLinks({conversationId:n});break;case h.HK.ConversationLandingInsert:break;case h.HK.ConversationCreateSection:var w,I,L;if(u.vF.persist.info({message:"Cmd: ConversationCreateSection",meta:{conversation_id:n,section_id:null==t||null===(w=t.ext)||void 0===w?void 0:w.section_id}}),null!=t&&null!==(I=t.ext)&&void 0!==I&&I.section_id)E.updateLastSectionId(n,null==t||null===(L=t.ext)||void 0===L?void 0:L.section_id);break;case h.HK.ConversationClearHistory:u.vF.persist.info({message:"Cmd: ConversationClear",meta:{conversation_id:n}}),yield l.clearConversationMessages(n);break;case h.HK.MessageDelete:console.log("TODO",t);break;case h.HK.OnboardingBegin:u.vF.persist.info({message:"Cmd: OnboardingBegin",meta:{conversation_id:n}}),yield l.initOnboarding({conversationId:n});break;case h.HK.OnboardingFail:case h.HK.OnboardingCancel:u.vF.persist.info({message:"Cmd: "+(s===h.HK.OnboardingFail?"OnboardingFail":"OnboardingCancel"),meta:{conversation_id:n}}),yield l.cancelOnboarding({conversationId:n,reason:"executing onboarding"+(s===h.HK.OnboardingFail?"_fail":"_cancel")});break;case h.HK.UserBanned:var R;u.vF.persist.info({message:"Cmd: UserBanned",meta:(0,i.A)({conversationId:n},t)}),p.g.emit(p.P.USER_BANNED,null==t||null===(R=t.ext)||void 0===R?void 0:R.err_msg);break;case h.HK.UserBanRelease:var z,C;u.vF.persist.info({message:"Cmd: UserBanRelease",meta:{conversation_id:n,index:t.index,error:null==t||null===(z=t.ext)||void 0===z?void 0:z.err_msg}}),p.g.emit(p.P.USER_BAN_RELEASE,null==t||null===(C=t.ext)||void 0===C?void 0:C.err_msg);break;case h.HK.OnboardingNeedStart:u.vF.persist.info({message:"Cmd: OnboardingNeedStart",meta:{conversation_id:n,index:t.index}});break;case h.HK.UserConfigUpdate:u.vF.info({message:"Cmd: UserConfigUpdate",meta:{conversation_id:n}}),A.B.emit("user.configSynced",t);break;case h.HK.TouristReachChatLimit:u.vF.info({message:"Cmd: TouristReachChatLimit",meta:{conversation_id:n}}),A.B.emit("guest.reachLimit",{conversation_id:t.conversation_id});break;case h.HK.TouristReachThreadLimit:u.vF.info({message:"Cmd: TouristReachThreadLimit",meta:{conversation_id:n}}),E.setGuestReachCreateThreadLimit(!0);break;case h.HK.MessageNotCompliant:{const{local_message_id:e,conversation_id:s,message_id:i}=t;if(u.vF.info({message:"Cmd: MessageNotCompliant",meta:{conversation_id:n,message_id:i,local_message_id:e}}),!s)return;l.updateMessageList({conversationId:s,immerUpdate:t=>{const{draftLocalMessageMap:s,draftMessageMap:n}=t,a=_.q7.NotCompliant;e&&s[e]&&(s[e].status=a,(0,y.hT)(t)),i&&(n[i]&&(n[i].status=a),(0,f.PF)(i),(0,y.c5)(t,i),(0,y.Ej)(t,i))}});break}case h.HK.NestedMessageStateChange:{const{ext:e}=t,s=(0,d.OlY)(null==e?void 0:e.body);if(!s)return;const i=s.conversation_id,n=s.local_message_id,u=null==s?void 0:s.update_entity_state_list;if(!i||!(0,o.A)(i)||!n||!(0,o.A)(n)||!u||!(0,c.A)(u)||(0,r.A)(u)||!u.every(m.c))return;u.forEach((e=>{const t=e.identifier;e.update_fields.includes(v.Z2.ParseState)&&l.updateAttachmentParseState(t,e.parse_state),e.update_fields.includes(v.Z2.ReviewState)&&l.updateAttachmentReviewState(t,e.review_state)})),l.updateMessageList({conversationId:i,immerUpdate:e=>{const{draftMessageMap:t}=e,[,s]=(0,a.A)(t).find((([e,t])=>t.local_message_id===n))||[];(0,b.xY)(s)&&u.forEach((e=>{const t=s.contentObj.entities.find((t=>t.identifier===e.identifier));if(t){if(e.update_fields.includes(v.Z2.ParseState)){t.file_parse_state=e.parse_state;const n="6";M.H.trackEvent("upload_parse_status",{status:0,error_code:"parse_failed",conversation_id:i,chat_type:(0,k.CB)(i,(0,k.cL)(i).botInfo),skill_name:g.K9.ReadPDF.toString(),skill_id:n,upload_id:s.local_message_id,upload_collection_way:s.contentObj.entities.length>1?"multi":"single",upload_type:"Image"===(0,d.tiF)(t.entity_content.file.file_name)?"pic":"pdf",upload_file_type:(0,d.GOI)(t.entity_content.file.file_name),upload_file_size:t.entity_content.file.size})}e.update_fields.includes(v.Z2.ReviewState)&&(t.file_name_state=e.review_state)}}))}});break}default:u.vF.warning({namespace:"socket",message:`SKIP: cmdType=${s}`})}else u.vF.warning({namespace:"socket",message:"ConversationAdd: invalid conversation_id"})}));return function(t,s){return e.apply(this,arguments)}}(),I=(e,t)=>{E.add((()=>w(e,t)))}},90240:(e,t,s)=>{s.d(t,{K_:()=>r,Z2:()=>n,Z7:()=>o,tQ:()=>a});var i=s(2325);let n=function(e){return e[e.State_Unknown=0]="State_Unknown",e[e.ReviewState=1]="ReviewState",e[e.ParseState=2]="ParseState",e}({});const a=[n.State_Unknown,n.ReviewState,n.ParseState],o=[i.hI.ParseState_Default,i.hI.ParseState_Success,i.hI.ParseState_Failed,i.hI.ParseState_Processing],r=[i.Cp.ReviewState_Default,i.Cp.ReviewState_Access,i.Cp.ReviewState_NotCompliant,i.Cp.ReviewState_Processing]},55524:(e,t,s)=>{s.d(t,{c:()=>l});var i=s(49392),n=s(28159),a=s(20997),o=s(41967),r=s(91689),c=s(90240);const l=e=>!!e&&(0,a.A)(e)&&"identifier"in e&&!!e.identifier&&(0,n.A)(e.identifier)&&"update_fields"in e&&(0,r.A)(e.update_fields)&&e.update_fields.every((e=>c.tQ.includes(e)))&&(!("parse_state"in e)||((0,o.A)(e.parse_state)&&c.Z7.includes(e.parse_state)||(0,i.A)(e.parse_state)))&&(!("review_state"in e)||((0,o.A)(e.review_state)&&c.K_.includes(e.review_state)||(0,i.A)(e.review_state)))},43412:(e,t,s)=>{s.d(t,{f:()=>x});var i=s(44557),n=s(14065),a=s(53719),o=s(3888),r=s(37814),c=s(82914),l=s(41967),d=s(85371),u=s(9012),g=s(53713),h=s(36266),p=s(33664),_=s(84917),m=s(94343),v=s(82289),f=s(11003),y=s(9530),b=s(5817),S=s(68843),k=s(76049),M=s(33187),A=s(35482),E=s(56448),w=s(94682),I=s(66546),L=s(70053),R=s(80627),z=s(66221);function C(e){const[t]=e,{draftLocalMessageMap:s,draftMessageLinks:i,draftMessageMap:n}=t;i.filter((({isLocalMessage:e,messageId:t})=>{var i;return e&&(null===(i=s[t])||void 0===i||null===(i=i.local)||void 0===i?void 0:i.status)===k.FQ.ReceivingFirstPackage})).sort(((e,t)=>(0,S.rV)(n[s[t.messageId].reply_id||""],n[s[e.messageId].reply_id||""]))).forEach(((e,s)=>{s&&(0,A.k)(t,e)}))}const T=e=>{var t;return null===(t=e.ext)||void 0===t?void 0:t.collection_id},U=e=>{var t,s;if(!T(e))return!1;const i=null===(t=e.localInfo)||void 0===t?void 0:t.messageListCount,n=null===(s=e.localInfo)||void 0===s?void 0:s.inMessageListPos;return(0,l.A)(i)&&(0,l.A)(n)&&n===i-1},x=function(){var e=(0,n.A)((function*(e,t){var s,n,l;const g=e.getState(),p={namespace:null===(s=t.localInfo)||void 0===s?void 0:s.from,meta:{message:t}};h.vF.info((0,i.A)((0,i.A)({},p),{},{message:"Ack Message"}));const{conversation_id:_,message_id:y,local_message_id:b,bot_id:E,local_conversation_id:R,thread_id:x=""}=t;if(!b)return void h.vF.warning((0,i.A)((0,i.A)({},p),{},{message:"Invalid Ack Message: local_message_id"}));g.finishSendMessageTask(b);const D=R||_;if(!y&&b&&!(0,v.zT)(t)){var G,N;const e=g.getReportEvents(D,b).send_cmd;return e.updateMeta({from:null===(G=t.localInfo)||void 0===G?void 0:G.from,retried:null===(N=t.localInfo)||void 0===N?void 0:N.retried}),null==e||e.addDurationPoint("success"),void(null==e||e.success())}const F=!(null===(n=(0,M.YJ)(e.getState(),D,b).local)||void 0===n||!n.isRegenerate),j=g.getReportEvents(D,b),H=j.send_message,V=j.create_conversation_by_message;if(!y)return(0,v.ko)(g,t)?void function(e,t,s){var i;S.Cd.updateMeta(s.reportEvents,O(e,t)),S.Cd.addDuration(s.reportEvents,"has_err"),S.Cd.error(s.reportEvents,{reason:"has_err",meta:{has_err:null==t||null===(i=t.ext)||void 0===i?void 0:i.has_err}}),q(t,e,{sendMessageReport:(0,u.A)(s.reportEvents,"send_message"),isRegenerate:s.isRegenerate,success:!1})}(e.getState(),t,{reportEvents:j,isRegenerate:F}):void h.vF.warning((0,i.A)((0,i.A)({},p),{},{message:"Invalid Ack Message: message_id"}));if(!function(e,t){var s;const i=e=>{var s;h.vF.persist.warning({namespace:null===(s=t.localInfo)||void 0===s?void 0:s.from,message:"Invalid Ack Message",meta:{reason:e,message:t}})};if(!e)return i("local_sending_message is not exist"),!1;if(!(0,S.xX)(e))return i("local_sending_message was received ack"),!1;if((null==e||null===(s=e.local)||void 0===s?void 0:s.status)===k.FQ.SentInLocalConversation)return i("local_sending_message was received ack"),!1;return!0}((0,m.TU)(g,{conversationId:D,localMessageId:b}),t))return;const K=(0,m.O2)(e.getState(),{conversationId:D,replyId:y}),W=(null===(l=(0,c.A)(K))||void 0===l?void 0:l.local_message_id)||(0,S.um)(y);if((!T(t)||U(t))&&(0,m.O6)({reply_id:t.message_id,conversation_id:t.conversation_id}),S.Cd.addDuration(j,"ack"),(E||x)&&R&&_){var $;const s=Boolean(x),i=Boolean(null==t||null===($=t.ext)||void 0===$?void 0:$.create_main_thread);g.updateMessageList({conversationId:_,immerUpdate:(...e)=>{var s,i;const[n]=e,{draftMessageMap:a}=n;t.message_id&&(0,S.up)(a[t.message_id])||(0,m.eT)({isRegenerate:!1,immerUpdateMessage:e,newLocalMessageId:W,conversationId:_,replyId:y,sectionId:t.section_id,timeout:null==t||null===(s=t.ext)||void 0===s?void 0:s.timeout,scene:null==H||null===(i=H.getMeta())||void 0===i?void 0:i.scene,localMessageStatus:k.FQ.ReceivingFirstPackage,createdFrom:"ack",message:{ext:(0,m.Gm)(g)}})}}),g.updateMessageList({conversationId:R,immerUpdate:e=>{const t=e.draftLocalMessageMap[b];t.local.failedExpired=void 0,t.local.status=k.FQ.SentInLocalConversation}});try{var J;yield function(e){return B.apply(this,arguments)}({store:g,conversationId:_,isCreateMainThread:i,threadId:null!==(J=null==x?void 0:x.toString())&&void 0!==J?J:""}),null==V||V.addDurationPoint("init_conversation_success"),g.updateMessageList({conversationId:_,immerUpdate:(...e)=>{const[t]=e,{draftMessageMap:s}=t;if(y&&(0,S.up)(s[y]))return;(0,o.A)((0,r.A)(t.draftLocalMessageMap,(e=>(null==e?void 0:e.reply_id)===y))).forEach((({local_message_id:s=(0,S.um)(y)})=>{const i=t.draftMessageLinks.find((e=>e.messageId===s));(0,d.A)(i)&&(0,m.dk)({isRegenerate:!1,immerUpdateMessage:e,newLocalMessageId:s})})),C(e)}}),w.pU.getState().insertNewConversationAndRemoveOldConversationFromLinks({conversationId:_,originConversationKey:R,threadId:x,index:1},{conversationId:R}),s||f.C.actions.updateBot({bot_id:String(E),has_conversation:!0,conversation_id:_}),w.pU.getState().updateLocalConversation(R,{local:{createStatus:I.Et.Done,newConversationId:_,reportEvent:V,createFrom:"chatted"}})}catch(Q){g.updateMessageList({conversationId:R,immerUpdate:e=>{const t=e.draftLocalMessageMap[b];t.local.failed=!0,t.local.status=k.FQ.SentAndCreateConversationFailedInLocalConversation,(0,A.hT)(e)}}),Q instanceof Error&&(null==V||V.error({reason:"create_conversation_failed",error:Q,meta:{bot_id:E,thread_id:x}}))}finally{P(e.getState(),t,{reportEvents:(0,a.A)(j,["send_message"]),isRegenerate:F})}}else if(g.updateMessageList({conversationId:_,immerUpdate:(...s)=>{var i,n,o,r;const[c]=s,l=c.draftLocalMessageMap[b],d=(0,S.oQ)(l);P(e.getState(),t,{reportEvents:(0,a.A)(j,["send_message"]),isRegenerate:d}),d||(0,A.sK)({draft:c,localMessage:l,message:t,useRemoteMessageKey:!1}),(0,A.ZH)({draft:c,localMessage:l,message:t,omitReportEventProperty:["send_message","create_conversation_by_message"]});const u=(0,A.hT)(c);if(!d&&((0,M.vW)(e.getState(),{conversationId:_,replyId:y})||T(t)&&!U(t)))return;const{draftMessageMap:h}=c;t.message_id&&(0,S.up)(h[t.message_id])||((0,m.eT)({conversationType:(0,L.Rx)(w.pU.getState(),_),isRegenerate:d,regenHead:null==u||null===(i=u[0])||void 0===i?void 0:i.regen_head,immerUpdateMessage:s,newLocalMessageId:W,conversationId:_,replyId:y,sectionId:t.section_id,timeout:null==t||null===(n=t.ext)||void 0===n?void 0:n.timeout,scene:null===(o=j.send_message)||void 0===o||null===(o=o.getMeta())||void 0===o?void 0:o.scene,localMessageStatus:k.FQ.ReceivingFirstPackage,createdFrom:"ack",message:{ext:(0,m.Gm)(g)}}),(0,m.dk)({isRegenerate:d,immerUpdateMessage:s,newLocalMessageId:W,regenHead:null==u||null===(r=u[0])||void 0===r?void 0:r.regen_head}),C(s))}}),t.index){const e=Number(t.index);w.pU.getState().updateConversationMessageIndex({conversationId:_,readMessageIndex:e,messageIndex:e})}t.section_id&&w.pU.getState().updateLastSectionId(D,t.section_id),z.B.emit("message.receivedAck",g,t)}));return function(t,s){return e.apply(this,arguments)}}();function B(){return(B=(0,n.A)((function*(e){const{store:t,conversationId:s,isCreateMainThread:i=!1,threadId:a}=e,o=yield w.pU.getState().fetchUpdateConversationInfo(s);var r;(Boolean(a)||i)&&w.pU.getState().updateChatCreateInFirstTime({conversationId:null!==(r=null==o?void 0:o.conversation_id)&&void 0!==r?r:"",status:!0});const c="ack_init_message_list_should_retry";try{yield(0,g.tHN)((0,n.A)((function*(){const e=yield t.initMessageList({conversationId:s,messageCursor:Number(null==o?void 0:o.message_cursor),messageIndex:Number(null==o?void 0:o.message_index),range:{start:Number(null==o?void 0:o.message_cursor),end:Number(null==o?void 0:o.message_index)}});h.vF.persist.info({eventName:"ack_init_message_list",meta:{is_undefined:void 0===e,message_cursor:null==o?void 0:o.message_cursor,message_index:null==o?void 0:o.message_index,length:null==e?void 0:e.length,message_ids:null==e?void 0:e.map((e=>e.messageId)).join(",")}});const{conversation_id:i}=null!=o?o:{};if(!i)return void h.vF.persist.error({eventName:"ack_init_message_list",error:Error("conversation_id is undefined"),meta:{is_undefined:void 0===e,message_cursor:null==o?void 0:o.message_cursor,message_index:null==o?void 0:o.message_index,length:null==e?void 0:e.length,message_ids:null==e?void 0:e.map((e=>e.messageId)).join(","),reason:"conversation_id_is_undefined"}});if(!e||0===e.length||e.every((e=>(0,S.RR)((0,M.tP)(t,i,e)))))throw Error(c)})),3,200),o&&i&&a&&(yield w.pU.getState().updateMainConvLink({conversation:o,threadId:a}))}catch(l){if(l instanceof Error&&l.message===c)return void h.vF.persist.error({eventName:"ack_init_message_list",error:Error("retry too more times"),meta:{reason:"retry_too_more_times"}});throw l}}))).apply(this,arguments)}function O(e,t){var s,i,n,a;const{local_message_id:o,conversation_id:r,local_conversation_id:c,bot_id:l,message_id:d}=t;return{local_message_id:o,conversation_id:r,local_conversation_id:c,from:null===(s=t.localInfo)||void 0===s?void 0:s.from,bot_id:l||(0,L.Xc)(w.pU.getState(),r),message_id:d,reply_id:t.reply_id,retried:null===(i=t.localInfo)||void 0===i?void 0:i.retried,log_id:null==t||null===(n=t.ext)||void 0===n?void 0:n.log_id,section_id:null==t?void 0:t.section_id,message_type:null==t?void 0:t.message_type,collection_id:null===(a=t.ext)||void 0===a?void 0:a.collection_id}}function P(e,t,s){S.Cd.updateMeta(s.reportEvents,O(0,t)),S.Cd.addDuration(s.reportEvents,"ack"),S.Cd.success(s.reportEvents),q(t,e,{sendMessageReport:(0,u.A)(s.reportEvents,"send_message"),isRegenerate:s.isRegenerate,success:!0})}function q(e,t,s){if(s.sendMessageReport&&!s.isRegenerate){var n,a,o,r,c;const{conversation_id:t,bot_id:l,message_id:d,section_id:u,scene:g,sec_scene:h,use_skill:m,skill_id:v,skill_name:k,is_ogf:M,from:A,collection_id:I,is_quote:z,quote_type:C,enter_from:T,content_source:U,content_type:x}=s.sendMessageReport.getMeta(),{botInfo:B}=(0,L.tY)(w.pU.getState(),t),O=(0,L.Rx)(w.pU.getState(),t),P=(0,R.D)(w.pU.getState(),t,B,O),{loginSource:q,enterChatMethod:D}=y.v;b.H.trackEvent("send_message_status",(0,i.A)((0,i.A)((0,i.A)((0,i.A)((0,i.A)({duration:null===(n=s.sendMessageReport.getDuration())||void 0===n?void 0:n.ack,success:s.success?1:0,result:s.success?void 0:"shark",conversation_id:t,conversation_type:O,chat_type:P,bot_id:l,message_id:d,section_id:u,scene:"seo_keyboard"===g?"keyboard":g,sec_scene:h,use_skill:m,skill_name:k,skill_id:v,is_gpt4:M,message_type:(0,S.rJ)(e),from:A,writing_genre:null===(a=s.sendMessageReport.getMeta())||void 0===a?void 0:a.writing_genre,styles:null===(o=s.sendMessageReport.getMeta())||void 0===o?void 0:o.styles,collect_id:null===(r=s.sendMessageReport.getMeta())||void 0===r?void 0:r.collect_id,collect_type:null===(c=s.sendMessageReport.getMeta())||void 0===c?void 0:c.collect_type},q?{previous_page:q}:{}),{},{enter_chat_method:D},x===p.cM.Text?{original_content_source:U||E.Zp.Other}:{}),T&&"bot_discover"===T?{user_id:y.v.userId,req_id:l?f.C.actions.getBotIdToRequestIdMap()[l]:"",recommend_from:"bot_list_discover"}:{}),I?{collection_id:I}:{}),{},{is_quote:z,quote_type:C})),_.Q.trackSendMessageEndEvent(e,s)}}},91073:(e,t,s)=>{s.d(t,{C:()=>u});var i=s(44557),n=s(53713),a=s(94343),o=s(21576),r=s(68843),c=s(5817),l=s(18157),d=s(36266);const u=(e,t)=>{var s;const u=e.getState(),{contentObj:g,conversation_id:h,reply_id:p,message_id:_,section_id:m}=t,v=(0,r.w5)(t);d.vF.info({namespace:null===(s=t.localInfo)||void 0===s?void 0:s.from,message:"Suggest Message",meta:{message:t}});const{suggest:f}=g||{},y=(0,n.Bog)(f)?f:[];var b;if(!p)return void d.vF.warning({namespace:null===(b=t.localInfo)||void 0===b?void 0:b.from,message:"invalid suggest message: expect reply_id but found undefined/null"});const S=u.getReportEvents(h,p),k=S.message_receive_suggests;var M,A;(v&&p&&(0,l.D)(u,h,_,JSON.stringify(y)),u.updateSuggestMessage(h,(e=>{var s,i,n,a;return"1"===(null===(s=t.ext)||void 0===s?void 0:s.onboarding)||"2"===(null===(i=t.ext)||void 0===i?void 0:i.onboarding)?{replyId:p,loading:!1,failed:!1,expired:void 0,suggests:y}:(null==e?void 0:e.replyId)===p?(null!==(n=e.suggests)&&void 0!==n&&n.length||null==k||k.addDurationPoint("first_suggest_item"),null==k||k.addDurationPoint("last_suggest_item",!0),{replyId:p,loading:!1,failed:!1,expired:void 0,suggests:y}):(d.vF.warning({namespace:null===(a=t.localInfo)||void 0===a?void 0:a.from,message:"ignore suggest message: non-match reply_id"}),e)})),v)&&(o.C.success(S,{meta:(0,i.A)((0,i.A)({},(0,a.BX)(t)),{},{is_include_suggests:!0})}),c.H.trackEvent("receive_prompt",(0,i.A)((0,i.A)({duration:null==k||null===(M=k.getDuration())||void 0===M?void 0:M.last,conversation_id:h,section_id:m},null!=y&&y.length?{success:1,quantity:(null==y?void 0:y.length)||0}:{success:0,result:"prompt_empty"}),{},{message_id:_,is_cache:"1"===String(null==t||null===(A=t.ext)||void 0===A?void 0:A.is_from_cache)?1:0})))}},17771:(e,t,s)=>{s.d(t,{Y:()=>m});var i=s(44557),n=s(2633),a=s(3888),o=s(37814),r=s(72106),c=s(85371),l=s(94343),d=s(21576),u=s(68843),g=s(76049),h=s(35482),p=s(47614),_=s(56448);const m=(e,t)=>{const s=e.getState(),{conversation_id:m,reply_id:v=""}=t,f=(0,u.HN)(t),y=(0,u.Wr)(t)||(0,u.tG)(t)||(0,u.Y4)(t)||(0,u.t6)(t);y&&s.updateSearchResultStatus(v,!1),s.updateMessageList({conversationId:m,immerUpdate:(...e)=>{const[b]=e,{draftLocalMessageMap:S}=b,k=(0,u.um)(v),M=(0,a.A)((0,o.A)(S,(e=>(null==e?void 0:e.reply_id)===v)));if(v&&(0,n.A)(M)){var A,E,w,I;const s=(0,h.hT)(b);(0,l.eT)({isRegenerate:Boolean(null==s||null===(A=s[0])||void 0===A?void 0:A.regen_head),regenHead:null==s||null===(E=s[0])||void 0===E?void 0:E.regen_head,immerUpdateMessage:e,newLocalMessageId:k,conversationId:m,replyId:v,scene:"",sectionId:t.section_id,localMessageStatus:g.FQ.ReceivingStream,createdFrom:"thinking"}),(0,l.dk)({isRegenerate:Boolean(null==s||null===(w=s[0])||void 0===w?void 0:w.regen_head),immerUpdateMessage:e,newLocalMessageId:k,regenHead:null==s||null===(I=s[0])||void 0===I?void 0:I.regen_head})}v&&!(0,n.A)(M)&&(0,l.uX)({immerUpdateMessage:e,newLocalMessageId:k,isSearchMessage:y});const L=S[k];if(L){if((0,p.u)(L,t))return;const e=(0,i.A)((0,i.A)({},s.getReportEvents(m,k)),s.getReportEvents(m,v||""));f?d.C.error(e,{reason:"thinking-error",meta:(0,l.BX)(t,L)}):d.C.addDuration(e,"thinking"),S[k]=(0,i.A)((0,i.A)({},L),{},{local:(0,i.A)((0,i.A)({},L.local),{},{failed:!1,failedExpired:f?void 0:Date.now()+_.dc})},(0,r.A)(t,c.A))}}})}},25334:(e,t,s)=>{s.d(t,{P:()=>M});var i=s(44557),n=s(53719),a=s(72106),o=s(85371),r=s(92431),c=s(36266),l=s(94343),d=s(82289),u=s(5817),g=s(31317),h=s(21576),p=s(68843),_=s(76049),m=s(33187),v=s(35482),f=s(47614),y=s(56448),b=s(70053),S=s(94682),k=s(66221);const M=(e,t)=>{const s=e.getState(),{conversation_id:M,message_id:A,reply_id:E=""}=t,w=(0,b.Rx)(S.pU.getState(),M),I=(0,p.M5)(t),L=(0,p.oS)(t),R=(0,p.HN)(t),z=(0,p.KU)(t),C=(0,p.RR)(t),T=(0,p.oQ)(t),U=(0,p.w5)(t),x=(0,p.Et)(t),B=C?y.sq:E;let O=!1;if(s.updateMessageList({conversationId:M,immerUpdate:(...e)=>{const[m]=e;(0,d._V)(m,t)&&c.vF.persist.warning({message:"receive message failed",meta:{message:t}});const{draftLocalMessageMap:k,draftMessageMap:z,draftMessageLinks:C,draftRegenerateMessageMap:P}=m,q=Boolean(z[A]),D=(0,p.um)(B),G=k[D];let N=k[A];if(!q&&!N&&!G){var F,j;const s=(0,v.hT)(m);(0,l.eT)({isRegenerate:T,regenHead:null==s||null===(F=s[0])||void 0===F?void 0:F.regen_head,immerUpdateMessage:e,newLocalMessageId:A,conversationId:M,replyId:E,message:t,scene:"",sectionId:t.section_id,localMessageStatus:_.FQ.ReceivingStream,createdFrom:"message",conversationType:w}),(0,l.dk)({isRegenerate:T,immerUpdateMessage:e,newLocalMessageId:A,regenHead:null==s||null===(j=s[0])||void 0===j?void 0:j.regen_head}),N=k[A],O=!0}if(G){(0,p.Wi)(G)&&(O=!0);const s=(0,v.iv)(m,{isLocalMessage:!0,messageId:D});if(-1!==s){var H,V;const n=C.splice(s,1),a=x?{messageKey:null==n?void 0:n[0].messageKey}:{};(0,l.eT)({isRegenerate:T,regenHead:null==n||null===(H=n[0])||void 0===H?void 0:H.regen_head,immerUpdateMessage:e,newLocalMessageId:A,conversationId:M,replyId:E,message:t,scene:"",sectionId:t.section_id,localMessageStatus:_.FQ.ReceivingStream,createdFrom:"replace_temporary_message",conversationType:w}),(0,l.dk)((0,i.A)({isRegenerate:T,immerUpdateMessage:e,newLocalMessageId:A,regenHead:null==n||null===(V=n[0])||void 0===V?void 0:V.regen_head},a))}N=k[A]}if(!q&&N){const e=(0,i.A)((0,i.A)((0,i.A)({},s.getReportEvents(M,D||"")),s.getReportEvents(M,N.local_message_id||"")),s.getReportEvents(M,N.reply_id||"")),d=e.receive_message,w=(0,l.BX)(t,N);if(O){var K,W,$;if(R){const t={reason:"first-pkg-error",meta:(0,i.A)((0,i.A)({},w),{},{is_include_suggests:!1})};h.C.error(e,t)}else{var J,Q,X;h.C.addDuration(e,"first"),u.H.trackEvent("receive_answer",{duration:null==d||null===(J=d.getDuration())||void 0===J?void 0:J.first,from:null===(Q=t.localInfo)||void 0===Q?void 0:Q.from,next_connection_type:t.next_connection_type,content_type:t.content_type,success:1,conversation_id:M,bot_id:(0,b.Xc)(S.pU.getState(),M),message_id:A,section_id:null==t?void 0:t.section_id,scene:null==d?void 0:d.getMeta().scene,message_type:(0,p.rJ)(t),is_cache:"1"===String(null==t||null===(X=t.ext)||void 0===X?void 0:X.is_from_cache)?1:0})}u.H.trackEvent("message_receive_first_package",{conversation_id:M,status:R?1:0,error_code:null==w?void 0:w.has_err,duration:null==d||null===(K=d.getDuration())||void 0===K?void 0:K.first,message_id:A,from:null===(W=t.localInfo)||void 0===W?void 0:W.from,next_connection_type:t.next_connection_type,content_type:null==t?void 0:t.content_type}),u.H.trackEvent("message_answer_start",{stream:1,from:null===($=t.localInfo)||void 0===$?void 0:$.from,next_connection_type:t.next_connection_type,content_type:t.content_type,section_id:null==t?void 0:t.section_id,reply_id:E,conversation_id:M})}else if(R){const t={reason:I?"stream-error":"error",meta:(0,i.A)((0,i.A)({},w),{},{is_include_suggests:!1})};h.C.error(e,t)}if((0,f.u)(N,t))return;var Z,Y;if((0,l.Dj)(N,t))h.C.addDuration(e,"receive_first_chunk_packet"),u.H.trackEvent("receive_first_chunk_packet",{conversation_id:M,status:R?1:0,error_code:null==w?void 0:w.has_err,duration:null==d||null===(Z=d.getDuration())||void 0===Z?void 0:Z.receive_first_chunk_packet,message_id:A,from:null===(Y=t.localInfo)||void 0===Y?void 0:Y.from,next_connection_type:t.next_connection_type,content_type:null==t?void 0:t.content_type});if(k[A]=(0,i.A)((0,i.A)((0,i.A)({},N),{},{local:(0,i.A)((0,i.A)({},N.local),{},{status:_.FQ.ReceivingStream,failed:!1,failedExpired:L||R?void 0:Date.now()+y.F6})},(0,a.A)(t,o.A)),{},{local_message_id:N.local_message_id}),L){var ee,te,se,ie,ne,ae,oe;if(c.vF.info({namespace:null===(ee=t.localInfo)||void 0===ee?void 0:ee.from,message:"replaceLocalMessageByRemote",meta:w}),(0,v.sK)({draft:m,localMessage:N,message:t,useRemoteMessageKey:!x,useOriginalMessageKey:!!x}),N.local.isRegenerate){const e=(0,r.A)(t);e.ext&&(e.ext.regen="1"),e.ext&&(e.ext.regen_active="1"),P.messageMap=(0,i.A)((0,i.A)({},P.messageMap),{},{[A]:e})}if((0,v.ZH)({draft:m,localMessage:N,message:t,omitReportEventProperty:["receive_message","receive_message_package"]}),B)null===(oe=l.Pv.getHttpAdapter())||void 0===oe||oe.abortMessage({replyId:B});h.C.addDuration(e,"success"),h.C.success((0,n.A)(e,["receive_message","receive_message_package"]),{meta:w});const s=e.receive_message;u.H.trackEvent("receive_stream",(0,i.A)({duration:null==s||null===(te=s.getDuration())||void 0===te?void 0:te.success,from:null===(se=t.localInfo)||void 0===se?void 0:se.from,next_connection_type:t.next_connection_type,content_type:t.content_type,success:1,conversation_id:M,bot_id:(0,b.Xc)(S.pU.getState(),M),message_id:A,reply_id:B,section_id:null==t?void 0:t.section_id,scene:null==s?void 0:s.getMeta().scene,is_onboarding:(0,p.RR)(t)?1:0,is_soft_link:(0,p.i0)(t),message_type:(0,p.rJ)(t),is_cache:"1"===String(null==t||null===(ie=t.ext)||void 0===ie?void 0:ie.is_from_cache)?1:0},(0,g.E)(t))),u.H.trackEvent("message_answer_end",{type:t.message_type,from:null===(ne=t.localInfo)||void 0===ne?void 0:ne.from,next_connection_type:t.next_connection_type,content_type:t.content_type,success:1,stream:1,section_id:null==t?void 0:t.section_id,result:void 0,reply_id:E,message_id:A,duration:null==s||null===(ae=s.getDuration())||void 0===ae?void 0:ae.success,conversation_id:M})}U&&h.C.success(e,(0,i.A)({is_include_suggest:!1},w))}else{var re;if(O=!q,z[A]=t,q||C.push({isLocalMessage:!1,messageId:A}),L)c.vF.persist.info({namespace:null===(re=t.localInfo)||void 0===re?void 0:re.from,message:"Receive Non-local Finished Message",meta:{message_id:A,conversation_id:M,is_exist:q}})}}}),t.section_id&&O&&!z){const s=C?void 0:(0,m.tP)(e.getState(),M,{isLocalMessage:!1,messageId:B});(null==s?void 0:s.section_id)!==t.section_id&&S.pU.getState().updateLastSectionId(M,t.section_id)}const P=(0,p.Wp)(t);if(L&&P&&t.reply_id){if(!s.hasReportEvent(M,t.reply_id,"message_receive_suggests")){const e=(0,c.XB)({eventName:"message_receive_suggests",meta:{message_id:t.message_id,reply_id:t.reply_id,conversation_type:w}});e.errorIfIdle(y.so,{reason:"timeout"}),s.mergeReportEvents(M,t.reply_id,{message_receive_suggests:e})}s.updateSuggestMessage(M,(()=>({replyId:E,loading:!0,failed:!1,expired:Date.now()+y.so,suggests:[]})))}L&&(0,p.pu)(t)&&s.updateSearchResultStatus(B,!0),k.B.emit("message.updated",s,t),R&&k.B.emit("message.serverError",s,t)}},62554:(e,t,s)=>{s.d(t,{Dj:()=>g,Gm:()=>f,O2:()=>h,TU:()=>p,dk:()=>m,eT:()=>_,uX:()=>v});var i=s(44557),n=s(3888),a=s(37814),o=s(20177),r=s(70593),c=s(36266),l=s(68843),d=s(76049),u=s(56448);function g(e,t){var s,i;return(null===(s=e.localInfo)||void 0===s?void 0:s.from)!==d.aU.HttpChunk&&(null===(i=t.localInfo)||void 0===i?void 0:i.from)===d.aU.HttpChunk}function h(e,{conversationId:t,replyId:s}){const i=(0,a.A)(e.localMessageMap[t],(e=>(null==e?void 0:e.reply_id)===s));return(0,n.A)(i)}function p(e,{conversationId:t,localMessageId:s}){var i;return null===(i=e.localMessageMap[t])||void 0===i?void 0:i[s]}function _(e){var t;const{conversationType:s,isRegenerate:n,immerUpdateMessage:a,newLocalMessageId:o,conversationId:r,replyId:d,sectionId:g,scene:h,message:p={},timeout:_=0,regenHead:m,localMessageStatus:v,createdFrom:f}=e,[y]=a,b={conversation_id:r,message_id:d,is_regenerate:n,conversation_type:s,scene:h};"ack"===f&&y.draftLocalMessageMap[o]?y.draftMessageReportEventMap[o]=(0,i.A)((0,i.A)({},y.draftMessageReportEventMap[o]),{},{receive_message:(0,c.XB)({eventName:"receive_message",meta:b})}):(y.draftLocalMessageMap[o]=(0,l.xf)({prevMessageId:n?null===(t=(0,l.WZ)(y.draftMessageLinks,(e=>e.regen_head===m&&!e.isLocalMessage)))||void 0===t?void 0:t.messageId:d,localMessageStatus:v,message:(0,i.A)((0,i.A)({},p),{},{conversation_id:r,section_id:g,local_message_id:o,reply_id:d}),failedExpired:Date.now()+(1e3*Number(_)||u.dc),messageLinks:y.draftMessageLinks,isRegenerate:n}),"send-message"!==f&&"replace_temporary_message"!==f&&(y.draftMessageReportEventMap[o]=(0,i.A)((0,i.A)({},y.draftMessageReportEventMap[o]),Object.fromEntries(["receive_message","receive_message_package","receive_total_messages"].map((e=>[e,(0,c.XB)({eventName:e,meta:b})]))))))}function m(e){const{isRegenerate:t,immerUpdateMessage:s,newLocalMessageId:n,regenHead:a,messageKey:r}=e,[c]=s,l=(0,o.A)(c.draftMessageLinks,(e=>e.messageId===n));if(l)l.regen_head=a;else{const e=(0,i.A)({isLocalMessage:!0,messageId:n},r?{messageKey:r}:{});t&&(e.regen_head=a),c.draftMessageLinks.push(e)}}function v(e){const{immerUpdateMessage:t,newLocalMessageId:s,isSearchMessage:n=!1}=e,[a]=t,o=(0,r.A)(a.draftMessageLinks,(e=>e.messageId===s));o&&n&&(a.draftMessageLinks[o]=(0,i.A)((0,i.A)({},a.draftMessageLinks[o]),{},{messageKey:"search_".concat(s)}))}const f=(e,t)=>{var s;return(null===(s=e.userOgfQuota)||void 0===s?void 0:s.nextMessageUseOgf)?(0,i.A)((0,i.A)({},t),{},{llm_model_type:"2"}):t}},37918:(e,t,s)=>{s.d(t,{B:()=>i});const i=(e,t)=>{var s,i,n,a,o,r;return{conversation_id:e.conversation_id,message_id:e.message_id,from:null===(s=e.localInfo)||void 0===s?void 0:s.from,local_message_id:null==t?void 0:t.local_message_id,is_regenerate:null==t?void 0:t.local.isRegenerate,has_err:null==e||null===(i=e.ext)||void 0===i?void 0:i.has_err,log_id:null===(n=e.localInfo)||void 0===n?void 0:n.logId,inner_log_id:null==e||null===(a=e.ext)||void 0===a?void 0:a.log_id,trace_id:null===(o=e.localInfo)||void 0===o?void 0:o.traceId,retried:null==e||null===(r=e.localInfo)||void 0===r?void 0:r.retried,next_connection_type:null==e?void 0:e.next_connection_type,content_type:String(e.content_type)}}},84917:(e,t,s)=>{s.d(t,{Q:()=>v});var i=s(44557),n=s(47807),a=s(49931),o=s(36266),r=s(2325),c=s(33664),l=s(51065),d=s(54020),u=s(56448),g=s(5817),h=s(9530),p=s(11003),_=s(53523),m=s(76454);const v={logSendMessage:e=>{o.vF.info({message:"send message",meta:{localMessage:e}})},trackSendMessageStartEvent:e=>{g.H.trackEvent("message_send_start",{from:l.aU.Socket,type:e.message_type,send_id:e.message_id,section_id:e.section_id,local_message_id:e.local_message_id,conversation_id:e.conversation_id})},trackSendMessageEndEvent:(e,t)=>{var s,i,n;g.H.trackEvent("message_send_end",{success:t.success?1:0,stream:0,duration:(null===(s=t.sendMessageReport)||void 0===s||null===(s=s.getDuration())||void 0===s?void 0:s.ack)||(null===(i=t.sendMessageReport)||void 0===i||null===(i=i.getDuration())||void 0===i?void 0:i.failed),from:null==e||null===(n=e.localInfo)||void 0===n?void 0:n.from,type:e.message_type,section_id:e.section_id,local_message_id:e.local_message_id,conversation_id:e.conversation_id})},trackSendMessageEvent:(e,t)=>{const{resolved:s,ctx:a,scene:o,content_source:r,sec_scene:_,use_skill:m=!1,skill_id:v,skill_name:f,reportParams:y}=e,{enterFrom:b}=a;var S,k,M;s.isRegenerate||g.H.trackEvent("send_message",(0,i.A)((0,i.A)((0,i.A)((0,i.A)((0,i.A)({message_type:s.message_type,from:l.aU.Socket,conversation_id:a.conversationId,conversation_type:s.conversation_type,bot_id:s.bot_id,chat_type:s.chat_type,scene:"seo_keyboard"===o?"keyboard":o,sec_scene:"resend"===o?"resend":_,use_skill:m,skill_id:v,skill_name:f,is_gpt4:(0,d.hy)(),is_quote:(Number(null===(S=(0,n.O)(null===(k=s.localCreateExt)||void 0===k?void 0:k.reference_content))||void 0===S?void 0:S.length)||0)>0?1:0},y),s.content_type===c.cM.Text?{original_content_source:(null==r?void 0:r.source)||u.Zp.Other}:{}),["keyboard_unlog","seo_keyboard"].includes(o)&&h.v.loginSource?{previous_page:h.v.loginSource}:{}),b&&"bot_discover"===b?{user_id:h.v.userId,req_id:s.bot_id?p.C.actions.getBotIdToRequestIdMap()[s.bot_id]:"",recommend_from:"bot_list_discover"}:{}),null!==(M=t.ext)&&void 0!==M&&M.collection_id?{collection_id:t.ext.collection_id}:{}))},trackOnBoardingMessageSentEvent(){g.H.trackEvent("auto_onboarding_message_sent",{type:"create_chat"})},trackUploadParseStatus(e,t){const{conversationId:s}=t.resolved;if((0,_.Bu)(t)){var o;const c=t.nestedItems.length,{botInfo:l}=(0,m.cL)(s),d=(0,n.O)(null===(o=t.resolved.localCreateExt)||void 0===o?void 0:o.input_skill);t.nestedItems.forEach((n=>{var o;const u={conversation_id:s,chat_type:(0,m.CB)(s,l),skill_name:(d.skill_type||"").toString(),skill_id:d.skill_id||"",upload_id:t.resolved.localMessageId,upload_collection_way:c>1?"multi":"single",upload_type:"Image"===(0,a.ti)(n.fileName)?"pic":"pdf",upload_file_type:(0,a.GO)(n.fileName),upload_file_size:(null===(o=e.preprocessTaskMap[n.identifier])||void 0===o||null===(o=o.file)||void 0===o?void 0:o.size)||0};n.parseState===r.hI.ParseState_Failed?g.H.trackEvent("upload_parse_status",(0,i.A)({status:0,error_code:"parse_failed"},u)):g.H.trackEvent("upload_parse_status",(0,i.A)({status:1},u))}))}}}},65284:(e,t,s)=>{s.d(t,{B:()=>a});var i=s(56642),n=s(98101);const a=(e,t=i.x)=>{const s=(...s)=>(0,n.oz)((t=>e(t,...s)),t);return s.raw=e,s}},42483:(e,t,s)=>{s.d(t,{O:()=>i.O});s(80160),s(53713),s(61106),s(36266);var i=s(45791);s(75305)},45791:(e,t,s)=>{s.d(t,{O:()=>i});let i=function(e){return e[e.FetchFailed=1001]="FetchFailed",e[e.ResponseIsInvalid=1002]="ResponseIsInvalid",e[e.StreamParseFailed=1003]="StreamParseFailed",e[e.ServerError=1004]="ServerError",e[e.AbortFetch=1005]="AbortFetch",e}({})},28074:(e,t,s)=>{s.d(t,{O4:()=>n.O,QV:()=>i.QV});var i=s(15966),n=s(42483)},15966:(e,t,s)=>{s.d(t,{QV:()=>i.Q});s(36266),s(53713),s(66387),s(56448);var i=s(81008)},81008:(e,t,s)=>{s.d(t,{Q:()=>i});var i={open:"open",close:"close",error:"error",message:"message"}},59207:(e,t,s)=>{s(60588)},18029:(e,t,s)=>{s.d(t,{d:()=>l});var i=s(10633),n=s(60588),a=s(34023),o=s(9945),r=s(76049),c=s(60737);class l extends n.A{constructor(){super(),(0,i.A)(this,"_workerMap",new Map),(0,i.A)(this,"_poolSize",1),(0,i.A)(this,"_queue",[]),(0,i.A)(this,"_maxRetryAttempt",3),(0,i.A)(this,"_hasInitiated",!1),(0,i.A)(this,"_fetchStream",void 0),(0,i.A)(this,"_baseURL",void 0),(0,i.A)(this,"_getCommonHttpParams",void 0),(0,i.A)(this,"_getCommonHttpHeaders",void 0),(0,i.A)(this,"_store",void 0),(0,i.A)(this,"from",r.aU.HttpChunk),this._handleEvent=this._handleEvent.bind(this),this._handleFinish=this._handleFinish.bind(this),this._handleClean=this._handleClean.bind(this),this._handleUpdateTask=this._handleUpdateTask.bind(this)}_initWorker(){const e=new a.O({maxRetryAttempts:this._maxRetryAttempt,fetchStream:this._fetchStream,getCommonHttpParams:this._getCommonHttpParams,getCommonHttpHeaders:this._getCommonHttpHeaders,baseURL:this._baseURL});return e.on("event",this._handleEvent),e.on("finish",this._handleFinish),e.on("clean",this._handleClean),e.on("update_task",this._handleUpdateTask),this._workerMap.set(e.id,e),e}_handleUpdateTask(e,t){var s;null===(s=this._store)||void 0===s||null===(s=s.getState())||void 0===s||s.updateChunkTask(e,t)}_handleClean(e){var t;null===(t=this._store)||void 0===t||null===(t=t.getState())||void 0===t||t.removeChunkTask(e)}_handleFinish(e){const t=this._workerMap.get(e);if((null==t?void 0:t.status)===o.T.idle){const e=this._queue.pop();e&&(null==t||t.startTask(e))}}_handleEvent(e){(0,c.Pt)({event:e,adaptor:this})}_checkMessageInWorking(e){for(const t of this._workerMap.values())if(t.replyId===e)return!0;for(const t of this._queue)if(t.replyId===e)return!0;return!1}init(e,t){var s,i,n,a,o,r;this._hasInitiated||((0,c.Ns)({store:e,adaptor:this}),c.Pv.registerHttpChunk(this),this._store=e,this._poolSize=(null===(s=t.httpChunkConfig)||void 0===s?void 0:s.poolSize)||1,this._maxRetryAttempt=(null===(i=t.httpChunkConfig)||void 0===i?void 0:i.retryAttempt)||3,this._getCommonHttpParams=null===(n=t.httpChunkConfig)||void 0===n?void 0:n.getCommonHttpParams,this._getCommonHttpHeaders=null===(a=t.httpChunkConfig)||void 0===a?void 0:a.getCommonHttpHeaders,this._fetchStream=null===(o=t.httpChunkConfig)||void 0===o?void 0:o.fetchStream,this._baseURL=null===(r=t.httpChunkConfig)||void 0===r?void 0:r.baseURL,this._hasInitiated=!0)}resumeChunkTask(e){e.forEach((e=>{const{replyId:t}=e;t&&!this._checkMessageInWorking(t)&&e&&this._pullMessage(e)}))}pullMessage(e){var t;const{reply_id:s}=e;if(!s||this._checkMessageInWorking(s))return;const i=null===(t=this._store)||void 0===t||null===(t=t.getState())||void 0===t?void 0:t.createChunkTask(s,e);i&&this._pullMessage(i)}_pullMessage(e){for(const t of this._workerMap.values())if(t.status===o.T.idle)return void t.startTask(e);if(this._workerMap.size<this._poolSize){this._initWorker().startTask(e)}else this._queue.push(e)}abortMessage({replyId:e}){const t=this._queue.findIndex((t=>t.replyId===e));if(~t)return this._queue.splice(t,1),void this._handleClean(e);for(const s of this._workerMap.values())s.replyId===e&&s.abort()}drop(){this._hasInitiated=!1,(0,c.IU)({adaptor:this}),c.Pv.unregisterHttpChunk()}}},90370:(e,t,s)=>{s.d(t,{n:()=>n});var i=s(10633);class n{constructor(e=0){(0,i.A)(this,"_attempts",0),this._maxRetryAttempts=e}add(){this._attempts++}reset(){this._attempts=0}get attempts(){return this._attempts}matchMaxRetryAttempts(){return this._attempts>=this._maxRetryAttempts}}},9945:(e,t,s)=>{s.d(t,{T:()=>i});let i=function(e){return e[e.running=1]="running",e[e.idle=2]="idle",e}({})},34023:(e,t,s)=>{s.d(t,{O:()=>k});var i=s(44557),n=s(14065),a=s(10633),o=s(3888),r=s(85886),c=s(47686),l=s(60588),d=s(53713),u=s(36266),g=s(54343),h=s(83894),p=s(9945),_=s(90370),m=s(93230),v=s(47614),f=s(28074),y=s(76049),b=s(56448),S=s(9530);class k extends l.A{constructor(e){super(),(0,a.A)(this,"_retryCounter",void 0),(0,a.A)(this,"_abortTrigger",void 0),(0,a.A)(this,"_originFetchStream",void 0),(0,a.A)(this,"_baseURL",void 0),(0,a.A)(this,"_chunkTask",void 0),(0,a.A)(this,"_getCommonHttpParams",void 0),(0,a.A)(this,"_getCommonHttpHeaders",void 0),(0,a.A)(this,"_emitEventThrottle",void 0),(0,a.A)(this,"id",void 0),(0,a.A)(this,"status",void 0),this._config=e;const{maxRetryAttempts:t,fetchStream:s,getCommonHttpParams:i,getCommonHttpHeaders:n,baseURL:o,chunkInterval:c=300}=this._config;this._retryCounter=new _.n(t),this.id=Symbol("eventSourceWorker"),this.status=p.T.idle,this._handleEvent=this._handleEvent.bind(this),this._handleError=this._handleError.bind(this),this._handleFinish=this._handleFinish.bind(this),this._subscribeAbortTrigger=this._subscribeAbortTrigger.bind(this),this._originFetchStream=s,this._getCommonHttpParams=i,this._getCommonHttpHeaders=n,this._baseURL=o;const l=this.emit.bind(this);this._emitEventThrottle=(0,r.A)((e=>l("event",...e)),c)}_fetchStream(e){var t=this;return(0,n.A)((function*(){var s;yield null===(s=t._originFetchStream)||void 0===s?void 0:s.call(t,{req:{url:`${t._baseURL||""}/alice/message/stream_reply`,body:{seq_st:(Number(e.chunkSeq)||0)+1,reply_id:e.replyId,binary_type:(0,m.sI)()}},reportMeta:{conversation_id:(null==e?void 0:e.conversationId)||"",reply_id:e.replyId,seq_st:(Number(e.chunkSeq)||0)+1,binary_type:(0,m.sI)()},onMessage:t._handleEvent,onError:t._handleError,onFinish:t._handleFinish,subscribeAbortTrigger:t._subscribeAbortTrigger,getCommonHttpParams:t._getCommonHttpParams,getCommonHttpHeaders:t._getCommonHttpHeaders})}))()}_subscribeAbortTrigger(e){this._abortTrigger=e}_handleEvent(e,t){var s;null!==(s=S.v.localFeatureConfig)&&void 0!==s&&s.consoleIncrementMessagePacket&&u.vF.info({namespace:"http-chunk",message:"Increment Chunk Received",meta:{chunk:e}}),e.event_type===g.B.Message&&this._batchUpdateMessage(e,t)}_batchUpdateMessage(e,t){if(e.message_list){const s=[];for(const i of e.message_list){const{mergedMessage:e}=this._mergeMessage(i,t);s.push(e)}const n=(0,i.A)((0,i.A)({},e),{},{message_list:s});this._emitEventThrottle([n]);n.message_list.every((e=>{var t;return"1"===(null==e||null===(t=e.ext)||void 0===t?void 0:t.is_finish)}))&&this._emitEventThrottle.flush()}if(e.message){var s;const{message:n}=e,{mergedMessage:a}=this._mergeMessage(n,t),o=(0,i.A)((0,i.A)({},e),{},{message:a});this._emitEventThrottle([o]);"1"===(null===(s=o.message)||void 0===s||null===(s=s.ext)||void 0===s?void 0:s.is_finish)&&this._emitEventThrottle.flush()}}_mergeMessage(e,t){var s;if(!this._chunkTask)return{mergedMessage:e};const{completionMessageMap:i,replyId:n}=this._chunkTask,{message_id:a}=e||{};i[b.Ln]&&delete i[b.Ln];const o=a||b.Ln,{mergedMessage:r}=(0,v.w)(i[o]||{},e,{from:y.aU.HttpChunk,logId:t,retried:!(null===(s=this._retryCounter)||void 0===s||!s.attempts)}),c=r||e;return i[o]=c,this.emit("update_task",n,c),{mergedMessage:c}}_handleError(e,t){if(e.code===f.O4.ServerError){const s=(0,d.OlY)(e.msg),{code:i}=s;switch(i){case h.t.NETWORK_TIMEOUT:case h.t.MYSQL_ERROR:case h.t.REDIS_ERROR:case h.t.SYSTEM_ERROR2:return void this._reFetchStream(s,t);default:this._batchEmitErrorMessage(s,t)}}else{if(e.code===f.O4.AbortFetch)return;this._reFetchStream({msg:e.msg,code:m.ge},t)}}_reFetchStream(e,t){var s=this;return(0,n.A)((function*(){if(s._retryCounter.matchMaxRetryAttempts())return s._batchEmitErrorMessage(e,t),void s._handleFinish();s._retryCounter.add(),s._retryCounter.attempts>1&&(yield s._wait(s._retryCounter.attempts)),s._chunkTask&&s._fetchStream(s._chunkTask)}))()}_wait(e){return new Promise((t=>{setTimeout(t,this._getIntervalValue(e))}))}_getIntervalValue(e){const{minFetchInterval:t=500,maxFetchInterval:s=5e3,fetchIntervalGrowFactor:i=2}=this._config||{},n=t*Math.pow(i,e-1);return n>s?s:n}_handleFinish(e){e&&this._batchFinishMessage(),this._reset(),this.emit("finish",this.id)}_batchEmitErrorMessage(e,t){if(!this._chunkTask)return;const{completionMessageMap:s}=this._chunkTask;for(const i of(0,o.A)(s))this.emit("event",(0,m.C_)(i,e,t))}_batchFinishMessage(){if(!this._chunkTask)return;const{completionMessageMap:e}=this._chunkTask;this._emitEventThrottle.flush();for(const t of(0,c.A)(e)){const s=(0,i.A)((0,i.A)({},e[t]),{},{localInfo:(0,i.A)((0,i.A)({},e[t].localInfo||{}),{},{finishReply:!0,from:y.aU.HttpChunk})});e[t]=s,this.emit("event",{event_type:g.B.Message,message:s})}}_reset(){var e;this.emit("clean",(null===(e=this._chunkTask)||void 0===e?void 0:e.replyId)||""),this._retryCounter.reset(),this._chunkTask=void 0,this.status=p.T.idle}_init(e){this.status=p.T.running,this._chunkTask=(0,m.NY)(e),this._retryCounter.reset()}get replyId(){var e;return null===(e=this._chunkTask)||void 0===e?void 0:e.replyId}startTask(e){this._init(e),this._fetchStream(e)}abort(){var e;this._emitEventThrottle.flush(),null===(e=this._abortTrigger)||void 0===e||e.call(this,{msg:"breakdown",code:f.O4.AbortFetch}),this._reset()}}},1099:(e,t,s)=>{s.d(t,{m:()=>b});var i=s(44557),n=s(10633),a=s(53719),o=s(37462),r=s(60588),c=s(36266),l=s(53713),d=s(54343),u=s(97327),g=s(33664),h=s(3896),p=s(9820),_=s(2615),m=s(51065),v=s(60737),f=s(56448),y=s(77058);class b extends r.A{constructor(){super(),(0,n.A)(this,"from",m.aU.HttpLongPolling),(0,n.A)(this,"_config",void 0),(0,n.A)(this,"_pullMessageTasks",{}),(0,n.A)(this,"_hasInitiated",!1),this._handleEvent=this._handleEvent.bind(this)}_handleEvent(e,t){if(e.event_type===d.B.Message&&e.message){const s=(0,p.H)(e.message,{from:this.from,retried:!0,logId:t});e.message=s}if(e.event_type===d.B.Message&&e.message_list){const s=e.message_list.map(((e,s,i)=>(0,p.H)(e,{from:this.from,retried:!0,logId:t,messageListCount:i.length,inMessageListPos:s})));e.message_list=s}(0,v.Pt)({event:e,adaptor:this})}init(e,t){this._hasInitiated||(this._config=null==t?void 0:t.httpConfig,(0,v.Ns)({store:e,adaptor:this}),v.Pv.registerHttp(this),this._hasInitiated=!0)}sendMessage(e){var t;if(e.length<=0)return;const s=1===e.length?{message:e[0]}:{message_list:e},n=(0,i.A)((0,i.A)({},s),{},{event_type:d.B.Message});u.j.apiService.message.MessageReplay({payload:h.K.enc((new TextEncoder).encode((0,l.e4x)(n)))},{overrideParams:{aid:null===(t=this._config)||void 0===t?void 0:t.ws_app_id},overrideConfig:{timeout:f.Sf}}).then((e=>{if(!e.payload)throw new Error("Invalid ack message");const t=h.K.dec(e.payload);this._handleEvent((0,l.OlY)(l.Asr.read(t,0,t.byteLength)),(0,y.n)(e))})).catch((e=>{c.vF.info(`get ack message failed: ${e.message}`)}))}sendCmd(e){var t;if(!e.length)return;const s={cmd:e[0],event_type:d.B.Cmd};u.j.apiService.message.MessageReplay({payload:h.K.enc((new TextEncoder).encode((0,l.e4x)(s)))},{overrideParams:{aid:null===(t=this._config)||void 0===t?void 0:t.ws_app_id},overrideConfig:{timeout:f.Sf}}).then((e=>{if(!e.payload)throw new Error("Invalid ack message");const t=h.K.dec(e.payload);this._handleEvent((0,l.OlY)(l.Asr.read(t,0,t.byteLength)),(0,y.n)(e))})).catch((e=>{c.vF.info(`get ack message failed: ${e.message}`)}))}_fetchMessage(e){u.j.apiService.message.GetMessageReply({message_id:e.reply_id||e.message_id,conversation_id:e.conversation_id},{overrideConfig:{timeout:f.EB}}).then((t=>{var s;if(this._pullMessage(e,f.MV),null===(s=t.data)||void 0===s||null===(s=s.message_list)||void 0===s||!s.length)throw new Error("message_list is empty");const n=t.data.message_list.filter((e=>!(0,_.yU)(e)));n.sort(((e,t)=>(Number(e.index)||0)-(Number(t.index)||0))),n.forEach((e=>{var s,n;(this._handleEvent({message:e,event_type:d.B.Message},(0,y.n)(t)),null!=e&&null!==(s=e.ext)&&void 0!==s&&s.sp)&&this._handleEvent({message:(0,i.A)((0,i.A)({},(0,a.A)(e,["conversation_id","section_id","message_id","reply_id","message_type"])),{},{content_type:g.cM.Suggest,content:(0,l.e4x)({suggest:(0,l.OlY)(null==e||null===(n=e.ext)||void 0===n?void 0:n.sp)||""}),ext:{},meta_infos:[]}),event_type:d.B.Message},(0,y.n)(t))}))})).catch((t=>{this._pullMessage(e,f.MV),c.vF.info(`get message reply failed: ${t.message}`)}))}_pullMessage(e,t){var s;const{reply_id:i}=e;if(!i||"0"===i)return void c.vF.info("reply_id is empty, skip pull message");if(!this._pullMessageTasks[i])return void c.vF.info("task is empty, skip pull message");if(Date.now()-this._pullMessageTasks[i].expired>0)return;null===(s=this._pullMessageTasks[i])||void 0===s||s.clear();const n=setTimeout((()=>{this._fetchMessage(e)}),t),a=()=>{clearTimeout(n)};this._pullMessageTasks[i].clear=a,this._pullMessageTasks[i].finish=()=>{a(),delete this._pullMessageTasks[i]}}pullMessage(e,t){const{reply_id:s}=e;s&&"0"!==s&&(this._pullMessageTasks[s]?this._pullMessageTasks[s].clear():this._pullMessageTasks[s]={reply_id:s,finish:o.A,clear:o.A,expired:Date.now()+f.dc},this._pullMessage(e,t))}abortMessage(e){var t;null===(t=this._pullMessageTasks[e.replyId])||void 0===t||t.finish()}drop(){this._hasInitiated=!1,(0,v.IU)({adaptor:this}),v.Pv.unregisterHttp()}}},99552:(e,t,s)=>{s.d(t,{Lh:()=>i.L});s(59207),s(50068),s(18029),s(1099);var i=s(94587)},50068:(e,t,s)=>{s.d(t,{x:()=>g});var i=s(44557),n=s(10633),a=s(60588),o=s(53713),r=s(54343),c=s(9820),l=s(51065),d=s(60737),u=s(16709);s(57574);class g extends a.A{constructor(){super(),(0,n.A)(this,"client",void 0),(0,n.A)(this,"from",l.aU.Socket),(0,n.A)(this,"_hasInitiated",!1),this._handleEvent=this._handleEvent.bind(this)}_handleEvent({event:e,traceId:t}){if(e.event_type===r.B.Message&&e.message){const s=(0,c.H)(e.message,{from:this.from,traceId:t});e.message=s}if(e.event_type===r.B.Message&&e.message_list){const s=e.message_list.map(((e,s,i)=>(0,c.H)(e,{from:this.from,traceId:t,messageListCount:i.length,inMessageListPos:s})));e.message_list=s}(0,d.Pt)({event:e,adaptor:this})}init(e,t){if(this._hasInitiated)return;const{socketConfig:s}=t;if(!s)throw new Error("Invalid socket config, socket config is required");const{socketClient:i,launchConfig:n,getSocketParams:a}=s;this.client=i,this.client.init({onSocketStatusChange:e.getState().setSocketStatus,config:n,onMessage:this._handleEvent,refreshSocketConfig:()=>(0,u.w)(e),getSocketParams:a}),(0,d.Ns)({store:e,adaptor:this}),d.Pv.registerSocket(this),this._hasInitiated=!0}sendMessage(e){var t;if(e.length<=0)return;const s=1===e.length?{message:e[0]}:{message_list:e};null===(t=this.client)||void 0===t||t.send((0,o.e4x)((0,i.A)((0,i.A)({},s),{},{event_type:r.B.Message})))}sendCmd(e){var t;e.length&&(null===(t=this.client)||void 0===t||t.send((0,o.e4x)({cmd:e[0],event_type:r.B.Cmd})))}drop(){var e;this._hasInitiated=!1,(0,d.IU)({adaptor:this}),d.Pv.unregisterSocket(),null===(e=this.client)||void 0===e||e.drop()}}},57574:(e,t,s)=>{},50153:(e,t,s)=>{s(75305)},91138:(e,t,s)=>{var i=s(10633),n=s(74251),a=s(95809);class o extends n.Q{constructor(e){super(),(0,i.A)(this,"type",0),(0,i.A)(this,"info",void 0),a.C.util.initPartial(e,this)}static fromBinary(e,t){return(new o).fromBinary(e,t)}static fromJson(e,t){return(new o).fromJson(e,t)}static fromJsonString(e,t){return(new o).fromJsonString(e,t)}static equals(e,t){return a.C.util.equals(o,e,t)}}(0,i.A)(o,"runtime",a.C),(0,i.A)(o,"typeName","msg_pb.MetaInfo"),(0,i.A)(o,"fields",a.C.util.newFieldList((()=>[{no:1,name:"type",kind:"scalar",T:5},{no:2,name:"info",kind:"scalar",T:9,opt:!0}])));class r extends n.Q{constructor(e){super(),(0,i.A)(this,"conversationId",void 0),(0,i.A)(this,"sectionId",void 0),(0,i.A)(this,"messageId",void 0),(0,i.A)(this,"localMessageId",void 0),(0,i.A)(this,"index",void 0),(0,i.A)(this,"secSender",void 0),(0,i.A)(this,"replyId",void 0),(0,i.A)(this,"status",void 0),(0,i.A)(this,"createTime",void 0),(0,i.A)(this,"messageType",void 0),(0,i.A)(this,"contentType",void 0),(0,i.A)(this,"content",void 0),(0,i.A)(this,"ttsContent",void 0),(0,i.A)(this,"ext",{}),(0,i.A)(this,"nextConnectionType",void 0),(0,i.A)(this,"chunkSeq",void 0),(0,i.A)(this,"isDelta",void 0),(0,i.A)(this,"metaInfos",[]),(0,i.A)(this,"localConversationId",void 0),(0,i.A)(this,"botId",void 0),(0,i.A)(this,"appletPayload",{}),(0,i.A)(this,"modelType",void 0),(0,i.A)(this,"updateTime",void 0),(0,i.A)(this,"threadId",void 0),a.C.util.initPartial(e,this)}static fromBinary(e,t){return(new r).fromBinary(e,t)}static fromJson(e,t){return(new r).fromJson(e,t)}static fromJsonString(e,t){return(new r).fromJsonString(e,t)}static equals(e,t){return a.C.util.equals(r,e,t)}}(0,i.A)(r,"runtime",a.C),(0,i.A)(r,"typeName","msg_pb.PushMessage"),(0,i.A)(r,"fields",a.C.util.newFieldList((()=>[{no:1,name:"conversation_id",kind:"scalar",T:9,opt:!0},{no:2,name:"section_id",kind:"scalar",T:9,opt:!0},{no:3,name:"message_id",kind:"scalar",T:9,opt:!0},{no:4,name:"local_message_id",kind:"scalar",T:9,opt:!0},{no:5,name:"index",kind:"scalar",T:3,opt:!0},{no:6,name:"sec_sender",kind:"scalar",T:9,opt:!0},{no:7,name:"reply_id",kind:"scalar",T:9,opt:!0},{no:8,name:"status",kind:"scalar",T:5,opt:!0},{no:9,name:"create_time",kind:"scalar",T:3,opt:!0},{no:10,name:"message_type",kind:"scalar",T:5,opt:!0},{no:11,name:"content_type",kind:"scalar",T:5,opt:!0},{no:12,name:"content",kind:"scalar",T:9,opt:!0},{no:13,name:"tts_content",kind:"scalar",T:9,opt:!0},{no:14,name:"ext",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:15,name:"next_connection_type",kind:"scalar",T:5,opt:!0},{no:16,name:"chunk_seq",kind:"scalar",T:3,opt:!0},{no:17,name:"is_delta",kind:"scalar",T:8,opt:!0},{no:18,name:"meta_infos",kind:"message",T:o,repeated:!0},{no:19,name:"local_conversation_id",kind:"scalar",T:9,opt:!0},{no:20,name:"bot_id",kind:"scalar",T:9,opt:!0},{no:21,name:"applet_payload",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:22,name:"model_type",kind:"scalar",T:5,opt:!0},{no:23,name:"update_time",kind:"scalar",T:3,opt:!0},{no:24,name:"thread_id",kind:"scalar",T:3,opt:!0}])));class c extends n.Q{constructor(e){super(),(0,i.A)(this,"cmdType",void 0),(0,i.A)(this,"index",void 0),(0,i.A)(this,"conversationId",void 0),(0,i.A)(this,"messageId",void 0),(0,i.A)(this,"ext",{}),(0,i.A)(this,"upCmdType",void 0),(0,i.A)(this,"localMessageId",void 0),a.C.util.initPartial(e,this)}static fromBinary(e,t){return(new c).fromBinary(e,t)}static fromJson(e,t){return(new c).fromJson(e,t)}static fromJsonString(e,t){return(new c).fromJsonString(e,t)}static equals(e,t){return a.C.util.equals(c,e,t)}}(0,i.A)(c,"runtime",a.C),(0,i.A)(c,"typeName","msg_pb.PushCmd"),(0,i.A)(c,"fields",a.C.util.newFieldList((()=>[{no:1,name:"cmd_type",kind:"scalar",T:5,opt:!0},{no:2,name:"index",kind:"scalar",T:3,opt:!0},{no:3,name:"conversation_id",kind:"scalar",T:9,opt:!0},{no:4,name:"message_id",kind:"scalar",T:9,opt:!0},{no:5,name:"ext",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:6,name:"up_cmd_type",kind:"scalar",T:5,opt:!0},{no:7,name:"local_message_id",kind:"scalar",T:9,opt:!0}])));class l extends n.Q{constructor(e){super(),(0,i.A)(this,"longitude",void 0),(0,i.A)(this,"latitude",void 0),(0,i.A)(this,"countryName",void 0),(0,i.A)(this,"provinceName",void 0),(0,i.A)(this,"cityName",void 0),(0,i.A)(this,"districtName",void 0),(0,i.A)(this,"townName",void 0),(0,i.A)(this,"countryCode",void 0),a.C.util.initPartial(e,this)}static fromBinary(e,t){return(new l).fromBinary(e,t)}static fromJson(e,t){return(new l).fromJson(e,t)}static fromJsonString(e,t){return(new l).fromJsonString(e,t)}static equals(e,t){return a.C.util.equals(l,e,t)}}(0,i.A)(l,"runtime",a.C),(0,i.A)(l,"typeName","msg_pb.GeoInfo"),(0,i.A)(l,"fields",a.C.util.newFieldList((()=>[{no:1,name:"longitude",kind:"scalar",T:9,opt:!0},{no:2,name:"latitude",kind:"scalar",T:9,opt:!0},{no:3,name:"country_name",kind:"scalar",T:9,opt:!0},{no:4,name:"province_name",kind:"scalar",T:9,opt:!0},{no:5,name:"city_name",kind:"scalar",T:9,opt:!0},{no:6,name:"district_name",kind:"scalar",T:9,opt:!0},{no:7,name:"town_name",kind:"scalar",T:9,opt:!0},{no:8,name:"country_code",kind:"scalar",T:9,opt:!0}])));class d extends n.Q{constructor(e){super(),(0,i.A)(this,"messageId",void 0),(0,i.A)(this,"localMessageId",void 0),(0,i.A)(this,"replyId",void 0),(0,i.A)(this,"questionId",void 0),(0,i.A)(this,"createTime",void 0),(0,i.A)(this,"content",void 0),(0,i.A)(this,"ext",{}),(0,i.A)(this,"messageType",void 0),a.C.util.initPartial(e,this)}static fromBinary(e,t){return(new d).fromBinary(e,t)}static fromJson(e,t){return(new d).fromJson(e,t)}static fromJsonString(e,t){return(new d).fromJsonString(e,t)}static equals(e,t){return a.C.util.equals(d,e,t)}}(0,i.A)(d,"runtime",a.C),(0,i.A)(d,"typeName","msg_pb.AppAction"),(0,i.A)(d,"fields",a.C.util.newFieldList((()=>[{no:1,name:"message_id",kind:"scalar",T:3,opt:!0},{no:2,name:"local_message_id",kind:"scalar",T:9,opt:!0},{no:3,name:"reply_id",kind:"scalar",T:3,opt:!0},{no:4,name:"question_id",kind:"scalar",T:3,opt:!0},{no:5,name:"create_time",kind:"scalar",T:3,opt:!0},{no:6,name:"content",kind:"scalar",T:9,opt:!0},{no:7,name:"ext",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:8,name:"message_type",kind:"scalar",T:5,opt:!0}])));class u extends n.Q{constructor(e){super(),(0,i.A)(this,"eventType",0),(0,i.A)(this,"message",void 0),(0,i.A)(this,"cmd",void 0),(0,i.A)(this,"geo",void 0),(0,i.A)(this,"appAction",void 0),(0,i.A)(this,"version",void 0),(0,i.A)(this,"messageList",[]),a.C.util.initPartial(e,this)}static fromBinary(e,t){return(new u).fromBinary(e,t)}static fromJson(e,t){return(new u).fromJson(e,t)}static fromJsonString(e,t){return(new u).fromJsonString(e,t)}static equals(e,t){return a.C.util.equals(u,e,t)}}(0,i.A)(u,"runtime",a.C),(0,i.A)(u,"typeName","msg_pb.PushEvent"),(0,i.A)(u,"fields",a.C.util.newFieldList((()=>[{no:1,name:"event_type",kind:"scalar",T:5},{no:2,name:"message",kind:"message",T:r,opt:!0},{no:3,name:"cmd",kind:"message",T:c,opt:!0},{no:4,name:"geo",kind:"message",T:l,opt:!0},{no:5,name:"app_action",kind:"message",T:d,opt:!0},{no:6,name:"version",kind:"scalar",T:5,opt:!0},{no:7,name:"message_list",kind:"message",T:r,repeated:!0}])))},75305:(e,t,s)=>{s(91138),s(56324),s(64820)},64820:(e,t,s)=>{s(53713)},56324:(e,t,s)=>{s(53713)},47614:(e,t,s)=>{s.d(t,{u:()=>c,w:()=>r});var i=s(44557),n=s(85371),a=s(33664),o=s(68843);function r(e,t,s){const n=(0,o.H)(t,s),r=(0,o.xT)(n),l=(0,i.A)((0,i.A)((0,i.A)({},e),n),{},{is_delta:!1});if(e.message_type!==n.message_type||e.content_type!==n.content_type)return{mergedMessage:n};if(!n.is_delta)return{mergedMessage:n};if(n.is_delta){if(c(e,n))return{mergeMessage:e};if(n.contentObj)switch(n.content_type){case a.cM.Text:l.contentObj=function(e,t){const{search_references:s}=e||{},{search_references:n}=t||{},a=null!=n?n:s;return(0,i.A)({text:((null==e?void 0:e.text)||"")+((null==t?void 0:t.text)||"")},a?{search_references:a}:{})}(e.contentObj,r?void 0:n.contentObj);break;case a.cM.Suggest:l.contentObj=(p=e.contentObj,_=r?void 0:n.contentObj,{suggest:[...null!==(m=null==p?void 0:p.suggest)&&void 0!==m?m:[],...null!==(v=null==_?void 0:_.suggest)&&void 0!==v?v:[]]});break;default:l.contentObj=r?e.contentObj:n.contentObj}n.contentObj||(l.content=(g=e.content,h=n.content,(g||"")+(h||""))),l.meta_infos=(d=e.meta_infos,u=r?void 0:n.meta_infos,[...null!=d?d:[],...null!=u?u:[]])}var d,u,g,h,p,_,m,v;return{mergedMessage:l}}const c=(e,t)=>{const s=t.chunk_seq,i=null==e?void 0:e.chunk_seq;return!(0,n.A)(s)&&!(0,n.A)(i)&&Number(s)<Number(i)}},93230:(e,t,s)=>{s.d(t,{C_:()=>g,NY:()=>u,ge:()=>d,sI:()=>h});var i=s(44557),n=s(92431),a=s(97666),o=s(5099),r=s(54343),c=s(76049),l=s(9530);const d=111111111;function u(e){const t=(0,n.A)(e),{completionMessageMap:s}=t;for(const[i,n]of(0,a.A)(s))s[i]=(0,o.A)(n,["local","local_message_id"]);return t}function g(e,t,s){var n;const{msg:a,code:o}=t,l=(0,i.A)((0,i.A)({},null!=e?e:{}),{},{ext:(0,i.A)((0,i.A)({},null!==(n=null==e?void 0:e.ext)&&void 0!==n?n:{}),{},{has_err:o===d?"":String(o),err_msg:o===d?"":a}),localInfo:{from:c.aU.HttpChunk,logId:s,errorCode:o,errorMsg:a}});return{event_type:r.B.Message,message:l}}const h=()=>{var e;return null!==(e=l.v.localFeatureConfig)&&void 0!==e&&e.chunkWithJSON?"json":"pb"}},18157:(e,t,s)=>{function i(e,t,s,i){e.updateMessageList({conversationId:t,immerUpdate:e=>{const{draftMessageMap:t}=e,n=t[s];n&&(n.ext?n.ext.sp=i:n.ext={sp:i})}})}s.d(t,{D:()=>i})},50862:(e,t,s)=>{s.d(t,{U:()=>l,e:()=>d});var i=s(14065),n=s(44557),a=s(63379),o=s(98502),r=s(89565),c=s(97327);const l={messageFeedbackMap:{}},d=e=>(r.I.push((()=>e(l))),(0,n.A)((0,n.A)({},l),{},{updateMessageFeedback:({conversationId:t,messageId:s,detail:n,reportEvent:r,onlyLocal:l=!1})=>(0,i.A)((function*(){try{l||(yield c.j.apiService.message.MessageReport({message_id:s,action:"feedback",feedbackDetail:n})),e((0,o.jM)((({messageFeedbackMap:e})=>{e[t]||(e[t]={}),e[t][s]||(e[t][s]={}),(0,a.A)(e[t][s],n)}))),null==r||r.success()}catch(i){i instanceof Error&&(null==r||r.error({reason:"message report failed",error:i}))}}))()}))},35482:(e,t,s)=>{s.d(t,{DA:()=>k,Ej:()=>T,OU:()=>E,ZH:()=>I,c5:()=>C,hT:()=>z,h_:()=>R,iv:()=>M,k:()=>A,sK:()=>L});var i=s(14065),n=s(44557),a=s(72106),o=s(5099),r=s(37462),c=s(22290),l=s(85371),d=s(91689),u=s(76461),g=s(98502),h=s(36266),p=s(89565),_=s(77058),m=s(33664),v=s(97327),f=s(51065),y=s(68843),b=s(56448),S=s(96065);const k=(0,n.A)((0,n.A)({messageMap:{},localMessageMap:{},messageLinkMap:{},messageListStatusMap:{},regenerateMessageMap:{},chunkTaskMap:{},searchResultIsFinishedMap:{},messageReportEventMap:{},sendMessagePromiseTasks:{},lastMessageMap:{},socketStatus:{loading:!1,connected:!1},rateLimitConfig:{isLimited:!1,limitExpired:void 0,limitTips:""},userInfo:{secUserId:void 0},ttWidConfig:{}},{userOgfQuota:{userQuotaConfig:{showOgfQuota:!1,showOgfSwitch:!1,showOgfSwitchBotList:[],showOgfBotList:[],showOgfSwitchBlackList:[],showOgfBlackList:[]},ogfQuota:{ciciOgfQuotaLeft:5,ciciOgfTotal:5},quotaSwitchConfig:{value:!1,version:0},searchWeb:{showSearchWeb:!1,searchBotList:[],searchBlackList:[]},regenOgf:{showRegenOgf:!1,regenOgfBotList:[],regenOgfBlackList:[]},placeholder:{showPlaceholder:!1,enabledBotTypes:[],botIdsBlackList:[]},regenType:0,nextMessageUseOgf:!1},userOgf:{featureEnabled:!1,value:!1}}),{},{musicAutoPlay:!1});function M({draftLocalMessageMap:e,draftMessageMap:t,draftMessageLinks:s},i){const{isLocalMessage:n,messageId:a}=i;return n?delete e[a]:delete t[a],(0,u.A)(s,(e=>e.messageId===a))}function A(e,t){const{isLocalMessage:s,messageId:i}=t,{draftLocalMessageMap:n,draftMessageMap:a}=e;s&&n[i]?n[i].status=m.q7.InVisible:a[i]&&(a[i].status=m.q7.InVisible)}function E(e,t,s=""){const i=(0,y.um)(b.sq);null==t||t.error({reason:s});const n=M(e,{isLocalMessage:!0,messageId:i});n>-1&&e.draftMessageLinks.splice(n,1)}const w=(e,t)=>{const s=(0,n.A)((0,n.A)({},e.ext?e.ext:{}),t.ext||{});return e.content_type!==m.cM.Image&&e.content_type!==m.cM.File||!t.content?(0,n.A)((0,n.A)((0,n.A)({},(0,o.A)(e,["local","local_message_id"])),(0,a.A)(t,l.A)),{},{ext:s}):(0,y.H)((0,n.A)((0,n.A)((0,n.A)({},(0,o.A)(e,["local","local_message_id"])),(0,a.A)(t,l.A)),{},{ext:s}))};function I({draft:e,localMessage:t,message:s,omitReportEventProperty:i=[]}){const{message_id:n}=s,{local_message_id:a}=t;n&&a?e.draftMessageReportEventMap[n]=(0,o.A)(e.draftMessageReportEventMap[a],i):h.vF.warning("skip moveReportEvents: invalid remote/local message")}function L({draft:e,localMessage:t,message:s,useRemoteMessageKey:i=!0,useOriginalMessageKey:n=!1}){const{message_id:a}=s,{local_message_id:o}=t;if(!a||!o)return void h.vF.warning("skip replaceLocalMessageWithRemoteMessage: invalid remote/local message");e.draftMessageMap[a]=w(t,s);const r=M(e,{isLocalMessage:!0,messageId:o});if(r>-1){var c,l;const t=e.draftMessageLinks[r],s=n?t.messageKey:o;return null===(c=e.draftMessageLinks.splice(r,1,{isLocalMessage:!1,messageId:a,messageKey:i?a:s,regen_head:null===(l=e.draftMessageLinks[r])||void 0===l?void 0:l.regen_head}))||void 0===c?void 0:c[0]}h.vF.persist.warning({message:"not found local message to replace",meta:{localMessageId:o}})}const R=(e,t)=>{return p.I.push((()=>e(k))),(0,n.A)((0,n.A)({},k),{},{fetchMessageList:(a=(0,i.A)((function*({conversationId:e,cursor:t,size:s}){if(t<=0||s<=0)h.vF.warning({message:"fetchUpdateMessageList: invalid cursor input",meta:{conversationId:e,cursor:t}});else try{const i=yield v.j.apiService.message.MessageList({conversation_id:e,cursor:t,batch_size:s}),{data:n}=i,a=((null==n?void 0:n.message_list)||[]).reverse().filter((e=>!!(0,y.oQ)(e)||!(0,y.Qk)(e))),o={from:f.aU.Api,logId:(0,_.n)(i)};return{messages:a.map((e=>(0,y.H)(e,o))),messageLinks:a.map((e=>({messageId:e.message_id||"",isLocalMessage:!1}))),regenerateList:((null==n?void 0:n.regen_list)||[]).reverse().map((e=>(0,y.H)(e,o)))}}catch(i){throw i instanceof Error&&h.vF.persist.error({message:"fetchUpdateMessageList failed",error:i}),i}})),function(e){return a.apply(this,arguments)}),fetchEnoughMessageList:(s=(0,i.A)((function*({conversationId:e,cursor:s,size:i}){const n=[];let a=0,o=s,r=!0;for(;r;){const s=yield t().fetchMessageList({conversationId:e,cursor:o,size:i});if(n.push(s),r=!1,!s)return;if(s.messages.length===i){const e=s.messages.filter(y.$4).length;a+=e,a<b.Rs&&(h.vF.persist.warning({message:"fetchEnoughMessageList: auto load more",meta:{fetchSize:s.messages.length,currentFetchAvailableMessageSize:e,fetchAvailableSize:a}}),o-=i,r=!0)}r&&n.length>=5&&(r=!1,h.vF.persist.warning({message:"fetchEnoughMessageList: break by maxTry",meta:{fetchAvailableSize:a}}))}return 1===n.length?n[0]:n.reduceRight(((e,t)=>(t&&(e.messageLinks=e.messageLinks.concat(t.messageLinks),e.messages=e.messages.concat(t.messages),e.regenerateList=e.regenerateList.concat(t.regenerateList)),e)),{messages:[],messageLinks:[],regenerateList:[]})})),function(e){return s.apply(this,arguments)}),logicalDeleteMessage:({conversationId:e,messageLink:s,deleteReply:i=!1})=>{t().createUpdateMessageList(e)((e=>{if(A(e,s),i){const t=(0,y.rU)({replyId:s.messageId,messageLinks:e.draftMessageLinks,getMessage:(0,y.A4)({localMessageMap:e.draftLocalMessageMap,messageMap:e.draftMessageMap})});null!=t&&t.length&&t.forEach((t=>A(e,t)))}}))},clearConversationMessages:t=>{e((0,g.jM)((e=>(0,y.zJ)(e,t))))},updateMessageList:({conversationId:t,immerUpdate:s})=>{e((0,g.jM)((e=>{e.messageMap[t]||(e.messageMap[t]={}),e.localMessageMap[t]||(e.localMessageMap[t]={}),e.messageReportEventMap[t]||(e.messageReportEventMap[t]={}),e.regenerateMessageMap[t]||(e.regenerateMessageMap[t]={messageMap:{}}),e.messageListStatusMap[t]||(e.messageListStatusMap[t]={hasMore:!1,lastCursor:0,loading:!1}),Array.isArray(e.messageLinkMap[t])||(e.messageLinkMap[t]=[]);const i=function(e,t){const{regenerateMessageMap:s,messageMap:i,messageLinkMap:a,messageListStatusMap:o}=t,r=t=>{Array.isArray(t)&&t.forEach((t=>{t.message_id&&(i[e][t.message_id]=t)}))},l=t=>{a[e]=t},u=(t,s)=>{var i,o,r;const c=null!==(i=null===(o=a[e])||void 0===o||null===(r=o.findIndex)||void 0===r?void 0:r.call(o,(e=>t===e.messageId)))&&void 0!==i?i:-1;if(~c){var l;const t=a[e][c];null===(l=a[e])||void 0===l||l.splice(c,1,(0,n.A)((0,n.A)({},t),s))}},g=t=>{if(!(0,d.A)(t)||null==t||!t.length)return;if(s[e]){var i,n;const a=Object.values(s[e].messageMap);(null===(i=t[0])||void 0===i?void 0:i.reply_id)!==(null===(n=a[0])||void 0===n?void 0:n.reply_id)&&(s[e]={messageMap:{}})}else s[e]={messageMap:{}};const o=(0,c.A)(a[e],"messageId");t.forEach(((t,i,n)=>{const{message_id:a}=t;var r;a&&(s[e].messageMap[a]=t,o[a]&&(o[a].regen_head=null===(r=n[0])||void 0===r?void 0:r.message_id))}))},h=t=>{o[e]=t};return{overrideMessages:r,overrideMessageLinks:l,overrideRegenerateMessagesAndUpdateLink:g,resetMessageLink:u,setMessageStatus:h}}(t,e);s({draftMessageMap:e.messageMap[t],draftLocalMessageMap:e.localMessageMap[t],draftMessageLinks:e.messageLinkMap[t],draftMessageListStatus:e.messageListStatusMap[t],draftRegenerateMessageMap:e.regenerateMessageMap[t],draftMessageReportEventMap:e.messageReportEventMap[t]},i),S.E.set(t,t)})))},createUpdateMessageList:e=>s=>t().updateMessageList({conversationId:e,immerUpdate:s}),updateChunkTask:(s,i)=>(e((0,g.jM)((e=>{if(s&&e.chunkTaskMap[s]){const{completionMessageMap:t}=e.chunkTaskMap[s],{message_id:n}=i;t[n||b.Ln]=i}}))),t().chunkTaskMap[s]),createChunkTask:(s,i)=>(t().chunkTaskMap[s]||e((0,g.jM)((e=>{if(s){const{message_id:t}=i,n={chunkSeq:Number((null==i?void 0:i.chunk_seq)||0),replyId:s,conversationId:(null==i?void 0:i.conversation_id)||"",completionMessageMap:{[t||b.Ln]:i}};e.chunkTaskMap[s]=n}}))),t().chunkTaskMap[s]),removeChunkTask(t){e((0,g.jM)((e=>{delete e.chunkTaskMap[t]})))},getSearchResultStatus:e=>t().searchResultIsFinishedMap[e],updateSearchResultStatus(t,s){e((0,g.jM)((e=>{e.searchResultIsFinishedMap[t]=s})))},getReportEvents(e,s){var i;return(null===(i=t().messageReportEventMap[e])||void 0===i?void 0:i[s])||{}},hasReportEvent(e,s,i){var n;return!(null===(n=t().messageReportEventMap[e])||void 0===n||null===(n=n[s])||void 0===n||!n[i])},setReportEvents(t,s,i){e((0,g.jM)((e=>{e.messageReportEventMap[t]||(e.messageReportEventMap[t]={}),e.messageReportEventMap[t][s]=i})))},mergeReportEvents(t,s,i){e((0,g.jM)((e=>{e.messageReportEventMap[t]||(e.messageReportEventMap[t]={}),e.messageReportEventMap[t][s]=(0,n.A)((0,n.A)({},e.messageReportEventMap[t][s]),i)})))},hasSendMessageTask:e=>!!e.local_message_id&&!!t().sendMessagePromiseTasks[e.local_message_id],addSendMessageTask(t){const{local_message_id:s}=t;s&&e((0,g.jM)((e=>{e.sendMessagePromiseTasks[s]={local_message_id:s,finish:r.A,expired:Date.now()+b.hn}})))},isSendMessageExpired(e){var s;const i=e.local_message_id;if(!i)return!1;const n=null===(s=t().sendMessagePromiseTasks[i])||void 0===s?void 0:s.expired;return void 0!==n&&Date.now()-n>0},updateSendMessageTaskFinishFn(s,i){const n=s.local_message_id;if(!n)return;const a=()=>{i(),e((0,g.jM)((e=>{delete e.sendMessagePromiseTasks[n]})))};t().sendMessagePromiseTasks[n]&&e((0,g.jM)((e=>{e.sendMessagePromiseTasks[n].finish=a})))},finishSendMessageTask(e){var s;e&&(null===(s=t().sendMessagePromiseTasks[e])||void 0===s||s.finish())},setSocketStatus:t=>{e((()=>({socketStatus:t})))},updateRateLimitConfig:t=>e((()=>({rateLimitConfig:t}))),updateUserData:t=>{e((()=>({userInfo:t})))},updateTtWidConfig:t=>{e((()=>({ttWidConfig:t})))},updateCiciQuotaConfig:t=>{e((()=>({userOgfQuota:t})))},updateCiciOgfQuota:t=>{e((0,g.jM)((e=>{e.userOgfQuota.ogfQuota=t})))},updateCiciQuotaSwitchState:t=>{e((0,g.jM)((e=>{e.userOgfQuota.quotaSwitchConfig.value=t})))},updateCiciQuotaSwitchConfig:t=>{e((0,g.jM)((e=>{e.userOgfQuota.quotaSwitchConfig=t})))},updateCiciQuotaNextState:t=>{e((0,g.jM)((e=>{e.userOgfQuota.nextMessageUseOgf=t})))},updateOgfFeatureEnabled:t=>{e((0,g.jM)((e=>{e.userOgf&&(e.userOgf.featureEnabled=t)})))},updateOgfToggleValue:t=>{e((0,g.jM)((e=>{e.userOgf&&(e.userOgf.value=t)})))},setMusicAutoPlay:t=>{e((()=>({musicAutoPlay:t})))}});var s,a};function z(e,t){const s=e.draftLocalMessageMap[b.rR],i=null==s?void 0:s.reply_id;if(!(0,l.A)(t)&&!(0,l.A)(i)&&t!==i)return;const n=(0,u.A)(e.draftMessageLinks,(e=>e.messageId===b.rR));if(~n){const{messageId:t}=e.draftMessageLinks[n];return M(e,{isLocalMessage:!0,messageId:t}),e.draftMessageLinks.splice(n,1)}}function C(e,t){if(!t)return;const s=(0,y.A4)({localMessageMap:e.draftLocalMessageMap,messageMap:e.draftMessageMap});(0,y.rU)({messageLinks:e.draftMessageLinks,getMessage:s,replyId:t}).forEach((t=>{M(e,{isLocalMessage:!0,messageId:t.messageId});const s=e.draftMessageLinks.findIndex((e=>e.messageId===t.messageId));-1!==s&&e.draftMessageLinks.splice(s,1)}))}function T(e,t){if(!t)return;const{draftLocalMessageMap:s}=e;Object.entries(s).forEach((([s,i])=>{i.reply_id===t&&M(e,{isLocalMessage:!0,messageId:s})}))}},47285:(e,t,s)=>{s.d(t,{A:()=>S,e:()=>k});var i=s(44557),n=s(14065),a=s(20997),o=s(85371),r=s(2633),c=s(94654),l=s(24323),d=s.n(l),u=s(98502),g=s(49931),h=s(36266),p=s(97327),_=s(21858),m=s(5817),v=s(29654),f=s(9530),y=s(70053),b=s(94682);const S={preprocessTaskMap:{},uploaderToken:{}},k=(e,t)=>{const s=s=>{const{ctx:i,file:a}=s,o=i?(0,h.XB)({eventName:"attachment_upload",meta:{upload_type:s.type,upload_from:i.uploadFrom}}):void 0,r=(s,i)=>function(){var a=(0,n.A)((function*(n){const a=(0,u.mq)(t()),o=a.preprocessTaskMap[s];try{if(!o)return;yield i(n,o)}finally{e((0,u.vD)(a))}}));return function(e){return a.apply(this,arguments)}}();return{complete:r(s.local_key,((e,n)=>{if(n.loading=!1,n.failed=!1,e){var r;if(n.percent=e.percent,n.uploadResult=e.uploadResult,n.key=e.uploadResult.ImageUri||"",n.fileKey=e.key,o&&(o.addDurationPoint("success"),o.success({meta:{upload_file_size:e.fileSize}})),i)m.H.trackEvent("upload_attachment_status",{bot_id:i.botId,current_page:"chat",message_type:"file"===s.type?"file":"pic",message_type_detail:a&&"name"in a?null===(r=(null==a?void 0:a.name).match(/\.([^.]+)$/))||void 0===r?void 0:r[1].toLowerCase():"",enter_method:i.from,uri:e.uploadResult.ImageUri||"",success:"1"}),m.H.trackEvent("upload_status",{status:"1",conversation_id:i.conversationId,conversation_type:(0,y.Rx)(b.pU.getState(),i.conversationId)||1,module_actionid:i.moduleActionId,current_page:"chat",chat_type:i.chatType,skill_name:i.skillType?i.skillType.toString():"",skill_id:i.skillId,upload_id:i.uploadId,duration:e.duration.toString(),upload_way:i.uploadWay,upload_collection_way:i.uploadCollectionWay,collection_id:s.fileKey,collection_name:(0,v.p)("name")(a),upload_type:"file"===s.type?"pdf":"pic",upload_file_type:(0,g.GO)((0,v.p)("name")(a)),upload_token_length:"",upload_file_size:e.fileSize,upload_from:i.uploadFrom});(0,_.N)({info:e,task:t().preprocessTaskMap[s.local_key]})}})),progress:r(s.local_key,((e,t)=>{t.loading=!0,t.failed=!1,e&&(t.percent=e.percent,t.fileKey=e.key)})),error:r(s.local_key,((e,t)=>{var n,r;(t.loading=!1,t.failed=!0,t.uploadResult=void 0,t.key="",e)&&(t.fileKey=e.key,o&&o.error({reason:"upload attachment failed",meta:{upload_file_size:e.fileSize}}),i&&(m.H.trackEvent("upload_file_status",{bot_id:i.botId,current_page:"chat",message_type:s.type,enter_method:i.from,success:"0",result:null!==(n=null===(r=e.extra)||void 0===r?void 0:r.message)&&void 0!==n?n:""}),m.H.trackEvent("upload_status",{status:"0",error_code:"fail_to_upload",conversation_id:i.conversationId,conversation_type:(0,y.Rx)(b.pU.getState(),i.conversationId)||1,module_actionid:i.moduleActionId,current_page:"chat",chat_type:i.chatType,skill_name:i.skillType?i.skillType.toString():"",skill_id:i.skillId,upload_id:i.uploadId,duration:e.duration.toString(),upload_way:i.uploadWay,upload_collection_way:i.uploadCollectionWay,collection_id:s.fileKey,collection_name:(0,v.p)("name")(a),upload_type:"file"===s.type?"pdf":"pic",upload_file_type:(0,g.GO)((0,v.p)("name")(a)),upload_token_length:"",upload_file_size:e.fileSize,upload_from:i.uploadFrom})))}))}},l=(()=>{let t=null;const s=function(){var s=(0,n.A)((function*(){h.vF.persist.log({eventName:"attachment_upload_refreshUploadToken_GetUploadAuthToken_image",meta:{}});const{data:s}=yield p.j.apiService.resource.GetUploadAuthToken({scene:"bot_chat",data_type:"image"});let i;h.vF.persist.log({eventName:"attachment_upload_refreshUploadToken_GetUploadAuthTokenDone_image",meta:{uploader_token_image:!!s}});try{h.vF.persist.log({eventName:"attachment_upload_refreshUploadToken_GetUploadAuthToken_file",meta:{}});i=(yield p.j.apiService.resource.GetUploadAuthToken({scene:"bot_chat",data_type:"file"})).data,h.vF.persist.log({eventName:"attachment_upload_refreshUploadToken_GetUploadAuthTokenDone_file",meta:{file_uploader_token_file:!!i}})}catch(r){var n;console.error("get file upload token failed"),h.vF.persist.error({error:new Error("attachment_upload_refreshUploadToken_GetUploadAuthTokenDone_file_error"),meta:{error:(0,a.A)(r)&&"message"in r?null==r||null===(n=r.message)||void 0===n?void 0:n.toString():""}})}const o={image:s,file:i};h.vF.persist.log({eventName:"attachment_upload_refreshUploadToken_setUploaderToken",meta:{uploader_token_file:!!o.file,uploader_token_image:!!o.image}}),e((()=>({uploaderToken:o}))),t=null}));return function(){return s.apply(this,arguments)}}();return()=>{var e;return null!==(e=t)&&void 0!==e?e:t=s()}})();let k;const M=function(){var e=(0,n.A)((function*(e,s){var i,n,a,o,c,d,u,g,p,_,m;if(h.vF.persist.log({eventName:"start_attachment_upload_getUploader_start",meta:{local_key:s.local_key,upload_id:null===(i=s.ctx)||void 0===i?void 0:i.uploadId,upload_type:s.type,upload_from:null===(n=s.ctx)||void 0===n?void 0:n.uploadFrom,type:e}}),k&&!k["file"===e?"fileConfigExpired":"imageConfigExpired"])return h.vF.persist.log({eventName:"start_attachment_upload_getUploader_notExpired",meta:{local_key:s.local_key,upload_id:null===(d=s.ctx)||void 0===d?void 0:d.uploadId,upload_type:s.type,upload_from:null===(u=s.ctx)||void 0===u?void 0:u.uploadFrom,type:e}}),k;if(null===(a=k)||void 0===a||!a.client){var v,y,b,S,M,A,E,w,I,L,R;if(h.vF.persist.log({eventName:"start_attachment_upload_getUploader_noClient",meta:{local_key:s.local_key,upload_id:null===(v=s.ctx)||void 0===v?void 0:v.uploadId,upload_type:s.type,upload_from:null===(y=s.ctx)||void 0===y?void 0:y.uploadFrom,type:e}}),(0,r.A)(t().uploaderToken))h.vF.persist.log({eventName:"start_attachment_upload_getUploader_noToken",meta:{local_key:s.local_key,upload_id:null===(w=s.ctx)||void 0===w?void 0:w.uploadId,upload_type:s.type,upload_from:null===(I=s.ctx)||void 0===I?void 0:I.uploadFrom,type:e}}),yield l(),h.vF.persist.log({eventName:"start_attachment_upload_getUploader_refreshUploadTokenAfterNoTokenDone",meta:{local_key:s.local_key,upload_id:null===(L=s.ctx)||void 0===L?void 0:L.uploadId,upload_type:s.type,upload_from:null===(R=s.ctx)||void 0===R?void 0:R.uploadFrom,uploader_token_file:!!t().uploaderToken.file,uploader_token_image:!!t().uploaderToken.image,type:e}});h.vF.persist.log({eventName:"start_attachment_upload_getUploader_createUploader",meta:{local_key:s.local_key,upload_id:null===(b=s.ctx)||void 0===b?void 0:b.uploadId,upload_type:s.type,upload_from:null===(S=s.ctx)||void 0===S?void 0:S.uploadFrom,type:e}}),k=yield f.v.createUploader({imageConfig:t().uploaderToken.image,fileConfig:t().uploaderToken.file,userId:null!==(M=f.v.userId)&&void 0!==M?M:"",appId:f.v.appId}),h.vF.persist.log({eventName:"start_attachment_upload_getUploader_createUploaderDone",meta:{local_key:s.local_key,upload_id:null===(A=s.ctx)||void 0===A?void 0:A.uploadId,upload_type:s.type,upload_from:null===(E=s.ctx)||void 0===E?void 0:E.uploadFrom,uploader:!!k,type:e}})}k["file"===e?"fileConfigExpired":"imageConfigExpired"]&&(h.vF.persist.log({eventName:"start_attachment_upload_getUploader_expired",meta:{local_key:s.local_key,upload_id:null===(g=s.ctx)||void 0===g?void 0:g.uploadId,upload_type:s.type,upload_from:null===(p=s.ctx)||void 0===p?void 0:p.uploadFrom,type:e}}),yield l(),h.vF.persist.log({eventName:"start_attachment_upload_getUploader_refreshUploadTokenAfterExpiredDone",meta:{local_key:s.local_key,upload_id:null===(_=s.ctx)||void 0===_?void 0:_.uploadId,upload_type:s.type,upload_from:null===(m=s.ctx)||void 0===m?void 0:m.uploadFrom,type:e}}),k.updateImageConfig(t().uploaderToken.image),k.updateFileConfig(t().uploaderToken.file));return h.vF.persist.log({eventName:"start_attachment_upload_getUploader_returnUploader",meta:{local_key:s.local_key,upload_id:null===(o=s.ctx)||void 0===o?void 0:o.uploadId,upload_type:s.type,upload_from:null===(c=s.ctx)||void 0===c?void 0:c.uploadFrom,uploader:!!k,type:e}}),k}));return function(t,s){return e.apply(this,arguments)}}();return(0,i.A)((0,i.A)({},S),{},{refreshUploadToken:l,preprocessFile(t,n,a,o){const r=((e,t,s,i={})=>{const{preHandle:n}=i;return{type:t,key:"",local_key:(0,c.A)(),percent:0,blobUrl:URL.createObjectURL(e),loading:!0,failed:!1,fileKey:"",file:e,ctx:s,preHandle:n}})(t,n,a,o),l=r.local_key;t.arrayBuffer().then((t=>{const s=d()(new Uint8Array(t));e((0,u.jM)((e=>{const t=e.preprocessTaskMap[l];t&&(t.md5=s)})))})).catch((e=>{console.error("[preprocessFile] md5 \u8ba1\u7b97\u5931\u8d25",e)})),e((({preprocessTaskMap:e})=>({preprocessTaskMap:(0,i.A)((0,i.A)({},e),{},{[r.local_key]:r})})));const g=s(r);return M(n,r).then((e=>{var s,i;h.vF.persist.log({eventName:"start_attachment_upload_getUploader_done_start_upload",meta:{local_key:r.local_key,upload_id:null===(s=r.ctx)||void 0===s?void 0:s.uploadId,upload_type:r.type,upload_from:null===(i=r.ctx)||void 0===i?void 0:i.uploadFrom,type:n}}),null==e||e["file"===n?"uploadFile":"uploadImage"](t,{complete:g.complete,progress:g.progress,error:g.error})}),(()=>g.error())),{local_key:r.local_key,key:r.key}},reUpload(e){const i=t().preprocessTaskMap[e];if(!i)return void h.vF.persist.warning({eventName:"reUpload_mismatch_preprocessTask",meta:{local_key:e}});const n=s(i);n.progress(),M(i.type,i).then((e=>{var t;return null==e||null===(t=e.client)||void 0===t?void 0:t.start()}),(()=>n.error()))},cancel:e=>{var t;null===(t=k)||void 0===t||null===(t=t.client)||void 0===t||t.cancel(e)},updateAttachmentParseState(t,s){(0,o.A)(s)||e((0,u.jM)((e=>{const i=e.preprocessTaskMap[t];i&&(i.parseState=s)})))},updateAttachmentReviewState(t,s){(0,o.A)(s)||e((0,u.jM)((e=>{const i=e.preprocessTaskMap[t];i&&(i.reviewState=s)})))}})}},80590:(e,t,s)=>{s.d(t,{E:()=>w});var i=s(44557),n=s(14065),a=s(1026),o=s(28167),r=s(51402),c=s(47686),l=s(85371),d=s(81163),u=s(36266),g=s(53713),h=s(97327),p=s(51065),_=s(26453),m=s(47285),v=s(35482),f=s(50862),y=s(68843),b=s(33187),S=s(9530),k=s(77058),M=s(56448),A=s(98502);function E(e,t,s){return e.filter((e=>{if(e.isLocalMessage){const i=t(e);if((null==i||!i.message_id)&&(null==i?void 0:i.sec_sender)===M.tL&&(0,y.cm)(i))return console.log(s(i.localContent)),s(i.localContent)}return!0}))}const w=(...e)=>{const[t,s]=e,w=function(){var e=(0,n.A)((function*({conversationId:e,messageCursor:t,messageIndex:i,range:n}){var a;const o=M.Qn,r=null!==(a=yield s().fetchMergeMessageList({conversationId:e,cursor:i,size:o,range:n,checkMessageHole:!0}))&&void 0!==a?a:[];return 0===r.length&&u.vF.persist.warning({message:"initMessageList empty",meta:{messageCursor:t,messageIndex:i}}),s().refreshSuggestMessage({conversationId:e}),r}));return function(t){return e.apply(this,arguments)}}();return(0,i.A)((0,i.A)((0,i.A)((0,i.A)((0,i.A)({},(0,_.M)(...e)),(0,v.h_)(...e)),(0,f.e)(...e)),(0,m.e)(...e)),{},{fetchMergeMessageList:(T=(0,n.A)((function*({conversationId:e,cursor:t,size:i,actionName:n="fetchMergeMessageList",range:a,checkMessageHole:o=!1}){const r=s().createUpdateMessageList(e);if(i<=0)return void u.vF.persist.warning(`skip ${n}: invalid size`);const c={conversationId:e,cursor:t,size:i};try{const e=yield s().fetchEnoughMessageList(c);if(!e||(null===S.v||void 0===S.v||!S.v.isGuest)&&e.messageLinks.length<0)return;return r(((t,r)=>{const{draftMessageLinks:l,draftMessageMap:d,draftLocalMessageMap:g}=t,h=(0,y.A4)({localMessageMap:g,messageMap:d});r.overrideMessages(e.messages);let p=(0,y.bM)(e.messageLinks,l,h);o&&(p=(0,y.TR)(p,h)),p=E(p,h,(({preprocess_key:e})=>Boolean(s().preprocessTaskMap[e]))),r.overrideMessageLinks(p);const _=a?(0,y.uT)({messageLinks:p,getMessage:h,range:a}):(0,y.Kj)({messageLinks:e.messageLinks,getMessage:h,size:i});r.setMessageStatus(_),r.overrideRegenerateMessagesAndUpdateLink(e.regenerateList),u.vF.info({message:`${n} finish`,meta:{messages:e.messages,status:_,requestPayload:c}})})),e.messageLinks}catch(l){throw l instanceof Error&&u.vF.persist.error({message:`${n} failed`,error:l,meta:{request:c}}),l}})),function(e){return T.apply(this,arguments)}),initMessageList:(C=(0,n.A)((function*(e){const{messageCursor:t,messageIndex:n,conversationId:a}=e,o=s().createUpdateMessageList(a),r=s().messageLinkMap[a];Array.isArray(r)&&0!==r.length||o((({draftMessageListStatus:e})=>{e.loading=!0}));try{if(1!==t||0!==n)return n<=0||n<t?void u.vF.persist.warning({message:"skip initMessageList",meta:{messageCursor:t,messageIndex:n}}):yield w(e);for(let t=0;t<5;t++){const s=500*Math.pow(2,t);try{const t=yield w((0,i.A)((0,i.A)({},e),{},{messageCursor:1,messageIndex:1}));if(!(null!==S.v&&void 0!==S.v&&S.v.isGuest||null!=t&&t.length))throw Error("Empty MessageList when invoke _initMessageList");return t}catch(c){if(4===t)throw c;yield(0,g.BKw)(s)}}}catch(c){u.vF.persist.error({eventName:"init_message_list_error",error:c})}finally{o((({draftMessageListStatus:e})=>{e.loading=!1}))}})),function(e){return C.apply(this,arguments)}),refreshSuggestMessage({conversationId:e}){const{lastAvailableMessage:t}=(0,b.bR)(s(),e);t&&s().updateSuggestMessageWithRemote(e,t)},loadMoreMessageList:(z=(0,n.A)((function*(e){const t=s().messageListStatusMap[e];if(!t||t.lastCursor<=0)return void u.vF.persist.warning("skip loadMoreMessageList: invalid status");const i=M.Qn,n=yield s().fetchMergeMessageList({conversationId:e,cursor:t.lastCursor-1,size:i});return(0,l.A)(n)&&u.vF.persist.warning({message:"skip loadMoreMessageList: invalid api response",meta:{}}),n})),function(e){return z.apply(this,arguments)}),initOnboarding:({conversationId:e})=>{s().updateMessageList({conversationId:e,immerUpdate:t=>{const i=s().getReportEvents(e,M.sq);(0,v.OU)(t,i.receiving_onboarding,"cancel duplicated onboarding");const n=(0,y.um)(M.sq);t.draftLocalMessageMap[n]=(0,y.xf)({localMessageStatus:p.FQ.ReceivingFirstPackage,message:{conversation_id:e,local_message_id:n,reply_id:M.sq,ext:{onboarding:"1"}},failedExpired:Date.now()+M.Sy,messageLinks:t.draftMessageLinks,isRegenerate:!1}),t.draftMessageReportEventMap[n]={receiving_onboarding:(0,u.XB)({eventName:"receiving_onboarding",meta:{conversation_id:e,message_id:M.sq,is_regenerate:!1}})},t.draftMessageLinks.push({isLocalMessage:!0,messageId:n})}})},cancelOnboarding:({conversationId:e,reason:t})=>{s().updateMessageList({conversationId:e,immerUpdate:i=>{const n=s().getReportEvents(e,M.sq);(0,v.OU)(i,n.receiving_onboarding,t)}})},checkExistRemoteMessage:({conversationId:e,messageId:t})=>{const i=(0,y.A4)({localMessageMap:s().localMessageMap[e],messageMap:s().messageMap[e]}),n=s().messageLinkMap[e];return!!(0,y.ci)({messageLinks:n,replyId:t,getMessage:i})},fetchAssistantMessageListWithBotId:(R=(0,n.A)((function*({botId:e}){const t=s().createUpdateMessageList(M.i9),i=s().messageLinkMap[M.i9];Array.isArray(i)&&0!==i.length||t((({draftMessageListStatus:e})=>{e.loading=!0}));try{const i=yield h.j.apiService.message.MessageList({cursor:1e4,batch_size:M.Qn,bot_id:e,conversation_id:"0"}),{data:n}=i,a=((null==n?void 0:n.message_list)||[]).reverse().filter((e=>!!(0,y.oQ)(e)||!(0,y.Qk)(e))),o={from:p.aU.Api,logId:(0,k.n)(i)},r=a.map((e=>(0,y.H)(e,o))),c=a.map((e=>({messageId:e.message_id||"",isLocalMessage:!1}))),l=((null==n?void 0:n.regen_list)||[]).reverse().map((e=>(0,y.H)(e,o)));t(((e,t)=>{const{draftMessageLinks:i,draftMessageMap:n,draftLocalMessageMap:a}=e,o=(0,y.A4)({localMessageMap:a,messageMap:n});t.overrideMessages(r);let d=(0,y.bM)(c,i,o);d=(0,y.TR)(d,o),d=E(d,o,(({preprocess_key:e})=>Boolean(s().preprocessTaskMap[e]))),t.overrideMessageLinks(d);const u=(0,y.Kj)({messageLinks:c,getMessage:o,size:M.Qn});t.setMessageStatus(u),t.overrideRegenerateMessagesAndUpdateLink(l)}))}catch(n){t((({draftMessageListStatus:e})=>{e.loading=!1}))}})),function(e){return R.apply(this,arguments)}),fetchLastMessages:(L=(0,n.A)((function*({conversationIds:e,retryCount:t=2}){const{data:{message_map:i={},regen_map:n={},retry_list:l=null}={}}=yield h.j.apiService.message.LatestMessageList({request_list:e.map((e=>({conversation_id:e})))}),u=(0,d.A)(i,n,((e,t)=>(0,a.A)(e,t,(e=>e.message_id)))),g=(0,r.A)((0,c.A)(u),(e=>{const t=(0,o.A)(u[e],(e=>e.index)),s=t?(0,y.H)(t,{from:p.aU.Api}):null;return[e,s&&(0,y.$4)(s)?s:void 0]})),_=Object.fromEntries(g);if(null!=l&&l.length&&t>0){const e=yield s().fetchLastMessages({conversationIds:l.map(String),retryCount:t-1});Object.assign(_,e)}return _})),function(e){return L.apply(this,arguments)}),updateLastMessageMap:(I=(0,n.A)((function*({conversationIds:e}){const i=yield s().fetchLastMessages({conversationIds:e,retryCount:2});t((0,A.jM)((e=>{e.lastMessageMap=i})))})),function(e){return I.apply(this,arguments)})});var I,L,R,z,C,T}},26453:(e,t,s)=>{s.d(t,{I:()=>c,M:()=>l});var i=s(44557),n=s(98502),a=s(53713),o=s(36266),r=s(89565);const c={suggestMessageMap:{}},l=(e,t)=>(r.I.push((()=>e(c))),(0,i.A)((0,i.A)({},c),{},{clearSuggestMessage:t=>{e((0,n.jM)((e=>{e.suggestMessageMap[t]&&delete e.suggestMessageMap[t]})))},updateSuggestMessage:(t,s)=>{e((e=>{const n=s(e.suggestMessageMap[t]),a=(0,i.A)({},e.suggestMessageMap);return n?a[t]=n:delete a[t],{suggestMessageMap:a}}))},updateSuggestMessageWithRemote:(e,s)=>{t().updateSuggestMessage(e,(t=>{try{var i;if(null==s||!s.reply_id)return t;const e=JSON.parse((null===(i=s.ext)||void 0===i?void 0:i.sp)||"[]");return{replyId:s.reply_id,loading:!1,failed:!1,expired:void 0,suggests:(0,a.Bog)(e)?e:[]}}catch(n){return o.vF.persist.warning({message:"load remote sp fail",meta:{conversationId:e,message_id:null==s?void 0:s.message_id,reply_id:null==s?void 0:s.reply_id}}),t}}))}}))},5938:(e,t,s)=>{s.d(t,{B:()=>r});var i=s(36266),n=s(85062),a=s(2645),o=s(1921);const r=e=>{var t,s;return{name:`${e.prefix}-chat-message-store`,storage:(0,n.w)((()=>{var t;return null!==(t=e.storage)&&void 0!==t?t:(0,n.r)()})),partialize:null!==(t=e.partialize)&&void 0!==t?t:a.A,version:1.5,merge:null!==(s=e.merge)&&void 0!==s?s:o.h,onRehydrateStorage:e=>{const t=i.vF.createLoggerWith({ctx:{namespace:"persist"}});return t.info({message:"hydration started",meta:{state:e}}),(e,s)=>{s?t.persist.error({message:"hydration error",error:s instanceof Error?s:new Error(String(s))}):t.info({message:"hydration finished",meta:{state:e}})}}}}},39390:(e,t,s)=>{s.d(t,{$:()=>r});var i=s(92431),n=s(892),a=s(36266);const o=[{pathExpression:"$.state.localMessageMap..local",callback:e=>{delete e.reportEvents}},{pathExpression:"$.state.suggestMessageMap.*[?(@property.match(/reportEvent$/i))]^",callback:e=>{delete e.reportEvent}},{pathExpression:"$.state.regenerateMessageMap.*[?(@property.match(/reportEvents$/i))]^",callback:e=>{delete e.reportEvents}}],r=e=>{try{const t=(0,i.A)(e);return o.forEach((e=>{(0,n.E)({path:e.pathExpression,json:t,callback:e.callback})})),t}catch(t){a.vF.persist.error({message:"persist state filter error",error:t instanceof Error?t:new Error(String(t))})}return e}},1921:(e,t,s)=>{s.d(t,{h:()=>m});var i=s(44557),n=s(80066),a=s(51402),o=s(20997),r=s(85371),c=s(86836),l=s(92431),d=s(36266),u=s(68843),g=s(50862),h=s(35482),p=s(47245);const _=(0,i.A)((0,i.A)((0,i.A)((0,i.A)({},h.DA),g.U),p.I6),p.Aj),m=(e,t)=>{try{const s=(0,r.A)(e)?_:e,d=(0,i.A)((0,i.A)({},(0,l.A)(t)),s);return d.messageLinkMap&&(0,o.A)(d.messageLinkMap)&&Object.keys(d.messageLinkMap).forEach((e=>{const{messageMap:t,localMessageMap:s,messageLinks:i}=(0,u.tv)(d,e),o=(0,n.A)(i,i.length-50),r=Object.fromEntries((0,a.A)((0,c.A)(o,(e=>e.isLocalMessage)),(e=>[e.messageId,s[e.messageId]]))),l=Object.fromEntries((0,a.A)((0,c.A)(o,(e=>!e.isLocalMessage)),(e=>[e.messageId,t[e.messageId]])));d.messageLinkMap[e]=o,d.localMessageMap[e]=r,d.messageMap[e]=l})),d.messageLinkMap&&(0,o.A)(d.messageLinkMap)&&Object.keys(d.messageLinkMap).forEach((e=>{const{messageMap:t,localMessageMap:s,messageLinks:i}=(0,u.tv)(d,e);d.messageListStatusMap[e]=(0,u.uT)({messageLinks:i,getMessage:(0,u.A4)({messageMap:t,localMessageMap:s}),range:{start:0,end:0}})})),d}catch(s){s instanceof Error&&d.vF.persist.error({message:"persist merge error",error:s})}return t}},96065:(e,t,s)=>{s.d(t,{E:()=>n});var i=s(56448);const n=new(s(65944).G)(i.W2)},2645:(e,t,s)=>{s.d(t,{A:()=>a});var i=s(36266),n=s(96065);const a=e=>{try{const t=[...n.E.keys()],s={},i={},a={};return t.forEach((t=>{var i;t&&(a[t]=e.suggestMessageMap[t],null!==(i=e.messageLinkMap)&&void 0!==i&&i[t]&&(s[t]=e.messageLinkMap[t].slice(Math.max(e.messageLinkMap[t].length-30,0))))})),t.forEach((t=>{var n;t&&null!=s&&s[t]&&null!==(n=e.messageMap)&&void 0!==n&&n[t]&&(i[t]={},s[t].forEach((s=>{var n;null!==(n=e.messageMap)&&void 0!==n&&null!==(n=n[t])&&void 0!==n&&n[s.messageId]&&(i[t][s.messageId]=e.messageMap[t][s.messageId])})))})),{messageLinkMap:e.messageLinkMap,messageListStatusMap:e.messageListStatusMap,messageMap:e.messageMap,suggestMessageMap:e.suggestMessageMap,localMessageMap:e.localMessageMap,regenerateMessageMap:e.regenerateMessageMap,chunkTaskMap:e.chunkTaskMap,messageFeedbackMap:e.messageFeedbackMap,userInfo:e.userInfo}}catch(t){return i.vF.persist.error({message:"[@message-store] persist state limit error",error:t instanceof Error?t:new Error(String(t))}),{}}}},85062:(e,t,s)=>{s.d(t,{r:()=>l,w:()=>d});var i=s(14065),n=s(85886),a=s(50474),o=s.n(a),r=s(36266),c=s(39390);const l=()=>{const e="undefined"==typeof window?{getItem:()=>null,setItem:()=>null,removeItem:()=>null}:o().createInstance({name:"samantha-web",storeName:"store"});var t,s,n;return{getItem:(n=(0,i.A)((function*(t){return new Promise(((s,i)=>{var n;null===(n=e.getItem(t))||void 0===n||n.then((e=>{s(e)})).catch((e=>{i(e)})),setTimeout((()=>{i(new Error(`getItem ${t} timeout, timeout after 10000ms`))}),1e4)}))})),function(e){return n.apply(this,arguments)}),setItem:(s=(0,i.A)((function*(t,s){const i=(0,c.$)(s);yield e.setItem(t,i)})),function(e,t){return s.apply(this,arguments)}),removeItem:(t=(0,i.A)((function*(t){yield e.removeItem(t)})),function(e){return t.apply(this,arguments)})}},d=e=>{const t=e();if(t){const{getItem:e,setItem:s,removeItem:i}=t;t.setItem=(0,n.A)(u(s,"setItem"),1e3),t.getItem=u(e,"getItem"),t.removeItem=u(i,"removeItem")}return t},u=(e,t)=>(0,i.A)((function*(...s){try{return yield e(...s)}catch(o){if(o instanceof Error){var i,n,a;const{usage:e=0,quota:s=0}=null!==(i=yield null===(n=navigator)||void 0===n||null===(n=n.storage)||void 0===n||null===(a=n.estimate)||void 0===a?void 0:a.call(n))&&void 0!==i?i:{usage:0,quota:0};r.vF.persist.error({message:`[message-core]persist storage action error: ${t} failed`,error:o,meta:{usageSpace:e/1024/1024+" MB",quotaSpace:s/1024/1024+" MB"}})}}}))},76049:(e,t,s)=>{s.d(t,{FQ:()=>i.FQ,aU:()=>i.aU});var i=s(51065)},98016:(e,t,s)=>{function i(e,t){e.messageMap[t]&&delete e.messageMap[t],e.localMessageMap[t]&&delete e.localMessageMap[t],e.regenerateMessageMap[t]&&delete e.regenerateMessageMap[t],e.messageLinkMap[t]&&delete e.messageLinkMap[t],e.messageListStatusMap[t]&&delete e.messageListStatusMap[t]}s.d(t,{z:()=>i})},32368:(e,t,s)=>{s.d(t,{WZ:()=>a,ci:()=>c,rQ:()=>o,rU:()=>r});var i=s(20177),n=s(86836);s(2615);const a=(e,t)=>(0,i.A)(e||[],(e=>t(e))),o=(e=[],t)=>a(e,(e=>{var s;return!e.isLocalMessage&&!!e.messageId&&(null===(s=null==t?void 0:t(e))||void 0===s||s)})),r=({messageLinks:e=[],replyId:t,getMessage:s})=>(0,n.A)(e,(e=>{var i;return(null===(i=s(e))||void 0===i?void 0:i.reply_id)===t})),c=({messageLinks:e=[],replyId:t,getMessage:s})=>a(e,(e=>{var i;return(null===(i=s(e))||void 0===i?void 0:i.reply_id)===t}))},46839:(e,t,s)=>{s.d(t,{b:()=>r});var i=s(1026),n=s(76461),a=s(54903),o=s(2615);const r=(e,t,s)=>{const r=((e,t)=>e.filter((s=>{if(s.isLocalMessage){const i=t(s),a=null==i?void 0:i.message_id,r=null==i?void 0:i.reply_id;if(~(0,n.A)(e,((n,c)=>{if(n===s)return!1;const l=t(n),d=!n.isLocalMessage;if(d&&l&&n.messageId===a)return!0;if(d&&!a&&r&&(null==l?void 0:l.reply_id)===r&&(0,o.$4)(l)){if(!s.regen_head)return!0;if((0,o.pu)(l))return!0;if("local"in i&&i.local.prevRemoteMessageId===l.message_id&&e[c+1]&&!e[c+1].isLocalMessage)return!0}return d&&!a&&!r&&(null==l||l.local_message_id,null==i||i.local_message_id),!1})))return!1}return!0})))((0,i.A)([...e,...t],(e=>e.messageId)),s);return(0,a.Z)(r,s),r}},9820:(e,t,s)=>{s.d(t,{H:()=>l,x:()=>d});var i=s(44557),n=s(85371),a=s(53713),o=s(33664),r=s(2615),c=s(32368);const l=(e,t)=>{const s=(0,i.A)((0,i.A)({},e),{},{localInfo:t,contentObj:!(0,n.A)(null==e?void 0:e.status)||(0,r.yU)(e)||(0,r.ey)(e)?(0,a.OlY)(e.content)||{}:void 0});return(0,n.A)(s.contentObj)||delete s.content,s},d=({prevMessageId:e,message:t,messageLinks:s,localMessageStatus:n,failedExpired:a,sendLoadingExpired:r,isRegenerate:l,localContent:d,enterFrom:u})=>{var g;return(0,i.A)((0,i.A)({},t),{},{message_type:o.Go.Message,create_time:Date.now(),status:o.q7.Available,localContent:d,local:{prevRemoteMessageId:e||(null===(g=(0,c.rQ)(s))||void 0===g?void 0:g.messageId)||"",status:n,failed:!1,isRetried:!1,failedExpired:a,sendLoadingExpired:r,isRegenerate:l,enterFrom:u}})}},21576:(e,t,s)=>{s.d(t,{C:()=>i});const i={addDuration(e,t){Object.values(e||{}).forEach((e=>{null==e||e.addDurationPoint(t)}))},updateMeta(e,t){Object.values(e||{}).forEach((e=>{null==e||e.updateMeta(t)}))},success(e,t){Object.values(e||{}).forEach((e=>{null==e||e.success(t)}))},error(e,t){Object.values(e||{}).forEach((e=>{null==e||e.error(t)}))}}},48733:(e,t,s)=>{s.d(t,{T:()=>i});const i=(e,t)=>{if(0===e.length||1===e.length)return e;let s=e.length,i=-1;function n(e,t){i=e,s=t}for(let a=e.length-1;a>=0;a--){if(e[a].isLocalMessage)continue;const o=t(e[a]);if(!o)break;const r=Number(o.index);if(-1!==i)if(i!==r){if(i-1!==r)break;n(r,a)}else e.splice(s,1),n(r,a);else n(r,a)}return e.slice(s)}},54903:(e,t,s)=>{s.d(t,{Z:()=>o,r:()=>a});var i=s(78289),n=s(2615);function a(e,t){return(Number(null==e?void 0:e.index)||0)-(Number(null==t?void 0:t.index)||0)}const o=(e,t)=>{e.sort(((e,s)=>{if(!e.isLocalMessage&&!s.isLocalMessage)return a(t(e),t(s));if(e.isLocalMessage&&s.isLocalMessage)return o=t(e),r=t(s),((0,i.Q)(Number(null==o?void 0:o.create_time))||0)-((0,i.Q)(Number(null==r?void 0:r.create_time))||0);var o,r;if(e.isLocalMessage&&!s.isLocalMessage||!e.isLocalMessage&&s.isLocalMessage){const i=e.isLocalMessage&&!s.isLocalMessage,o=s.isLocalMessage&&!e.isLocalMessage,r=t(i?e:s),c=t(o?e:s);if(r&&"index"in r)return a(r,c);const l=r&&(0,n.xX)(r)&&r.local.prevRemoteMessageId?t({messageId:r.local.prevRemoteMessageId,isLocalMessage:!1}):void 0;return l===c?i?1:-1:i?a(l,c):a(c,l)}return 0}))}},78289:(e,t,s)=>{function i(e){const t=Date.now();if(e%Math.pow(10,t.toString().length-1)===e){const s=1e3*e;return s<t?s:e}return e}s.d(t,{Q:()=>i})},66221:(e,t,s)=>{s.d(t,{B:()=>i});const i=new(s(60588).b)},65944:(e,t,s)=>{s.d(t,{G:()=>o});var i=s(10633);const n=Symbol("newer"),a=Symbol("older");class o{constructor(e,t){(0,i.A)(this,"size",void 0),(0,i.A)(this,"limit",void 0),(0,i.A)(this,"oldest",void 0),(0,i.A)(this,"newest",void 0),(0,i.A)(this,"_keyMap",void 0),this.size=0,this.limit=e,this.oldest=this.newest=void 0,this._keyMap=new Map,t&&(this.assign(t),e<1&&(this.limit=this.size))}_markEntryAsUsed(e){e!==this.newest&&(e[n]&&(e===this.oldest&&(this.oldest=e[n]),e[n][a]=e[a]),e[a]&&(e[a][n]=e[n]),e[n]=void 0,e[a]=this.newest,this.newest&&(this.newest[n]=e),this.newest=e)}assign(e){let t,s=this.limit||Number.MAX_VALUE;this._keyMap.clear();const i=e[Symbol.iterator]();for(let o=i.next();!o.done;o=i.next()){const e=new r(o.value[0],o.value[1]);if(this._keyMap.set(e.key,e),t?(t[n]=e,e[a]=t):this.oldest=e,t=e,0==s--)throw new Error("overflow")}this.newest=t,this.size=this._keyMap.size}get(e){const t=this._keyMap.get(e);if(t)return this._markEntryAsUsed(t),t.value}set(e,t){let s=this._keyMap.get(e);return s?(s.value=t,this._markEntryAsUsed(s),this):(this._keyMap.set(e,s=new r(e,t)),this.newest?(this.newest[n]=s,s[a]=this.newest):this.oldest=s,this.newest=s,++this.size,this.size>this.limit&&this.shift(),this)}shift(){const e=this.oldest;var t;if(e)return null!==(t=this.oldest)&&void 0!==t&&t[n]?(this.oldest=this.oldest[n],this.oldest[a]=void 0):(this.oldest=void 0,this.newest=void 0),e[n]=e[a]=void 0,this._keyMap.delete(e.key),--this.size,[e.key,e.value]}find(e){const t=this._keyMap.get(e);return t?t.value:void 0}has(e){return this._keyMap.has(e)}delete(e){const t=this._keyMap.get(e);if(t)return this._keyMap.delete(t.key),t[n]&&t[a]?(t[a][n]=t[n],t[n][a]=t[a]):t[n]?(t[n][a]=void 0,this.oldest=t[n]):t[a]?(t[a][n]=void 0,this.newest=t[a]):this.oldest=this.newest=void 0,this.size--,t.value}clear(){this.oldest=this.newest=void 0,this.size=0,this._keyMap.clear()}keys(){return new l(this.oldest)}values(){return new d(this.oldest)}entries(){return this}[Symbol.iterator](){return new c(this.oldest)}forEach(e,t){"object"!=typeof t&&(t=this);let s=this.oldest;for(;s;)e.call(t,s.value,s.key,this),s=s[n]}toJSON(){let e=new Array(this.size),t=0,s=this.oldest;for(;s;)e[t++]={key:s.key,value:s.value},s=s[n];return e}toString(){let e="",t=this.oldest;for(;t;)e+=`${String(t.key)}:${t.value}`,t=t[n],t&&(e+=" < ");return e}}class r{constructor(e,t){(0,i.A)(this,n,void 0),(0,i.A)(this,a,void 0),this.key=e,this.value=t,this[n]=void 0,this[a]=void 0}}class c{constructor(e){(0,i.A)(this,"entry",void 0),this.entry=e}[Symbol.iterator](){return this}next(){const e=this.entry;return e?(this.entry=e[n],{done:!1,value:[e.key,e.value]}):{done:!0,value:void 0}}}class l{constructor(e){(0,i.A)(this,"entry",void 0),this.entry=e}[Symbol.iterator](){return this}next(){const e=this.entry;return e?(this.entry=e[n],{done:!1,value:e.key}):{done:!0,value:void 0}}}class d{constructor(e){(0,i.A)(this,"entry",void 0),this.entry=e}[Symbol.iterator](){return this}next(){const e=this.entry;return e?(this.entry=e[n],{done:!1,value:e.value}):{done:!0,value:void 0}}}},8719:(e,t,s)=>{s.d(t,{n:()=>k});var i=s(44557),n=s(33451),a=s(67439),o=s(25125),r=s(30553),c=s(72579),l=s(39476),d=s(75310),u=s(73110),g=s(863),h=s(14769),p=s(19112),_=s(25975),m=s(75486),v=s(46715),f=s(53508),y=s(36588);const b=["params","headers"],S={bot:o.Ay,conversation:r.Ay,message:l.Ay,dataReport:c.A,samantha:p.Ay,notify:d.Ay,safety:h.Ay,profile:u.Ay,search:_.Ay,social:y.Ay,suggestwords:f.A,resource:g.A,setting:v.Ay,seo:m.Ay},k=e=>{const{httpClient:t,getCommonHeaders:s,getCommonParams:o,baseURL:r,ApiServiceConstructor:c=a.Ay,subApiServiceConstructors:l}=e,d={baseURL:r,request:(e,a)=>{let{params:r,headers:c}=e,l=(0,n.A)(e,b);return t((0,i.A)({params:(0,i.A)((0,i.A)({},null==o?void 0:o()),r),headers:(0,i.A)((0,i.A)((0,i.A)({},null==s?void 0:s()),c),null==a?void 0:a.overrideHeaders)},l),a)}},{apiServiceConstructorOptions:u=d,subApiServiceConstructorOptions:g={bot:u,conversation:u,message:u,dataReport:u,samantha:u,safety:u,notify:u,suggestwords:u,search:u,profile:u,social:u,resource:u,setting:u,seo:u}}=e,h=new c(u);return Object.entries((0,i.A)((0,i.A)({},S),l)).forEach((([e,t])=>{h[e]=new t(g[e])})),h.requestWithPath=e=>(t,s)=>{var n;const a="string"!=typeof d.baseURL?(null===(n=d.baseURL)||void 0===n?void 0:n.call(d,e))||e:`${d.baseURL}${e}`;if(!d.request)throw Error("implement error");return d.request((0,i.A)((0,i.A)({},t),{},{url:t.url||a}),s)},h}},67439:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("AliceApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}CheckUpdate(e,t){const s=this.genBaseURL("/alice/update/check");return this.request({url:s,method:"POST"},t)}GetQuery(e,t){const s=this.genBaseURL("/alice/query"),i=e||{},n={query_text:i.query_text,source:i.source};return this.request({url:s,method:"POST",data:n},t)}LoadVideoTT(e,t){const s=this.genBaseURL("/alice/media/source/2"),i=e||{},n={query:i.query,search_id:i.search_id,item_ids:i.item_ids,offset:i.offset,limit:i.limit};return this.request({url:s,method:"POST",data:n},t)}LoadVideoDY(e,t){const s=this.genBaseURL("/alice/media/source/3"),i=e||{},n={query:i.query,search_id:i.search_id,item_ids:i.item_ids,offset:i.offset,limit:i.limit};return this.request({url:s,method:"POST",data:n},t)}DebugPromptDetail(e,t){const s=this.genBaseURL("/alice/debug/prompt_detail"),i=e||{},n={message_id:i.message_id,type_list:i.type_list};return this.request({url:s,method:"POST",data:n},t)}MCheckMusic(e,t){const s=this.genBaseURL("/alice/media/mcheck/music"),i=e||{},n={check_list:i.check_list,scene:i.scene};return this.request({url:s,method:"POST",data:n},t)}Report(e,t){const s=this.genBaseURL("/alice/report/create"),i=e||{},n={report_type:i.report_type,entity_id:i.entity_id,reason_ids:i.reason_ids,reason_detail:i.reason_detail};return this.request({url:s,method:"POST",data:n},t)}TemplateRecommendRelated(e,t){const s=this.genBaseURL("/alice/template/recommend_related"),i=e||{},n={template_type:i.template_type,template_id:i.template_id,offset:i.offset,size:i.size,enter_time:i.enter_time};return this.request({url:s,method:"POST",data:n},t)}TemplateRecommendList(e,t){const s=this.genBaseURL("/alice/template/recommend_list"),i=e||{},n={template_type:i.template_type,offset:i.offset,size:i.size,token:i.token};return this.request({url:s,method:"POST",data:n},t)}LoadMusicQS(e,t){const s=this.genBaseURL("/alice/media/source/4"),i={vid_list:(e||{}).vid_list};return this.request({url:s,method:"POST",data:i},t)}GetMsgTemplates(e,t){const s=this.genBaseURL("/alice/msg_template/get"),i=e||{},n={cursor:i.cursor,size:i.size,template_lang:i.template_lang,cold_start:i.cold_start};return this.request({url:s,method:"POST",data:n},t)}SearchCards(e,t){const s=this.genBaseURL("/alice/media/card_search"),i=e||{},n={query_params:i.query_params,query_type:i.query_type};return this.request({url:s,method:"POST",data:n},t)}}},25125:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("AliceBotApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}GenBotIcon(e,t){const s=this.genBaseURL("/alice/bot/gen_icon"),i=e||{},n={name:i.name,description:i.description,bot_lang:i.bot_lang};return this.request({url:s,method:"POST",data:n},t)}GenBotIconByPrompt(e,t){const s=this.genBaseURL("/alice/bot/gen_icon_by_prompt"),i=e||{},n={prompt:i.prompt,num:i.num,image_req:i.image_req};return this.request({url:s,method:"POST",data:n},t)}GetBotList(e,t){const s=this.genBaseURL("/alice/bot/get_bot_list"),i=e||{},n={bot_ids:i.bot_ids,bot_list_type:i.bot_list_type,pageIndex:i.pageIndex,pageSize:i.pageSize};return this.request({url:s,method:"POST",data:n},t)}UploadFile(e,t){const s=this.genBaseURL("/alice/bot/upload_file"),i=e||{},n={file_head:i.file_head,data:i.data};return this.request({url:s,method:"POST",data:n},t)}RecommendBots(e,t){const s=this.genBaseURL("/alice/bot/recommend"),i=e||{},n={recommend_type:i.recommend_type,page_index:i.page_index,page_size:i.page_size,bot_ids:i.bot_ids,tag_id:i.tag_id,msg_list:i.msg_list,cold_start:i.cold_start};return this.request({url:s,method:"POST",data:n},t)}LanguageList(e,t){const s=this.genBaseURL("/alice/bot/language_list"),i={bot_id:(e||{}).bot_id};return this.request({url:s,method:"POST",data:i},t)}CreateBot(e,t){const s=this.genBaseURL("/alice/bot/create"),i=e||{},n={name:i.name,description_for_human:i.description_for_human,icon_uri:i.icon_uri,private_status:i.private_status,voice_type:i.voice_type,ugc_voice:i.ugc_voice,bot_lang:i.bot_lang,muted:i.muted,use_bot_enrich:i.use_bot_enrich,enable_web_search:i.enable_web_search,enable_pic_gen:i.enable_pic_gen,first_met:i.first_met,use_bot_enrich_edit:i.use_bot_enrich_edit,create_channel:i.create_channel,bg_img_uri:i.bg_img_uri,bg_img_info:i.bg_img_info,user_bot_gender_starling_key:i.user_bot_gender_starling_key,user_bot_type_starling_key:i.user_bot_type_starling_key,original_user_img_uri:i.original_user_img_uri};return this.request({url:s,method:"POST",data:n},t)}EnrichBot(e,t){const s=this.genBaseURL("/alice/bot/enrich"),i=e||{},n={name:i.name,bot_lang:i.bot_lang,need_desc:i.need_desc,need_voice_type:i.need_voice_type,user_bot_gender_starling_key:i.user_bot_gender_starling_key,user_bot_type_starling_key:i.user_bot_type_starling_key,bg_img_prompt:i.bg_img_prompt};return this.request({url:s,method:"POST",data:n},t)}UpdateBot(e,t){const s=this.genBaseURL("/alice/bot/update_bot"),i=e||{},n={bot_id:i.bot_id,name:i.name,description_for_human:i.description_for_human,icon_uri:i.icon_uri,model_type:i.model_type,voice_type:i.voice_type,delete:i.delete,bot_lang:i.bot_lang,muted:i.muted,private_status:i.private_status,ugc_voice:i.ugc_voice,message_push:i.message_push,enable_web_search:i.enable_web_search,enable_pic_gen:i.enable_pic_gen,first_met:i.first_met,bg_img_uri:i.bg_img_uri,bg_img_info:i.bg_img_info,dynamic_img_uri:i.dynamic_img_uri,bot_icon_mapped_app_icon:i.bot_icon_mapped_app_icon,original_user_img_uri:i.original_user_img_uri};return this.request({url:s,method:"POST",data:n},t)}VoiceTypeList(e,t){const s=this.genBaseURL("/alice/bot/voice_type_list"),i=e||{},n={bot_id:i.bot_id,bot_language_code:i.bot_language_code};return this.request({url:s,method:"POST",data:n},t)}BotInfo(e,t){const s=this.genBaseURL("/alice/bot/info"),i=e||{},n={token:i.token,botId:i.botId};return this.request({url:s,method:"POST",data:n},t)}GetBotSubject(e,t){const s=this.genBaseURL("/alice/bot/get_bot_subject"),i={bot_id:(e||{}).bot_id};return this.request({url:s,method:"POST",data:i},t)}UpdateCallerName(e,t){const s=this.genBaseURL("/alice/bot/update_caller_name"),i=e||{},n={bot_id:i.bot_id,caller_name:i.caller_name};return this.request({url:s,method:"POST",data:n},t)}GetBotPreset(e,t){const s=this.genBaseURL("/alice/bot/get_bot_preset"),i={bot_id:(e||{}).bot_id};return this.request({url:s,method:"POST",data:i},t)}GetFirstMet(e,t){const s=this.genBaseURL("/alice/bot/first_met"),i={bot_id:(e||{}).bot_id};return this.request({url:s,method:"POST",data:i},t)}GetBot(e,t){const s=this.genBaseURL("/alice/bot/get_bot"),i={bot_id:(e||{}).bot_id};return this.request({url:s,method:"POST",data:i},t)}GetBotListV2(e,t){const s=this.genBaseURL("/alice/bot/get_bot_list_v2"),i=e||{},n={bot_id_list:i.bot_id_list,scene:i.scene};return this.request({url:s,method:"POST",data:n},t)}ActionBarList(e,t){const s=this.genBaseURL("/alice/bot/action_bar_list"),i=e||{},n={language_code:i.language_code,bot_id:i.bot_id,conversation_id:i.conversation_id};return this.request({url:s,method:"POST",data:n},t)}ActionBarOperationReport(e,t){const s=this.genBaseURL("/alice/bot/action_bar_report"),i=e||{},n={language_code:i.language_code,bot_id:i.bot_id,conversation_id:i.conversation_id,action_bar_key:i.action_bar_key,passthrough_field:i.passthrough_field,switch_report:i.switch_report,instruction_report:i.instruction_report};return this.request({url:s,method:"POST",data:n},t)}ActionCards(e,t){const s=this.genBaseURL("/alice/bot/action_cards"),i=e||{},n={bot_id:i.bot_id,card_scene:i.card_scene};return this.request({url:s,method:"POST",data:n},t)}ReviewBotInfo(e,t){const s=this.genBaseURL("/alice/bot/review_bot_info"),i={bot_info:(e||{}).bot_info};return this.request({url:s,method:"POST",data:i},t)}GetAvatarHeadLocation(e,t){const s=this.genBaseURL("/alice/bot/avatar_head_location"),i={image_uri_list:(e||{}).image_uri_list};return this.request({url:s,method:"POST",data:i},t)}GetImgAvgHue(e,t){const s=this.genBaseURL("/alice/bot/get_img_avg_hue"),i={image_uri:(e||{}).image_uri};return this.request({url:s,method:"POST",data:i},t)}CheckBotAuth(e,t){const s=this.genBaseURL("/alice/bot/check_bot_auth"),i=e||{},n={client_key:i.client_key,scope:i.scope,state:i.state};return this.request({url:s,method:"POST",data:n},t)}PluginAuth(e,t){const s=this.genBaseURL("/alice/bot/plugin_auth"),i=e||{},n={bot_id:i.bot_id,plugin_ids:i.plugin_ids,op_type:i.op_type};return this.request({url:s,method:"POST",data:n},t)}PluginDetail(e,t){const s=this.genBaseURL("/alice/bot/plugin_detail"),i={plugin_id:(e||{}).plugin_id};return this.request({url:s,method:"POST",data:i},t)}PluginList(e,t){const s=this.genBaseURL("/alice/bot/plugin_list"),i=e||{},n={bot_id:i.bot_id,page_no:i.page_no,page_size:i.page_size};return this.request({url:s,method:"POST",data:n},t)}GetBotCreateQuota(e,t){const s=this.genBaseURL("/alice/bot/get_bot_create_quota");return this.request({url:s,method:"POST"},t)}Mock(e,t){const s=this.genBaseURL("/alice/bot/mock"),i=e||{},n={delete_current_week:i.delete_current_week,AddTime:i.AddTime,Uid:i.Uid};return this.request({url:s,method:"POST",data:n},t)}}},30553:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("AliceConversationApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}CreateSubConversation(e,t){const s=this.genBaseURL("/alice/conversation/create_sub_conversation"),i=e||{},n={conversation_id:i.conversation_id,message_id:i.message_id,scene:i.scene};return this.request({url:s,method:"POST",data:n},t)}ConversationPin(e,t){const s=this.genBaseURL("/alice/conversation/pin"),i=e||{},n={conversation_id:i.conversation_id,bot_id:i.bot_id,local_conversation_id:i.local_conversation_id,ext:i.ext};return this.request({url:s,method:"POST",data:n},t)}ConversationUpdate(e,t){const s=this.genBaseURL("/alice/conversation/update"),i=e||{},n={conversation_id:i.conversation_id,name:i.name,local_conversation_id:i.local_conversation_id,bot_id:i.bot_id,ext:i.ext};return this.request({url:s,method:"POST",data:n},t)}ConversationInfo(e,t){const s=this.genBaseURL("/alice/conversation/info"),i=e||{},n={conversation_id:i.conversation_id,bot_id:i.bot_id,local_conversation_id:i.local_conversation_id,ext:i.ext,init_messages:i.init_messages,bot_source:i.bot_source,scene:i.scene};return this.request({url:s,method:"POST",data:n},t)}ConversationUnpin(e,t){const s=this.genBaseURL("/alice/conversation/unpin"),i={conversation_id:(e||{}).conversation_id};return this.request({url:s,method:"POST",data:i},t)}CreateSection(e,t){const s=this.genBaseURL("/alice/conversation/create_section"),i=e||{},n={conversation_id:i.conversation_id,local_conversation_id:i.local_conversation_id,bot_id:i.bot_id,ext:i.ext};return this.request({url:s,method:"POST",data:n},t)}MarkConversationRead(e,t){const s=this.genBaseURL("/alice/conversation/mark_conversation_read"),i=e||{},n={conversation_id:i.conversation_id,latest_read_idx:i.latest_read_idx};return this.request({url:s,method:"POST",data:n},t)}ConversationArchive(e,t){const s=this.genBaseURL("/alice/conversation/archive"),i=e||{},n={conversation_id:i.conversation_id,bot_id:i.bot_id,local_conversation_id:i.local_conversation_id};return this.request({url:s,method:"POST",data:n},t)}ConversationInfoAddBot(e,t){const s=this.genBaseURL("/alice/conversation/add_bot"),i={token:(e||{}).token};return this.request({url:s,method:"POST",data:i},t)}ConversationClear(e,t){const s=this.genBaseURL("/alice/conversation/clear"),i=e||{},n={conversation_id:i.conversation_id,local_conversation_id:i.local_conversation_id,bot_id:i.bot_id,ext:i.ext};return this.request({url:s,method:"POST",data:n},t)}ConversationList(e,t){const s=this.genBaseURL("/alice/conversation/list"),i=e||{},n={index:i.index,batch_size:i.batch_size,conversation_types:i.conversation_types};return this.request({url:s,method:"POST",data:n},t)}ConversationReport(e,t){const s=this.genBaseURL("/alice/conversation/report"),i=e||{},n={conversation_id:i.conversation_id,conversation_type:i.conversation_type,bot_conversation_type:i.bot_conversation_type};return this.request({url:s,method:"POST",data:n},t)}}},86204:(e,t,s)=>{s.d(t,{Cr:()=>i});let i=function(e){return e[e.Coco=1]="Coco",e[e.Bot=2]="Bot",e[e.CocoSub=3]="CocoSub",e[e.CocoWeb=4]="CocoWeb",e[e.CocoWebSub=5]="CocoWebSub",e}({})},39476:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("MessageApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}StreamCallBot(e,t){const s=this.genBaseURL("/alice/message/stream_call_bot"),i={payload:(e||{}).payload};return this.request({url:s,method:"POST",data:i},t)}LoadMusicQS(e,t){const s=this.genBaseURL("/alice/media/source/4"),i={vid_list:(e||{}).vid_list};return this.request({url:s,method:"POST",data:i},t)}MessageReplay(e,t){const s=this.genBaseURL("/alice/message/replay"),i={payload:(e||{}).payload};return this.request({url:s,method:"POST",data:i},t)}MessageList(e,t){const s=this.genBaseURL("/alice/message/list"),i=e||{},n={conversation_id:i.conversation_id,cursor:i.cursor,batch_size:i.batch_size,bot_id:i.bot_id};return this.request({url:s,method:"POST",data:n},t)}LoadVideoDY(e,t){const s=this.genBaseURL("/alice/media/source/3"),i=e||{},n={query:i.query,search_id:i.search_id,item_ids:i.item_ids,offset:i.offset,limit:i.limit};return this.request({url:s,method:"POST",data:n},t)}SearchCards(e,t){const s=this.genBaseURL("/alice/media/card_search"),i=e||{},n={query_params:i.query_params,query_type:i.query_type};return this.request({url:s,method:"POST",data:n},t)}MessageStream(e,t){const s=this.genBaseURL("/alice/message/stream_reply"),i=e||{},n={seq_st:i.seq_st,seq_ed:i.seq_ed,reply_id:i.reply_id,binary_type:i.binary_type,token:i.token};return this.request({url:s,method:"POST",data:n},t)}MessageReport(e,t){const s=this.genBaseURL("/alice/message/report"),i=e||{},n={message_id:i.message_id,reply_id:i.reply_id,action:i.action,position:i.position,feedbackDetail:i.feedbackDetail,conversation_id:i.conversation_id,feedbackSource:i.feedbackSource};return this.request({url:s,method:"POST",data:n},t)}GetMessageReply(e,t){const s=this.genBaseURL("/alice/message/get_reply"),i=e||{},n={message_id:i.message_id,conversation_id:i.conversation_id};return this.request({url:s,method:"POST",data:n},t)}LoadVideoTT(e,t){const s=this.genBaseURL("/alice/media/source/2"),i=e||{},n={query:i.query,search_id:i.search_id,item_ids:i.item_ids,offset:i.offset,limit:i.limit};return this.request({url:s,method:"POST",data:n},t)}UpdateMsgContent(e,t){const s=this.genBaseURL("/alice/message/update_content"),i=e||{},n={msg_id:i.msg_id,display_content:i.display_content,content:i.content,need_social_adapter:i.need_social_adapter};return this.request({url:s,method:"POST",data:n},t)}LatestMessageList(e,t){const s=this.genBaseURL("/alice/conversation/latest_messagelist"),i={request_list:(e||{}).request_list};return this.request({url:s,method:"POST",data:i},t)}MCheckMusic(e,t){const s=this.genBaseURL("/alice/media/mcheck/music"),i=e||{},n={check_list:i.check_list,scene:i.scene};return this.request({url:s,method:"POST",data:n},t)}GetMsgContent(e,t){const s=this.genBaseURL("/alice/message/content"),i={msg_id:(e||{}).msg_id};return this.request({url:s,method:"POST",data:i},t)}GetAnswerActionContent(e,t){const s=this.genBaseURL("/alice/message/answer_action_content"),i=e||{},n={action_key:i.action_key,msg_id:i.msg_id,bot_id:i.bot_id,conversation_id:i.conversation_id,section_id:i.section_id};return this.request({url:s,method:"POST",data:n},t)}CheckMessageSendRateLimit(e,t){const s=this.genBaseURL("/alice/message/rate_limit");return this.request({url:s,method:"POST"},t)}PutChatRecord(e,t){const s=this.genBaseURL("/alice/message/put_chat_record"),i=e||{},n={conversation_id:i.conversation_id,tool_message_id:i.tool_message_id,switch_message_id:i.switch_message_id};return this.request({url:s,method:"POST",data:n},t)}CmdList(e,t){const s=this.genBaseURL("/alice/message/cmd_list"),i=e||{},n={last_cmd_index:i.last_cmd_index,batch_size:i.batch_size};return this.request({url:s,method:"POST",data:n},t)}MessagePreHandle(e,t){const s=this.genBaseURL("/alice/message/pre_handle"),i=e||{},n={content_type:i.content_type,content:i.content};return this.request({url:s,method:"POST",data:n},t)}MessageListV2(e,t){const s=this.genBaseURL("/alice/message/list/v2"),i=e||{},n={conversation_id:i.conversation_id,start_index:i.start_index,batch_size:i.batch_size,is_reverse:i.is_reverse,end_index:i.end_index};return this.request({url:s,method:"POST",data:n},t)}MessageStreamV2(e,t){const s=this.genBaseURL("/alice/message/stream"),i=e||{},n={seq_st:i.seq_st,seq_ed:i.seq_ed,reply_id:i.reply_id,binary_type:i.binary_type,token:i.token};return this.request({url:s,method:"POST",data:n},t)}SaveBotReply(e,t){const s=this.genBaseURL("/alice/message/save_bot_reply"),i=e||{},n={user_id:i.user_id,conversation_id:i.conversation_id,bot_id:i.bot_id,question_id:i.question_id,contents:i.contents,suggests:i.suggests,source_type:i.source_type,for_historical_question:i.for_historical_question,biz_id:i.biz_id,tenant_id:i.tenant_id};return this.request({url:s,method:"POST",data:n},t)}SaveMessageShareInfo(e,t){const s=this.genBaseURL("/alice/message/share/save"),i=e||{},n={conv_id:i.conv_id,message_id_list:i.message_id_list,enable_generate_title:i.enable_generate_title,is_allow_seo:i.is_allow_seo,share_total_conversation:i.share_total_conversation};return this.request({url:s,method:"POST",data:n},t)}GetMessageShareInfo(e,t){const s=this.genBaseURL("/alice/message/share/get"),i={share_id:(e||{}).share_id};return this.request({url:s,method:"POST",data:i},t)}MessageAfterAuthorization(e,t){const s=this.genBaseURL("/alice/message/after_authorization"),i={scene:(e||{}).scene};return this.request({url:s,method:"POST",data:i},t)}MultiMessagePreHandle(e,t){const s=this.genBaseURL("/alice/message/pre_handle_v2"),i=e||{},n={uplink_entity:i.uplink_entity,conversation_id:i.conversation_id,bot_id:i.bot_id,section_id:i.section_id,local_message_id:i.local_message_id};return this.request({url:s,method:"POST",data:n},t)}MessageEntityState(e,t){const s=this.genBaseURL("/alice/message/entity_state"),i=e||{},n={state_type:i.state_type,entity_info:i.entity_info};return this.request({url:s,method:"POST",data:n},t)}GetBigMusicLyrics(e,t){const s=this.genBaseURL("/alice/media/bigmusic/lyrics"),i=e||{},n={prompt:i.prompt,instruction_options:i.instruction_options};return this.request({url:s,method:"POST",data:n},t)}UpdateBigMusicMsg(e,t){const s=this.genBaseURL("/alice/media/bigmusic/update_message"),i=e||{},n={message_id:i.message_id,title:i.title,cover_uri:i.cover_uri};return this.request({url:s,method:"POST",data:n},t)}GetBigMusicVideoInfo(e,t){const s=this.genBaseURL("/alice/media/bigmusic/get_video"),i=e||{},n={video_id:i.video_id,share_id:i.share_id,download_params:i.download_params};return this.request({url:s,method:"POST",data:n},t)}MultiMessagePreHandleWithoutConv(e,t){const s=this.genBaseURL("/alice/message/pre_handle_v2_without_conv"),i=e||{},n={uplink_entity:i.uplink_entity,bot_id:i.bot_id,local_message_id:i.local_message_id,pre_generate_id:i.pre_generate_id};return this.request({url:s,method:"POST",data:n},t)}SaveBigMusicShareInfo(e,t){const s=this.genBaseURL("/alice/media/bigmusic/share_save"),i={message_id:(e||{}).message_id};return this.request({url:s,method:"POST",data:i},t)}GetBigMusicLyricsWeb(e,t){const s=this.genBaseURL("/alice/media/bigmusic/lyrics_web"),i=e||{},n={prompt:i.prompt,genre:i.genre,mood:i.mood};return this.request({url:s,method:"POST",data:n},t)}MessageListDouyinPlayback(e,t){const s=this.genBaseURL("/alice/message/douyin_playback"),i=e||{},n={encryption_message_id_list:i.encryption_message_id_list,date:i.date,with_push_message:i.with_push_message};return this.request({url:s,method:"POST",data:n},t)}UpdateBigMusicMsgWeb(e,t){const s=this.genBaseURL("/alice/media/bigmusic/update_message_web"),i=e||{},n={message_id:i.message_id,title:i.title,cover_uri:i.cover_uri};return this.request({url:s,method:"POST",data:n},t)}GetMessageListByIndexList(e,t){const s=this.genBaseURL("/alice/message/index_list"),i=e||{},n={conversation_id:i.conversation_id,message_index_list:i.message_index_list,is_reverse:i.is_reverse};return this.request({url:s,method:"POST",data:n},t)}}},2325:(e,t,s)=>{s.d(t,{Cp:()=>o,HK:()=>i,MW:()=>n,hI:()=>a});let i=function(e){return e[e.MessageDelete=1]="MessageDelete",e[e.MessageLike=2]="MessageLike",e[e.MessageDislike=3]="MessageDislike",e[e.MessageIDLocalMapping=4]="MessageIDLocalMapping",e[e.MessageNotCompliant=5]="MessageNotCompliant",e[e.ConversationArchive=11]="ConversationArchive",e[e.ConversationAdd=12]="ConversationAdd",e[e.ConversationCreateSection=13]="ConversationCreateSection",e[e.ConversationClearHistory=14]="ConversationClearHistory",e[e.ConversationUpdate=15]="ConversationUpdate",e[e.ConversationRead=16]="ConversationRead",e[e.ConversationLandingInsert=17]="ConversationLandingInsert",e[e.OnboardingBegin=21]="OnboardingBegin",e[e.OnboardingFail=22]="OnboardingFail",e[e.OnboardingCancel=23]="OnboardingCancel",e[e.OnboardingNeedStart=26]="OnboardingNeedStart",e[e.UserBanned=31]="UserBanned",e[e.UserBanRelease=32]="UserBanRelease",e[e.UserConfigUpdate=41]="UserConfigUpdate",e[e.NeedLocation=51]="NeedLocation",e[e.TTSBegin=91]="TTSBegin",e[e.UserMute=101]="UserMute",e[e.UserMuteRelease=102]="UserMuteRelease",e[e.TouristReachChatLimit=1e3]="TouristReachChatLimit",e[e.NestedMessageStateChange=1001]="NestedMessageStateChange",e[e.TouristReachThreadLimit=1002]="TouristReachThreadLimit",e}({}),n=function(e){return e[e.Default=0]="Default",e[e.Like=1]="Like",e[e.Unlike=2]="Unlike",e[e.Better=3]="Better",e[e.Almost=4]="Almost",e}({}),a=function(e){return e[e.ParseState_Default=0]="ParseState_Default",e[e.ParseState_Success=1]="ParseState_Success",e[e.ParseState_Failed=2]="ParseState_Failed",e[e.ParseState_Processing=3]="ParseState_Processing",e}({}),o=function(e){return e[e.ReviewState_Default=0]="ReviewState_Default",e[e.ReviewState_Access=1]="ReviewState_Access",e[e.ReviewState_NotCompliant=2]="ReviewState_NotCompliant",e[e.ReviewState_Processing=3]="ReviewState_Processing",e}({})},16181:(e,t,s)=>{s.d(t,{ck:()=>i});let i=function(e){return e[e.EntityType_Unknown=0]="EntityType_Unknown",e[e.EntityType_File=1]="EntityType_File",e[e.EntityType_Image=2]="EntityType_Image",e}({})},75310:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("NotifyApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}GetNoticeGroupUnreadCount(e,t){const s=this.genBaseURL("/alice/notice/get_unread_count"),i={groups:(e||{}).groups};return this.request({url:s,method:"POST",data:i},t)}GetNoticeList(e,t){const s=this.genBaseURL("/alice/notice/list"),i=e||{},n={min_cursor:i.min_cursor,max_cursor:i.max_cursor,count:i.count,need_read_time:i.need_read_time};return this.request({url:s,method:"POST",data:n},t)}MarkReadNotice(e,t){const s=this.genBaseURL("/alice/notice/mark_read"),i=e||{},n={group:i.group,last_read_time:i.last_read_time,mark_count:i.mark_count,groups:i.groups,notice_id:i.notice_id};return this.request({url:s,method:"POST",data:n},t)}GetPushContent(e,t){const s=this.genBaseURL("/alice/notice/push_content"),i=e||{},n={group_id:i.group_id,user_id:i.user_id};return this.request({url:s,method:"POST",data:n},t)}ReportOCPCEvent(e,t){const s=this.genBaseURL("/alice/notice/report_ocpc"),i=e||{},n={landing_page_url:i.landing_page_url,app_id:i.app_id,event_ts:i.event_ts,event_name:i.event_name,event_params:i.event_params};return this.request({url:s,method:"POST",data:n},t)}GetNoticeBanner(e,t){const s=this.genBaseURL("/alice/notice/banner");return this.request({url:s,method:"POST"},t)}UpdateRedDot(e,t){const s=this.genBaseURL("/alice/notice/update_red_dot"),i=e||{},n={user_id:i.user_id,all_red_dot:i.all_red_dot,red_dot:i.red_dot};return this.request({url:s,method:"POST",data:n},t)}GetAggregationList(e,t){const s=this.genBaseURL("/alice/notice/agg_list"),i=e||{},n={notice_id:i.notice_id,notice_group:i.notice_group,min_cursor:i.min_cursor,max_cursor:i.max_cursor,count:i.count,bot_id:i.bot_id};return this.request({url:s,method:"POST",data:n},t)}}},73110:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("ProfileApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}ProfileBotList(e,t){const s=this.genBaseURL("/alice/profile/bot_list"),i=e||{},n={visit_id:i.visit_id,index:i.index,limit:i.limit};return this.request({url:s,method:"POST",data:n},t)}ProfileInfo(e,t){const s=this.genBaseURL("/alice/profile/self"),i={visit_id:(e||{}).visit_id};return this.request({url:s,method:"POST",data:i},t)}CheckProfileInfoDefault(e,t){const s=this.genBaseURL("/alice/profile/info_default"),i={entity_id:(e||{}).entity_id};return this.request({url:s,method:"POST",data:i},t)}UserHitProfileRegister(e,t){const s=this.genBaseURL("/alice/profile/hit_register");return this.request({url:s,method:"POST"},t)}UpdateProfile(e,t){const s=this.genBaseURL("/alice/profile/update_profile"),i=e||{},n={entity_id:i.entity_id,nickname:i.nickname,user_name:i.user_name,avatar_url:i.avatar_url,is_register:i.is_register,user_language_code:i.user_language_code};return this.request({url:s,method:"POST",data:n},t)}CheckUserNameUnique(e,t){const s=this.genBaseURL("/alice/profile/user_name_unique"),i=e||{},n={user_name:i.user_name,entity_id:i.entity_id};return this.request({url:s,method:"POST",data:n},t)}ProfileOverview(e,t){const s=this.genBaseURL("/alice/profile/overview"),i={visit_id:(e||{}).visit_id};return this.request({url:s,method:"POST",data:i},t)}ProfileBrief(e,t){const s=this.genBaseURL("/alice/profile/self_brief");return this.request({url:s,method:"POST"},t)}ReportAwemeOpenID(e,t){const s=this.genBaseURL("/alice/profile/report_aweme_open_id"),i=e||{},n={client_key:i.client_key,open_id:i.open_id};return this.request({url:s,method:"POST",data:n},t)}OperateUserVoice(e,t){const s=this.genBaseURL("/alice/profile/update_user_voice"),i=e||{},n={uid:i.uid,voice_id:i.voice_id,operate:i.operate};return this.request({url:s,method:"POST",data:n},t)}GetUserVoice(e,t){const s=this.genBaseURL("/alice/profile/get_user_voice"),i={uid:(e||{}).uid};return this.request({url:s,method:"POST",data:i},t)}}},863:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("ResourceApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}GetFileURL(e,t){const s=this.genBaseURL("/alice/message/get_file_url"),i=e||{},n={uris:i.uris,type:i.type,format:i.format};return this.request({url:s,method:"POST",data:n},t)}UploadImage(e,t){const s=this.genBaseURL("/alice/upload/image"),i=e||{},n={file_type:i.file_type,biz_type:i.biz_type,data:i.data};return this.request({url:s,method:"POST",data:n},t)}FileUpload(e,t){const s=this.genBaseURL("/alice/upload/file"),i=e||{},n={file_type:i.file_type,biz_type:i.biz_type,data:i.data};return this.request({url:s,method:"POST",data:n},t)}GetUploadAuthToken(e,t){const s=this.genBaseURL("/alice/upload/auth_token"),i=e||{},n={scene:i.scene,data_type:i.data_type};return this.request({url:s,method:"POST",data:n},t)}RefreshFileURL(e,t){const s=this.genBaseURL("/alice/upload/refresh_file_url"),i={url:(e||{}).url};return this.request({url:s,method:"POST",data:i},t)}}},14769:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("SafetyApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}AgeGateCheck(e,t){const s=this.genBaseURL("/alice/age_gate/check"),i={scene:(e||{}).scene};return this.request({url:s,method:"POST",data:i},t)}AgeGateReport(e,t){const s=this.genBaseURL("/alice/age_gate/report"),i=e||{},n={birthday:i.birthday,scene:i.scene,pass:i.pass};return this.request({url:s,method:"POST",data:n},t)}AgeGateDelete(e,t){const s=this.genBaseURL("/alice/age_gate/delete"),i={uid:(e||{}).uid};return this.request({url:s,method:"POST",data:i},t)}RedirectByRegion(e,t){const s=this.genBaseURL("/alice/safety/redirect_by_region"),i={key:(e||{}).key};return this.request({url:s,method:"GET",params:i},t)}GetReportReasons(e,t){const s=this.genBaseURL("/alice/safety/report/reasons"),i={report_type:(e||{}).report_type};return this.request({url:s,method:"GET",params:i},t)}ConversationReport(e,t){const s=this.genBaseURL("/alice/safety/report/create/conversation"),i=e||{},n={report_type:i.report_type,conversation_ID:i.conversation_ID,reason_ID:i.reason_ID,reason_detail:i.reason_detail,report_message:i.report_message,report_source:i.report_source,reporter_user_ID:i.reporter_user_ID};return this.request({url:s,method:"POST",data:n},t)}ConversationAppeal(e,t){const s=this.genBaseURL("/alice/safety/conversation/appeal"),i={conversation_id:(e||{}).conversation_id};return this.request({url:s,method:"POST",data:i},t)}UserReport(e,t){const s=this.genBaseURL("/alice/safety/report/create/user"),i=e||{},n={report_type:i.report_type,reporter_user_id:i.reporter_user_id,reported_user_id:i.reported_user_id,reason_id:i.reason_id,reason_detail:i.reason_detail,report_messages:i.report_messages,report_source:i.report_source};return this.request({url:s,method:"POST",data:n},t)}GetReviewReport(e,t){const s=this.genBaseURL("/alice/safety/get_review_report"),i={suppression_notify_id:(e||{}).suppression_notify_id};return this.request({url:s,method:"GET",params:i},t)}SuppressAppeal(e,t){const s=this.genBaseURL("/alice/safety/appeal"),i={suppression_notify_id:(e||{}).suppression_notify_id};return this.request({url:s,method:"POST",data:i},t)}}},19112:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("SamanthaApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}GetFeed(e,t){const s=this.genBaseURL("/samantha/feed");return this.request({url:s,method:"GET"},t)}ThreadList(e,t){const s=this.genBaseURL("/samantha/thread/list"),i=e||{},n={index:i.index,batch_size:i.batch_size};return this.request({url:s,method:"POST",data:n},t)}ThreadDelete(e,t){const s=this.genBaseURL("/samantha/thread/delete"),i=e||{},n={thread_id:i.thread_id,conversation_id:i.conversation_id};return this.request({url:s,method:"POST",data:n},t)}ThreadUpdate(e,t){const s=this.genBaseURL("/samantha/thread/update"),i=e||{},n={thread_id:i.thread_id,conversation_id:i.conversation_id,name:i.name};return this.request({url:s,method:"POST",data:n},t)}ThreadCreate(e,t){const s=this.genBaseURL("/samantha/thread/create"),i=e||{},n={conversation_id:i.conversation_id,message_id:i.message_id,bot_id:i.bot_id};return this.request({url:s,method:"POST",data:n},t)}GetSkillGuidance(e,t){const s=this.genBaseURL("/samantha/skill/guidance"),i=e||{},n={config_key:i.config_key,option_indexes:i.option_indexes};return this.request({url:s,method:"POST",data:n},t)}GetRecommendSkills(e,t){const s=this.genBaseURL("/samantha/skill/recommend");return this.request({url:s,method:"POST"},t)}CreateOrGetMainThread(e,t){const s=this.genBaseURL("/samantha/thread/main/create_or_get");return this.request({url:s,method:"POST"},t)}GetSamanthaWebHitStatus(e,t){const s=this.genBaseURL("/samantha/user/web_hit_status/get");return this.request({url:s,method:"GET"},t)}UpdateSamanthaWebHitStatus(e,t){const s=this.genBaseURL("/samantha/user/web_hit_status/update"),i=e||{},n={status:i.status,hit_source:i.hit_source,remind_time:i.remind_time};return this.request({url:s,method:"POST",data:n},t)}DetectLang(e,t){const s=this.genBaseURL("/samantha/plugin/detect_lang"),i={raw_text:(e||{}).raw_text};return this.request({url:s,method:"POST",data:i},t)}GetThreadShareInfo(e,t){const s=this.genBaseURL("/samantha/thread/share/info"),i={thread_id:(e||{}).thread_id};return this.request({url:s,method:"POST",data:i},t)}GetThreadShareSnapshot(e,t){const s=this.genBaseURL("/samantha/thread/share/snapshot/get"),i=e||{},n={share_id:i.share_id,need_bot:i.need_bot};return this.request({url:s,method:"POST",data:n},t)}SaveThreadShareInfo(e,t){const s=this.genBaseURL("/samantha/thread/share/save"),i=e||{},n={thread_id:i.thread_id,message_index_end:i.message_index_end,is_allow_seo:i.is_allow_seo,message_index_list:i.message_index_list,save_type:i.save_type};return this.request({url:s,method:"POST",data:n},t)}DeleteShareThreadInfo(e,t){const s=this.genBaseURL("/samantha/thread/share/delete"),i={share_id:(e||{}).share_id};return this.request({url:s,method:"POST",data:i},t)}GetTouristFeed(e,t){const s=this.genBaseURL("/samantha/feed/tourist_get");return this.request({url:s,method:"GET"},t)}GetYouTubeShare(e,t){const s=this.genBaseURL("/samantha/plugin/get_youtube_share"),i={share_id:(e||{}).share_id};return this.request({url:s,method:"GET",params:i},t)}CreateYouTubeShare(e,t){const s=this.genBaseURL("/samantha/plugin/youtube_share"),i={content:(e||{}).content};return this.request({url:s,method:"POST",data:i},t)}GetUtmInfo(e,t){const s=this.genBaseURL("/samantha/desktop/get_utm"),i={id:(e||{}).id};return this.request({url:s,method:"GET",params:i},t)}SaveUtmInfo(e,t){const s=this.genBaseURL("/samantha/desktop/save_utm"),i={info:(e||{}).info};return this.request({url:s,method:"POST",data:i},t)}GetLatestCRXInfo(e,t){const s=this.genBaseURL("/samantha/plugin/latest_crx_info");return this.request({url:s,method:"GET"},t)}Txt2Img(e,t){const s=this.genBaseURL("/samantha/cozeplugin/txt2img"),i=e||{},n={ratio:i.ratio,prompt:i.prompt,style:i.style};return this.request({url:s,method:"POST",data:n},t)}Translate(e,t){const s=this.genBaseURL("/samantha/plugin/translate"),i=e||{},n={raw_text:i.raw_text,source_lang:i.source_lang,target_lang:i.target_lang,translate_service:i.translate_service};return this.request({url:s,method:"POST",data:n},t)}PluginDeletePromptSkill(e,t){const s=this.genBaseURL("/samantha/plugin/prompt_skill/delete"),i=e||{},n={item_id:i.item_id,user_setting:i.user_setting,frontend_source:i.frontend_source};return this.request({url:s,method:"POST",data:n},t)}PluginAddPromptSkill(e,t){const s=this.genBaseURL("/samantha/plugin/prompt_skill/add"),i=e||{},n={items:i.items,frontend_source:i.frontend_source};return this.request({url:s,method:"POST",data:n},t)}PluginListDiscoverSkills(e,t){const s=this.genBaseURL("/samantha/plugin/prompt_skill/list_discover_skills"),i=e||{},n={page_size:i.page_size,start_index:i.start_index,frontend_source:i.frontend_source};return this.request({url:s,method:"POST",data:n},t)}ListCustomPSByUser(e,t){const s=this.genBaseURL("/samantha/plugin/prompt_skill/list_by_user"),i={frontend_source:(e||{}).frontend_source};return this.request({url:s,method:"POST",data:i},t)}PluginSavePSSetting(e,t){const s=this.genBaseURL("/samantha/plugin/prompt_skill/save_setting"),i=e||{},n={user_setting:i.user_setting,frontend_source:i.frontend_source};return this.request({url:s,method:"POST",data:n},t)}PluginUpdatePromptSkill(e,t){const s=this.genBaseURL("/samantha/plugin/prompt_skill/update"),i=e||{},n={item:i.item,frontend_source:i.frontend_source};return this.request({url:s,method:"POST",data:n},t)}GetSetting(e,t){const s=this.genBaseURL("/samantha/user/setting/get"),i={ab_param:(e||{}).ab_param};return this.request({url:s,method:"POST",data:i},t)}UpdateSetting(e,t){const s=this.genBaseURL("/samantha/user/setting/update"),i={ogf_enable:(e||{}).ogf_enable};return this.request({url:s,method:"POST",data:i},t)}Revise(e,t){const s=this.genBaseURL("/samantha/plugin/revise"),i={items:(e||{}).items};return this.request({url:s,method:"POST",data:i},t)}GetPluginChangeLog(e,t){const s=this.genBaseURL("/samantha/plugin/change_log"),i=e||{},n={version:i.version,language:i.language};return this.request({url:s,method:"GET",params:n},t)}GetPDFOcr(e,t){const s=this.genBaseURL("/samantha/pdf/ocr"),i=e||{},n={file_key:i.file_key,url:i.url,start_page:i.start_page,end_page:i.end_page};return this.request({url:s,method:"POST",data:n},t)}CollectionTagList(e,t){const s=this.genBaseURL("/samantha/collection/tag/list"),i=e||{},n={next_key:i.next_key,limit:i.limit};return this.request({url:s,method:"POST",data:n},t)}CollectionList(e,t){const s=this.genBaseURL("/samantha/collection/list"),i=e||{},n={keyword:i.keyword,tags:i.tags,types:i.types,next_key:i.next_key,limit:i.limit};return this.request({url:s,method:"POST",data:n},t)}DeleteCollectionOld(e,t){const s=this.genBaseURL("/samantha/collection/delete/:id"),i={id:(e||{}).id};return this.request({url:s,method:"POST",data:i},t)}CreateCollection(e,t){const s=this.genBaseURL("/samantha/collection/create"),i={collection:(e||{}).collection};return this.request({url:s,method:"POST",data:i},t)}GetCollection(e,t){const s=this.genBaseURL(`/samantha/collection/get/${e.id}`);return this.request({url:s,method:"GET"},t)}AcademicSearch(e,t){const s=this.genBaseURL("/samantha/cozeplugin/academic_search"),i=e||{},n={query:i.query,offset:i.offset,limit:i.limit};return this.request({url:s,method:"GET",params:n},t)}ThreadCreateOrGet(e,t){const s=this.genBaseURL("/samantha/thread/create_or_get"),i={collection_id:(e||{}).collection_id};return this.request({url:s,method:"POST",data:i},t)}DeleteCollection(e,t){const s=this.genBaseURL("/samantha/collection/delete"),i={id:(e||{}).id};return this.request({url:s,method:"POST",data:i},t)}CreateCollectionShare(e,t){const s=this.genBaseURL("/samantha/collection/share/create"),i=e||{},n={collection_id:i.collection_id,enable_seo:i.enable_seo};return this.request({url:s,method:"POST",data:n},t)}GetCollectionShare(e,t){const s=this.genBaseURL(`/samantha/collection/share/${e.share_id}`);return this.request({url:s,method:"GET"},t)}StreamCallBotInToutiao(e,t){const s=this.genBaseURL("/samantha/toutiao/stream_call_bot"),i={payload:(e||{}).payload};return this.request({url:s,method:"POST",data:i},t)}StreamArticleTranslate(e,t){const s=this.genBaseURL("/samantha/plugin/stream_article_translate"),i=e||{},n={raw_text:i.raw_text,target_lang:i.target_lang,translate_service:i.translate_service};return this.request({url:s,method:"POST",data:n},t)}UpdatePagesOutline(e,t){const s=this.genBaseURL("/samantha/pages/update_outline"),i=e||{},n={id:i.id,content:i.content,meta:i.meta};return this.request({url:s,method:"POST",data:n},t)}GetCollectionByFingerprint(e,t){const s=this.genBaseURL(`/samantha/collection/fingerprint/get/${e.fingerprint}`);return this.request({url:s,method:"GET"},t)}SniffUrl(e,t){const s=this.genBaseURL("/samantha/pdf/sniff"),i={urls:(e||{}).urls};return this.request({url:s,method:"POST",data:i},t)}AudioASR(e,t){const s=this.genBaseURL("/samantha/audio/asr"),i=e||{},n={format:i.format,codec:i.codec,rate:i.rate,bits:i.bits,channel:i.channel,language:i.language};return this.request({url:s,method:"GET",params:n},t)}AudioTTS(e,t){const s=this.genBaseURL("/samantha/audio/tts"),i={speaker:(e||{}).speaker};return this.request({url:s,method:"GET",params:i},t)}}},34553:(e,t,s)=>{s.d(t,{Cr:()=>i});let i=function(e){return e[e.Coco=1]="Coco",e[e.Bot=2]="Bot",e[e.CocoSub=3]="CocoSub",e[e.CocoWeb=4]="CocoWeb",e[e.CocoWebSub=5]="CocoWebSub",e}({})},25975:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("SearchApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}Search(e,t){const s=this.genBaseURL("/alice/comprehensive/search"),i=e||{},n={keyword:i.keyword,index_type:i.index_type,offset:i.offset,size:i.size};return this.request({url:s,method:"POST",data:n},t)}}},75486:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("SeoApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}GetDemo(e,t){const s=this.genBaseURL("/seo_api/demo"),i={pageId:(e||{}).pageId};return this.request({url:s,method:"GET",params:i},t)}GetItem(e,t){const s=this.genBaseURL("/seo_api/item/get"),i={id:(e||{}).id};return this.request({url:s,method:"GET",params:i},t)}GetList(e,t){const s=this.genBaseURL("/seo_api/item/list"),i=e||{},n={page_size:i.page_size,page_num:i.page_num};return this.request({url:s,method:"GET",params:n},t)}GetRecommendList(e,t){const s=this.genBaseURL("/seo_api/item/recommend"),i=e||{},n={page_size:i.page_size,page_num:i.page_num,recommend_type:i.recommend_type};return this.request({url:s,method:"GET",params:n},t)}GetUgcTalkSeoInfo(e,t){const s=this.genBaseURL("/seo_api/ugc/talk"),i={share_id:(e||{}).share_id};return this.request({url:s,method:"GET",params:i},t)}}},46715:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("SettingApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}BanAppeal(e,t){const s=this.genBaseURL("/alice/user/ban_appeal"),i={user_id:(e||{}).user_id};return this.request({url:s,method:"POST",data:i},t)}SyncUserConfig(e,t){const s=this.genBaseURL("/alice/user/config/sync"),i={configs:(e||{}).configs};return this.request({url:s,method:"POST",data:i},t)}CreateBlocklistUser(e,t){const s=this.genBaseURL("/alice/user/blocklist/create"),i={blocklist_user_id:(e||{}).blocklist_user_id};return this.request({url:s,method:"POST",data:i},t)}Launch(e,t){const s=this.genBaseURL("/alice/user/launch"),i=e||{},n={ug_landing_tag:i.ug_landing_tag,select:i.select};return this.request({url:s,method:"POST",data:n},t)}GetFeedbackList(e,t){const s=this.genBaseURL("/alice/user/feedback_list"),i=e||{},n={iid:i.iid,appkey:i.appkey,min_id:i.min_id,max_id:i.max_id,count:i.count};return this.request({url:s,method:"POST",data:n},t)}GetAccountInfo(e,t){const s=this.genBaseURL("/alice/user/get_account_info");return this.request({url:s,method:"POST"},t)}DeleteBlocklistUser(e,t){const s=this.genBaseURL("/alice/user/blocklist/delete"),i={blocklist_user_id:(e||{}).blocklist_user_id};return this.request({url:s,method:"POST",data:i},t)}InnerSSOToken(e,t){const s=this.genBaseURL("/alice/user/inner_sso_token");return this.request({url:s,method:"ANY"},t)}GetTabbarConfig(e,t){const s=this.genBaseURL("/alice/user/tabbar/config");return this.request({url:s,method:"POST"},t)}InnerSSOTokenVerify(e,t){const s=this.genBaseURL("/alice/user/inner_sso_token_verify");return this.request({url:s,method:"POST"},t)}GetUserBlocklist(e,t){const s=this.genBaseURL("/alice/user/blocklist/list"),i=e||{},n={index:i.index,limit:i.limit};return this.request({url:s,method:"POST",data:n},t)}GetWebAnonID(e,t){const s=this.genBaseURL("/alice/user/get_web_anon_id");return this.request({url:s,method:"POST"},t)}PullUserConfig(e,t){const s=this.genBaseURL("/alice/user/config/pull"),i=e||{},n={objects:i.objects,reason:i.reason};return this.request({url:s,method:"POST",data:n},t)}ActHeartbeat(e,t){const s=this.genBaseURL("/alice/user/act_heartbeat");return this.request({url:s,method:"POST"},t)}GetUserOgfQuota(e,t){const s=this.genBaseURL("/alice/user/get_user_ogf_quota");return this.request({url:s,method:"POST"},t)}Dynamic(e,t){const s=this.genBaseURL("/alice/user/dynamic"),i={key_list:(e||{}).key_list};return this.request({url:s,method:"POST",data:i},t)}AuthSuccessReport(e,t){const s=this.genBaseURL("/alice/user/auth_success_report"),i={push_open:(e||{}).push_open};return this.request({url:s,method:"POST",data:i},t)}OpAdvanceSwitch(e,t){const s=this.genBaseURL("/alice/user/op_advance"),i={op_type:(e||{}).op_type};return this.request({url:s,method:"POST",data:i},t)}}},36588:(e,t,s)=>{s.d(t,{Ay:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("SocialApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}GetSharePage(e,t){const s=this.genBaseURL("/social/conversation/get_share_page/"),i={share_token:(e||{}).share_token};return this.request({url:s,method:"POST",data:i},t)}}},53508:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(10633);class n{constructor(e){(0,i.A)(this,"request",(()=>{throw new Error("SuggestwordsApiService.request is undefined")})),(0,i.A)(this,"baseURL",""),this.request=(null==e?void 0:e.request)||this.request,this.baseURL=(null==e?void 0:e.baseURL)||""}genBaseURL(e){return"string"==typeof this.baseURL?this.baseURL+e:this.baseURL(e)}GetVideoSuggest(e,t){const s=this.genBaseURL("/alice/suggestwords/get_video_suggest"),i=e||{},n={item_id:i.item_id,item_id_good:i.item_id_good,video_suggest_type:i.video_suggest_type};return this.request({url:s,method:"POST",data:n},t)}GetSuggestWords(e,t){const s=this.genBaseURL("/alice/suggestwords"),i=e||{},n={query_text:i.query_text,source:i.source};return this.request({url:s,method:"POST",data:n},t)}GetTrendsTopic(e,t){const s=this.genBaseURL("/alice/suggestwords/trends_topic");return this.request({url:s,method:"POST"},t)}GetFlowSuggest(e,t){const s=this.genBaseURL("/alice/suggestwords/get_flow_suggest"),i=e||{},n={prompt_content:i.prompt_content,response_content:i.response_content,language:i.language};return this.request({url:s,method:"POST",data:n},t)}GetSuggestWordsComposite(e,t){const s=this.genBaseURL("/alice/suggestwords/composite"),i=e||{},n={query_text:i.query_text,source:i.source};return this.request({url:s,method:"POST",data:n},t)}}},54343:(e,t,s)=>{s.d(t,{B:()=>i});let i=function(e){return e[e.Message=1]="Message",e[e.Cmd=2]="Cmd",e[e.AppAction=3]="AppAction",e}({})},71786:(e,t,s)=>{s.d(t,{o:()=>c});var i=s(44557),n=s(27954),a=s(66428),o=s(66864);const r=a.A.create({timeout:1e4});r.interceptors.response.use((e=>{const{data:t={},headers:s,statusText:i,status:a,config:o}=e;return(0,n.WZ)({responseBody:t,responseHeaders:s,responseStatusText:i,responseStatusCode:a,requestConfig:{url:o.url}})}),(e=>{if((0,o.F0)(e)){const{response:i}=e;if(i){var t,s;const{data:a={},headers:o,statusText:r,status:c}=i;if((0,n.by)(e,null==e||null===(t=e.response)||void 0===t?void 0:t.status))return;(0,n.WZ)({responseBody:a,responseHeaders:o,responseStatusText:r,responseStatusCode:c,requestConfig:{url:null==e||null===(s=e.config)||void 0===s?void 0:s.url}})}}throw e}));const c=(e,t)=>r.request((0,i.A)((0,i.A)({},e),{},{params:(0,i.A)((0,i.A)({},e.params),(null==t?void 0:t.overrideParams)||{})},(null==t?void 0:t.overrideConfig)||{}))},97327:(e,t,s)=>{s.d(t,{j:()=>c});var i=s(44557),n=s(33451),a=s(10633),o=s(8719);const r=["params","headers"];class c{static init(e){if(this._apiService)return;const{httpClient:t,getCommonHeaders:s,getCommonParams:a,baseURL:c,ApiServiceConstructor:l}=e;this._apiService=(0,o.n)({ApiServiceConstructor:l,apiServiceConstructorOptions:{baseURL:c,request:(e,o)=>{let{params:c,headers:l}=e,d=(0,n.A)(e,r);return t((0,i.A)({params:(0,i.A)((0,i.A)({},null==a?void 0:a()),c),headers:(0,i.A)((0,i.A)({},null==s?void 0:s()),l)},d),o)}},httpClient:t})}static checkInit(){if(!this._apiService)throw Error("Flow Api has not initialized")}static get apiService(){return this.checkInit(),this._apiService}}(0,a.A)(c,"_apiService",void 0)},2741:(e,t,s)=>{s.d(t,{k:()=>a});var i=s(10633),n=s(60588);class a{constructor(){(0,i.A)(this,"eventEmitter",new n.A),(0,i.A)(this,"started",!0),(0,i.A)(this,"buffer",[])}emit(e,...t){this.started?this.eventEmitter.emit(e,...t):this.buffer.push({event:e,args:t})}on(e,t){this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.off(e,t)}start(){if(!this.started){this.started=!0;for(const{event:e,args:t}of this.buffer)this.emit(e,...t)}}stop(){this.started=!1}clear(){this.buffer=[]}}},81407:(e,t,s)=>{s.d(t,{P:()=>n,g:()=>a});var i=s(2741);let n=function(e){return e.UNAUTHORIZED="unauthorized",e.NOACCESS="noAccess",e.SHARK_BLOCK="sharkBlocked",e.COUNTRY_RESTRICTED="countryRestricted",e.CONVERSATION_INVALID="conversationInvalid",e.NEED_TO_WAIT="needToWait",e.USER_BANNED="userBanned",e.USER_BANNED_OTHER="userBannedOther",e.USER_BAN_RELEASE="userBanRelease",e.NETWORK_ERROR="networkError",e}({});const a=new i.k},98949:(e,t,s)=>{s.d(t,{_:()=>i});const i=e=>null==e?void 0:e["x-tt-logid"]},41433:(e,t,s)=>{s.d(t,{r:()=>m});var i=s(44557),n=s(14065),a=s(33451),o=s(28159),r=s(41967),c=s(11855),l=s(29019),d=s.n(l),u=s(63159);const g=e=>(0,u.jsxs)("svg",(0,i.A)((0,i.A)({xmlns:"http://www.w3.org/2000/svg",width:17,height:17,fill:"none",viewBox:"0 0 17 17"},e),{},{children:[(0,u.jsx)("g",{clipPath:"url(#white-loading_svg__a)",children:(0,u.jsx)("path",{stroke:"url(#white-loading_svg__b)",strokeLinecap:"round",strokeWidth:1.778,d:"M15.61 8.5A7.111 7.111 0 0 0 2.097 5.405"})}),(0,u.jsxs)("defs",{children:[(0,u.jsxs)("linearGradient",{id:"white-loading_svg__b",x1:2.096,x2:15.611,y1:8.5,y2:8.5,gradientUnits:"userSpaceOnUse",children:[(0,u.jsx)("stop",{stopColor:"#fff",stopOpacity:0}),(0,u.jsx)("stop",{offset:.399,stopColor:"#fff",stopOpacity:.5}),(0,u.jsx)("stop",{offset:1,stopColor:"#fff"})]}),(0,u.jsx)("clipPath",{id:"white-loading_svg__a",children:(0,u.jsx)("path",{fill:"#fff",d:"M.5.5h16v16H.5z"})})]})]})),h=e=>(0,u.jsxs)("svg",(0,i.A)((0,i.A)({xmlns:"http://www.w3.org/2000/svg",width:17,height:17,fill:"none",viewBox:"0 0 17 17"},e),{},{children:[(0,u.jsx)("g",{clipPath:"url(#black-loading_svg__a)",children:(0,u.jsx)("path",{stroke:"url(#black-loading_svg__b)",strokeLinecap:"round",strokeWidth:1.778,d:"M15.61 8.5A7.111 7.111 0 0 0 2.097 5.405"})}),(0,u.jsxs)("defs",{children:[(0,u.jsxs)("linearGradient",{id:"black-loading_svg__b",x1:2.096,x2:15.611,y1:8.5,y2:8.5,gradientUnits:"userSpaceOnUse",children:[(0,u.jsx)("stop",{stopOpacity:0}),(0,u.jsx)("stop",{offset:.399,stopOpacity:.5}),(0,u.jsx)("stop",{offset:1})]}),(0,u.jsx)("clipPath",{id:"black-loading_svg__a",children:(0,u.jsx)("path",{fill:"#000",d:"M.5.5h16v16H.5z"})})]})]})),p={button:"button-YIMk8y",clickable:"clickable-LJsrmr","type-primary":"type-primary-qG4wRn",typePrimary:"type-primary-qG4wRn","type-dashed":"type-dashed-HdUCt6",typeDashed:"type-dashed-HdUCt6","type-danger":"type-danger-ffMO7U",typeDanger:"type-danger-ffMO7U",disabled:"disabled-j3ucAu","width-fit":"width-fit-V3Wkl4",widthFit:"width-fit-V3Wkl4","width-full":"width-full-DHUGO3",widthFull:"width-full-DHUGO3",loading:"loading-kzj8pB",rotate:"rotate-epwdFQ",rotation:"rotation-uKQGyL"},_=["disabled","loading","width","type","onClick","onDisableClick","onLoadingClick","icon","className","style","children"],m=e=>{let{disabled:t=!1,loading:s=!1,width:l="full",type:m="primary",onClick:v,onDisableClick:f,onLoadingClick:y,icon:b,className:S,style:k,children:M}=e,A=(0,a.A)(e,_);const[E,w]=(0,c.useState)(!1),[I,L]=(0,c.useState)(!1),R=E||s,z=I||t,C={setDisabled:L,setLoading:w},T=function(){var e=(0,n.A)((function*(){if(R)return void(null==y||y(C));if(z)return void(null==f||f(C));const e=null==v?void 0:v(C);if(e){w(!0);try{yield e}finally{w(!1)}}}));return function(){return e.apply(this,arguments)}}();return(0,u.jsxs)("div",(0,i.A)((0,i.A)({className:d()(p.button,S,p[`type-${m}`],(0,o.A)(l)?p[`width-${l}`]:void 0,{[p.disabled]:z,[p.clickable]:Boolean(v)&&(Boolean(y)||!s)&&!t}),style:(0,i.A)((0,i.A)({},k),{},{width:(0,r.A)(l)?l:void 0}),onClick:T,"data-disabled":t},A),{},{children:[R?"dashed"===m?(0,u.jsx)(h,{className:d()(p.loading,p.rotate)}):(0,u.jsx)(g,{className:d()(p.loading,p.rotate)}):b,M]}))}},51412:(e,t,s)=>{s.d(t,{Qo:()=>o});var i=s(11855),n=s(24712);const a=(0,i.createContext)(null),o=()=>{const e=(0,i.useContext)(a);var t;return null===e?(console.warn("RTLContext has not been initialized yet"),null!==(t=(0,n.V8)())&&void 0!==t&&t):e};a.Provider},39241:(e,t,s)=>{s.d(t,{B:()=>w});var i=s(96770),n=s(6693),a=s(11855),o=s(29019),r=s.n(o);let c=function(e){return e.Top="top",e.Bottom="bottom",e.Inner="inner",e}({});var l=s(14065),d=s(44557),u=s(53713);const g="scroll-view-VuVgIp",h="before-ZSZMHg",p="after-nYhsA1",_="content-NfeEi5",m="scrollable-xAHiOl",v="reverse-fWD12d",f="disable-scroll-DBbH6v",y="show-scrollbar-H13q3P",b="auto-show-scrollbar-yUgdkB",S=(()=>{const e=(0,u.Z57)();if(!e)return!0;const{major:t}=e;return t>=83})(),k=({reverse:e,scrollStatusRef:t})=>{const s=(0,a.useRef)(null),i=(0,a.useRef)(!1),n=()=>{const{current:e}=s;if(!e)throw Error("Not found ScrollView ref instance");return e},o=()=>{const t=n();return e&&!S?t.scrollTop-(t.scrollHeight-t.offsetHeight):t.scrollTop},r=(t,s)=>{const i=n(),a=(t=>{const s=n(),i=t;if((0,u.F_u)()){if(e){const e=s.offsetHeight-s.scrollHeight+1;return Math.max(i,e)}{const e=s.scrollHeight-s.offsetHeight-1;return Math.min(i,e)}}return i})(e&&!S?t+(i.scrollHeight-i.offsetHeight):t);s?i.scrollTo((0,d.A)({top:a},s)):i.scrollTop=a},g=(t,s)=>{if(!i.current)return r((t=>{const s=n();return e?t-(s.scrollHeight-s.offsetHeight):t})(t),s),new Promise((e=>{requestAnimationFrame((()=>{e()}))}))},h=function(){var e=(0,l.A)((function*(){yield g(0)}));return function(){return e.apply(this,arguments)}}(),p=function(){var t=(0,l.A)((function*(t={}){const{smooth:s=!1}=t,{scrollHeight:i,offsetHeight:a}=n();yield g((t=>{const s=n();return e?s.scrollHeight-s.offsetHeight+t:t})(i-a),{behavior:s?"smooth":void 0})}));return function(){return t.apply(this,arguments)}}(),_=()=>{const{current:t}=s;if(!t)return 0;const{scrollHeight:i,offsetHeight:n}=t,a=o();return e?i-(n+-a):a},m=()=>{const{current:e}=s;return e?e.scrollHeight-_()-e.offsetHeight:0};return(0,a.useEffect)((()=>{var e,t;null===(e=s.current)||void 0===e||e.addEventListener("touchstart",(()=>{i.current=!0})),null===(t=s.current)||void 0===t||t.addEventListener("touchend",(()=>{i.current=!1}))}),[]),{ref:s,controller:{scrollTo:g,scrollToTop:h,scrollToBottom:p,getScrollTop:_,getScrollBottom:m,refreshAnchor:()=>{(null==t?void 0:t.current)===c.Top?h():(null==t?void 0:t.current)===c.Bottom&&p()},disableScroll:e=>{var t;i.current=!0,null===(t=s.current)||void 0===t||t.classList.add(e||f),r(o()-1)},enableScroll:e=>{var t;i.current=!1,null===(t=s.current)||void 0===t||t.classList.remove(e||f)},isNearBottom:e=>m()<=e}}};var M=s(30112),A=s(69935),E=s(63159);const w=(0,a.forwardRef)((function({style:e,className:t,children:s,scrollableClassName:o,before:l,after:d,innerBefore:u,reverse:f=!1,reachTopThreshold:S,onReachTop:w,onLeaveTop:I,reachBottomThreshold:L,onReachBottom:R,onLeaveBottom:z,showScrollbar:C,autoShowScrollbar:T,onScroll:U},x){const B=f?c.Bottom:c.Top,O=(0,a.useRef)(B),{ref:P,controller:q}=k({reverse:f,scrollStatusRef:O}),{getScrollTop:D,getScrollBottom:G}=q,N=(0,a.useRef)(!1),F=(0,a.useRef)(!1),{className:j,onScroll:H}=(0,M.j)();(0,a.useImperativeHandle)(x,(()=>q),[q]);const V=(0,a.useMemo)((()=>(0,n.A)((e=>{O.current=e}),100)),[]);return(0,E.jsx)(A.a,{containerRef:P,controller:q,children:(0,E.jsxs)("div",{className:r()(g,t),style:e,children:[l&&(0,E.jsx)("div",{className:r()(h),children:(0,i.A)(l)?null==l?void 0:l(q):l}),(0,E.jsx)("div",{className:r()(_),children:(0,E.jsxs)("div",{ref:P,className:r()(m,C&&y,T&&b,{[v]:f},j,o),onScroll:e=>{if(!e.currentTarget)return;null==U||U(e);const{offsetHeight:t}=e.currentTarget,s=null!=S?S:t,i=null!=L?L:t;D()<s?N.current||(N.current=!0,null==w||w()):N.current&&(N.current=!1,null==I||I()),G()<i?F.current||(F.current=!0,null==R||R()):F.current&&(F.current=!1,null==z||z()),O.current=c.Inner,D()<=0&&G()<=0?V(B):D()<=0?V(c.Top):G()<=0?V(c.Bottom):V(c.Inner),H()},children:[(0,i.A)(s)?s(q):s,u&&(0,E.jsx)("div",{className:r()(h),children:(0,i.A)(u)?null==u?void 0:u(q):u})]})}),d&&(0,E.jsx)("div",{className:r()(p),children:(0,i.A)(d)?null==d?void 0:d(q):d})]})})}))},30112:(e,t,s)=>{s.d(t,{j:()=>o});var i=s(6693),n=s(11855);const a="show-scrollbar-thumb-RYti2z",o=()=>{const[e,t]=(0,n.useState)(!1),s=(0,n.useMemo)((()=>(0,i.A)((()=>t(!1)),300,{leading:!1,trailing:!0})),[]),o=(0,n.useCallback)((()=>{e||t(!0),s()}),[e]);return{className:e?a:"",onScroll:o}}},61743:(e,t,s)=>{s.d(t,{p:()=>p});var i=s(44557),n=s(33451),a=s(11855),o=s(29019),r=s.n(o),c=s(34944),l=s(51412),d=s(24712);const u={container:"container-AilALM","custom-scrollbar":"custom-scrollbar-xZDNG1",customScrollbar:"custom-scrollbar-xZDNG1",flow:"flow-xs54Ev"};var g=s(63159);const h=["theme","customScrollbar"],p=(0,a.forwardRef)((function(e,t){var s;let{theme:o="flow",customScrollbar:p=!0}=e,_=(0,n.A)(e,h);const{defaultValue:m,value:v,onChange:f,className:y,"data-testid":b,readOnly:S}=_,k=(0,l.Qo)(),[M,A]=(0,a.useState)(""),E=(0,d.r$)(null!==(s=null!=v?v:M)&&void 0!==s?s:m,!0);return(0,g.jsx)(c.fs,(0,i.A)((0,i.A)((0,i.A)({ref:t,dir:k?E:"ltr"},_),S?{readonly:!0,disabled:void 0}:{disabled:_.disabled}),{},{className:r()(u.container,u[o],y,{[u["custom-scrollbar"]]:p}),onChange:(e,t)=>{A(e),null==f||f(e,t)},"data-testid":b}))}));(0,c.ZH)(p,{maintainCursor:!0})},24712:(e,t,s)=>{s.d(t,{V8:()=>c,r$:()=>d});var i=s(14065),n=s(11855),a=s(22933),o=s(53713);const r=["ae","aeb","ajt","apc","apd","ar","ara","arb","arc","arq","ars","ary","arz","ave","avl","bal","bcc","bej","bft","bgn","bqi","brh","cja","ckb","cld","dcc","dgl","div","drw","dv","fa","fas","fia","fub","gbz","gjk","gju","glk","grc","gwc","gwt","haz","he","heb","hnd","hno","iw","ji","kas","kby","khw","ks","kvx","kxp","kzh","lad","lah","lki","lrc","luz","mde","mfa","mki","mvy","myz","mzn","nqo","oru","ota","otk","oui","pal","pbu","per","pes","phl","phn","pnb","pra","prd","prs","ps","pus","rhg","rmt","scl","sd","sdh","shu","skr","smp","snd","sog","swb","syr","tnf","trw","ug","uig","ur","urd","wni","xco","xld","xmn","xmr","xna","xpr","xsa","ydd","yi","yid","zdj"],c=()=>(0,a.isRtlLang)("undefined"==typeof navigator?"":navigator.language),l=function(){var e=(0,i.A)((function*(e,t=!1){try{const n=e.trim();if(!n)return t;const{franc:a}=yield(0,o.tsJ)((()=>Promise.resolve().then(s.bind(s,6683)))),c=a(n,{minLength:20});return"und"===c?(i=n.charAt(0),new RegExp("^[^A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff]*[\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc]").test(i)):r.includes(c)}catch(n){return t}var i}));return function(t){return e.apply(this,arguments)}}(),d=(e,t=!1)=>{const[s,a]=(0,n.useState)("ltr");return(0,n.useEffect)((()=>{(0,i.A)((function*(){const s=yield l(e,t);a(s?"rtl":"ltr")}))()}),[e,t]),s}},29432:(e,t,s)=>{s.d(t,{$b:()=>a.$,Gx:()=>n.Gx,Jz:()=>a.J,Vy:()=>i.V,cR:()=>n.cR,gK:()=>n.gK,hD:()=>n.hD,hS:()=>i.h});var i=s(51098),n=(s(50560),s(95337),s(25182)),a=s(14218)},25182:(e,t,s)=>{s.d(t,{Gx:()=>a.Gx,cR:()=>n.c,gK:()=>o.g,hD:()=>i.h});var i=s(7969),n=s(27545),a=s(44652),o=s(66998)},60891:(e,t,s)=>{s.d(t,{XB:()=>l});var i=s(33451),n=s(44557),a=s(54096),o=s(80722);const r=["logger"],c=({eventName:e,logger:t,meta:s,once:i=!1})=>{const o=t,r=[];let c=0,l=!1;const d=()=>{c=Date.now(),o.persist.info({eventName:`${e}_start`,meta:(0,n.A)({},u())})},u=()=>(0,n.A)((0,n.A)({},s),l?{event_has_finished:!0}:{}),g=()=>{if(0!==r.length)return r.reduce(((e,t,s)=>{const{pointName:i}=t;return e[i]=t.time-c,(0,a.A)(e,["interval",i],0===s?e[i]:t.time-r[s-1].time),e}),{})},h=({meta:t}={})=>{i&&l||(o.persist.success({eventName:e,meta:(0,n.A)((0,n.A)({},u()),{},{success:1,duration:g()},t)}),l=!0)};let p;const _=({reason:t,error:s,meta:a})=>{i&&l||(o.persist.error({eventName:e,error:s||new Error(t),meta:(0,n.A)((0,n.A)({},u()),{},{success:0,reason:t,duration:g()},a)}),l=!0)};return d(),{name:"ReportEvent",start:d,cancel:()=>{clearTimeout(p),l=!0},success:h,successIfIdle:(e,t,s)=>{clearTimeout(p),p=setTimeout((()=>l?void 0:(h(t),null==s?void 0:s())),e)},error:_,errorIfIdle:(e,t,s)=>{clearTimeout(p),p=setTimeout((()=>l?void 0:(_(t),null==s?void 0:s())),e)},addDurationPoint:(e,t=!0)=>{const s=r.find((t=>t.pointName===e));s?t&&(s.time=Date.now()):r.push({pointName:e,time:Date.now()}),r.sort(((e,t)=>e.time-t.time))},getDuration:g,getMeta:u,updateMeta:e=>{s=(0,n.A)((0,n.A)({},s),e)},getFinishStatus:()=>l,setStartTime:e=>{c=e}}},l=e=>{let{logger:t=o.v}=e,s=(0,i.A)(e,r);return c((0,n.A)({logger:t},s))}},82392:(e,t,s)=>{s(37114)},76203:(e,t,s)=>{s(60588),s(74051),s(82392)},61106:(e,t,s)=>{s(76203),s(82392)},74051:(e,t,s)=>{},47807:(e,t,s)=>{s.d(t,{O:()=>a,e:()=>n});var i=s(49392);const n=e=>{try{return JSON.stringify(e)}catch(t){return console.error({error:t}),""}},a=(e,t)=>{try{return e?JSON.parse(e):{}}catch(s){return(0,i.A)(t)?{}:t}}},69220:(e,t,s)=>{s.d(t,{BK:()=>n});var i=s(49392);function n(e,t,s){return new Promise(((n,a)=>{setTimeout((()=>{s?a(new Error("Mock to reject.")):(0,i.A)(t)?n(void 0):n(t)}),e)}))}}}]);